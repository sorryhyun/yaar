<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>falling-blocks</title>
<style>*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden}body{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}</style>
<script>(function(){if(window.__yaarCaptureInstalled)return;window.__yaarCaptureInstalled=!0;function s(r,n){window.parent.postMessage({type:"yaar:capture-response",requestId:r,imageData:n},"*")}function o(r,n){for(var d=r.querySelectorAll("*"),u=n.querySelectorAll("*"),i=0;i<d.length&&i<u.length;i++){var t=window.getComputedStyle(d[i]);u[i].setAttribute("style",t.cssText)}var a=window.getComputedStyle(r);n.setAttribute("style",a.cssText)}function e(r,n,d,u){var i=new Blob([r],{type:"image/svg+xml;charset=utf-8"}),t=URL.createObjectURL(i),a=new Image;a.onload=function(){var f=document.createElement("canvas");f.width=n,f.height=d;var p=f.getContext("2d");p.drawImage(a,0,0,n,d),URL.revokeObjectURL(t),u(f.toDataURL("image/png"))},a.onerror=function(){URL.revokeObjectURL(t),u(null)},a.src=t}window.addEventListener("message",function(r){if(!(!r.data||r.data.type!=="yaar:capture-request")){var n=r.data.requestId,d=null;try{var u=document.querySelectorAll("canvas");if(u.length>0){for(var i=null,t=0,a=0;a<u.length;a++){var f=u[a].width*u[a].height;f>t&&(t=f,i=u[a])}i&&(d=i.toDataURL("image/png"))}if(d){s(n,d);return}var p=document.querySelectorAll("svg");if(p.length>0){for(var i=null,t=0,a=0;a<p.length;a++){var c=p[a].getBoundingClientRect(),f=c.width*c.height;f>t&&(t=f,i=p[a])}if(i){var v=new XMLSerializer,w=v.serializeToString(i),c=i.getBoundingClientRect();e(w,c.width||300,c.height||150,function(j){s(n,j)});return}}var l=document.body;if(l){var h=Math.min(l.scrollWidth,window.innerWidth)||window.innerWidth||800,g=Math.min(l.scrollHeight,window.innerHeight)||window.innerHeight||600,y=l.cloneNode(!0);o(l,y);for(var m=y.querySelectorAll("script,iframe"),a=0;a<m.length;a++)m[a].remove();var q="http://www.w3.org/1999/xhtml",b="http://www.w3.org/2000/svg",I=new XMLSerializer().serializeToString(y),w='<svg xmlns="'+b+'" width="'+h+'" height="'+g+'"><foreignObject width="100%" height="100%"><body xmlns="'+q+'" style="margin:0;padding:0;">'+I+"</body></foreignObject></svg>";e(w,h,g,function(S){s(n,S)});return}}catch{}s(n,null)}})})(),function(){if(window.__yaarStorageInstalled)return;window.__yaarStorageInstalled=!0;function s(o){return o.split("/").map(encodeURIComponent).join("/")}window.yaar=window.yaar||{},window.yaar.storage={async save(o,e){var r;typeof e=="string"?r=e:e instanceof Blob?r=await e.arrayBuffer():e instanceof ArrayBuffer?r=e:e instanceof Uint8Array?r=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):r=String(e);var n=await fetch("/api/storage/"+s(o),{method:"POST",body:r});if(!n.ok){var d=await n.json().catch(function(){return{error:n.statusText}});throw new Error(d.error||"Save failed")}return n.json()},async read(o,e){var r=e&&e.as||"auto",n=await fetch("/api/storage/"+s(o));if(!n.ok){var d=await n.json().catch(function(){return{error:n.statusText}});throw new Error(d.error||"Read failed")}if(r==="blob")return n.blob();if(r==="arraybuffer")return n.arrayBuffer();if(r==="json")return n.json();if(r==="text")return n.text();var u=n.headers.get("content-type")||"";return u.includes("json")?n.json():u.startsWith("text/")?n.text():n.blob()},async list(o){var e=o?s(o):"",r=await fetch("/api/storage/"+e+"?list=true");if(!r.ok){var n=await r.json().catch(function(){return{error:r.statusText}});throw new Error(n.error||"List failed")}return r.json()},async remove(o){var e=await fetch("/api/storage/"+s(o),{method:"DELETE"});if(!e.ok){var r=await e.json().catch(function(){return{error:e.statusText}});throw new Error(r.error||"Delete failed")}return e.json()},url:function(o){return"/api/storage/"+s(o)}}}(),function(){if(!window.__yaarFetchProxyInstalled){window.__yaarFetchProxyInstalled=!0;var s=window.fetch.bind(window);window.fetch=function(o,e){var r;if(o instanceof Request?r=o.url:r=String(o),r.startsWith("/")||r.startsWith("./")||r.startsWith("../"))return s(o,e);try{var n=new URL(r,location.origin);if(n.origin===location.origin)return s(o,e)}catch{return s(o,e)}var d=e&&e.method||(o instanceof Request?o.method:"GET"),u={};e&&e.headers?e.headers instanceof Headers?e.headers.forEach(function(t,a){u[a]=t}):Array.isArray(e.headers)?e.headers.forEach(function(t){u[t[0]]=t[1]}):u=Object.assign({},e.headers):o instanceof Request&&o.headers.forEach(function(t,a){u[a]=t});var i;return e&&e.body!=null?typeof e.body=="string"?i=Promise.resolve(e.body):i=new Response(e.body).text():o instanceof Request&&d!=="GET"&&d!=="HEAD"?i=o.text():i=Promise.resolve(void 0),i.then(function(t){var a={url:r,method:d,headers:u};return t!==void 0&&(a.body=t),s("/api/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}).then(function(t){return t.ok?t.json():t.json().then(function(a){throw new Error(a.error||"Fetch proxy error: "+t.status)})}).then(function(t){var a;if(t.bodyEncoding==="base64"){for(var f=atob(t.body),p=new Uint8Array(f.length),c=0;c<f.length;c++)p[c]=f.charCodeAt(c);a=p.buffer}else a=t.body;return new Response(a,{status:t.status,statusText:t.statusText,headers:t.headers})})}}}(),function(){if(!window.__yaarAppProtocolInstalled){window.__yaarAppProtocolInstalled=!0,window.yaar=window.yaar||{};var s=null;window.yaar.app={register:function(o){s=o,window.parent.postMessage({type:"yaar:app-ready",appId:o.appId},"*")},sendInteraction:function(o){window.parent.postMessage({type:"yaar:app-interaction",content:typeof o=="string"?o:JSON.stringify(o)},"*")}},window.addEventListener("message",function(o){if(!(!o.data||!o.data.type)){var e=o.data,r=e.requestId;if(e.type==="yaar:app-manifest-request"){if(!s){window.parent.postMessage({type:"yaar:app-manifest-response",requestId:r,manifest:null,error:"No app registered"},"*");return}var n={appId:s.appId,name:s.name,state:{},commands:{}};if(s.state)for(var d in s.state){var u=s.state[d];n.state[d]={description:u.description},u.schema&&(n.state[d].schema=u.schema)}if(s.commands)for(var d in s.commands){var i=s.commands[d];n.commands[d]={description:i.description},i.params&&(n.commands[d].params=i.params),i.returns&&(n.commands[d].returns=i.returns)}window.parent.postMessage({type:"yaar:app-manifest-response",requestId:r,manifest:n},"*");return}if(e.type==="yaar:app-query-request"){if(!s||!s.state||!s.state[e.stateKey]){window.parent.postMessage({type:"yaar:app-query-response",requestId:r,data:null,error:"Unknown state key: "+e.stateKey},"*");return}try{var t=s.state[e.stateKey].handler();t&&typeof t.then=="function"?t.then(function(a){window.parent.postMessage({type:"yaar:app-query-response",requestId:r,data:a},"*")}).catch(function(a){window.parent.postMessage({type:"yaar:app-query-response",requestId:r,data:null,error:String(a)},"*")}):window.parent.postMessage({type:"yaar:app-query-response",requestId:r,data:t},"*")}catch(a){window.parent.postMessage({type:"yaar:app-query-response",requestId:r,data:null,error:String(a)},"*")}return}if(e.type==="yaar:app-command-request"){if(!s||!s.commands||!s.commands[e.command]){window.parent.postMessage({type:"yaar:app-command-response",requestId:r,result:null,error:"Unknown command: "+e.command},"*");return}try{var t=s.commands[e.command].handler(e.params);t&&typeof t.then=="function"?t.then(function(f){window.parent.postMessage({type:"yaar:app-command-response",requestId:r,result:f},"*")}).catch(function(f){window.parent.postMessage({type:"yaar:app-command-response",requestId:r,result:null,error:String(f)},"*")}):window.parent.postMessage({type:"yaar:app-command-response",requestId:r,result:t},"*")}catch(a){window.parent.postMessage({type:"yaar:app-command-response",requestId:r,result:null,error:String(a)},"*")}return}}})}}();</script>
</head>
<body>
<div id="app"></div>
<script type="module">
var me=["#000000","#00D7FF","#2F6BFF","#FF9E2C","#FFE04A","#58E05E","#B35CFF","#FF4C68"],fe={I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],J:[[2,0,0,0],[2,2,2,0],[0,0,0,0],[0,0,0,0]],L:[[0,0,3,0],[3,3,3,0],[0,0,0,0],[0,0,0,0]],O:[[0,4,4,0],[0,4,4,0],[0,0,0,0],[0,0,0,0]],S:[[0,5,5,0],[5,5,0,0],[0,0,0,0],[0,0,0,0]],T:[[0,6,0,0],[6,6,6,0],[0,0,0,0],[0,0,0,0]],Z:[[7,7,0,0],[0,7,7,0],[0,0,0,0],[0,0,0,0]]};function xe(e){return e.map(t=>t.slice())}function be(e){let t=Array.from({length:4},()=>Array(4).fill(0));for(let n=0;n<4;n++)for(let r=0;r<4;r++)t[r][3-n]=e[n][r];return t}function re(){return Array.from({length:20},()=>Array(10).fill(0))}var ge=["I","J","L","O","S","T","Z"],f=[];function w(){if(f.length===0){f=ge.slice();for(let e=f.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[f[e],f[t]]=[f[t],f[e]]}}return f.pop()}function g(e){return{type:e,m:xe(fe[e]),x:Math.floor(10/2)-2,y:-1}}function M(e,t,n=0,r=0,l){let u=l??t.m;for(let s=0;s<4;s++)for(let y=0;y<4;y++){if(!u[s][y])continue;let W=t.x+y+n,F=t.y+s+r;if(W<0||W>=10||F>=20||F>=0&&e[F][W])return!0}return!1}function ye(e,t){for(let n=0;n<4;n++)for(let r=0;r<4;r++){let l=t.m[n][r];if(!l)continue;let u=t.x+r,s=t.y+n;s>=0&&s<20&&u>=0&&u<10&&(e[s][u]=l)}}function ve(e){let t=0;for(let n=19;n>=0;n--)e[n].every(r=>r!==0)&&(e.splice(n,1),e.unshift(Array(10).fill(0)),t++,n++);return t}function D(e){return Math.max(90,800-e*60)}function he(e,t){return([0,100,300,500,800][e]??e*200)*(t+1)}var oe=document.createElement("style");oe.textContent=`
  :root { color-scheme: dark; }
  html, body { height: 100%; }
  body {
    margin: 0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    background: radial-gradient(1200px 900px at 20% 0%, #1b2440 0%, #0b0f1a 55%, #070910 100%);
    color: #e9eefc;
    display: grid;
    place-items: center;
  }
  #app {
    display: flex;
    gap: 16px;
    padding: 18px;
    border-radius: 18px;
    background: rgba(10, 13, 25, 0.7);
    box-shadow: 0 10px 35px rgba(0,0,0,0.45);
    border: 1px solid rgba(255,255,255,0.08);
    backdrop-filter: blur(10px);
  }
  .panel {
    display: flex;
    flex-direction: column;
    gap: 12px;
    min-width: 210px;
  }
  .title {
    font-weight: 800;
    letter-spacing: 0.3px;
    font-size: 18px;
  }
  .card {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px;
    padding: 12px;
  }
  .stat {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 8px;
    font-size: 14px;
    opacity: 0.95;
  }
  .stat b { font-variant-numeric: tabular-nums; }
  .help {
    font-size: 12px;
    line-height: 1.35;
    opacity: 0.85;
  }
  canvas {
    image-rendering: pixelated;
    background: rgba(0,0,0,0.35);
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.08);
  }
  .miniWrap { display: flex; gap: 10px; }
  .miniCol { display:flex; flex-direction: column; gap: 8px; }
  .miniLabel { font-size: 12px; opacity: 0.85; }
  .btnRow { display:flex; gap: 8px; flex-wrap: wrap; }
  button {
    appearance: none;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.06);
    color: #e9eefc;
    padding: 8px 10px;
    border-radius: 10px;
    font-weight: 650;
    cursor: pointer;
  }
  button:hover { background: rgba(255,255,255,0.10); }
  button:active { transform: translateY(1px); }
  .overlay {
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;
    pointer-events: none;
  }
  .overlayBox {
    pointer-events: none;
    text-align: center;
    padding: 14px 16px;
    border-radius: 14px;
    background: rgba(0,0,0,0.55);
    border: 1px solid rgba(255,255,255,0.10);
    max-width: 320px;
  }
  .overlayBox h2 { margin: 0 0 6px 0; font-size: 18px; }
  .overlayBox p { margin: 0; font-size: 13px; opacity: 0.9; }
`;document.head.appendChild(oe);document.body.innerHTML="";var B=document.createElement("div");B.id="app";var A=document.createElement("div");A.style.position="relative";var C=document.createElement("canvas"),i=C.getContext("2d"),S=document.createElement("div");S.className="overlay";var N=document.createElement("div");N.className="overlayBox";S.appendChild(N);A.appendChild(C);A.appendChild(S);var z=document.createElement("div");z.className="panel";var I=document.createElement("div");I.className="title";I.textContent="Falling Blocks";var $=document.createElement("div");$.className="card";var Y=document.createElement("div");Y.className="stat";var J=document.createElement("div");J.className="stat";var U=document.createElement("div");U.className="stat";var Z=document.createElement("div");Z.className="stat";$.append(Y,Z,J,U);var q=document.createElement("div");q.className="card";var K=document.createElement("div");K.className="miniWrap";function ae(e){let t=document.createElement("div");t.className="miniCol";let n=document.createElement("div");n.className="miniLabel",n.textContent=e;let r=document.createElement("canvas"),l=r.getContext("2d");return t.append(n,r),{wrap:t,c:r,g:l}}var c=ae("Next"),d=ae("Hold");K.append(c.wrap,d.wrap);q.appendChild(K);var j=document.createElement("div");j.className="card";var G=document.createElement("div");G.className="btnRow";var _=document.createElement("button");_.textContent="Restart (R)";var Q=document.createElement("button");Q.textContent="Pause (P)";G.append(_,Q);j.appendChild(G);var V=document.createElement("div");V.className="help";V.textContent="\u2190/\u2192 move \u2022 \u2191 rotate \u2022 \u2193 soft drop \u2022 Space hard drop \u2022 C hold \u2022 P pause \u2022 R restart";z.append(I,$,q,j,V);B.append(A,z);document.body.appendChild(B);var m=re(),o=g(w()),L=g(w()),v=null,R=!0,h=0,P=0,b=0,X=D(b),E=0,ne=0,x=!1,p=!1,ie="falling-blocks:hi",T=Number(localStorage.getItem(ie)??"0")||0;function le(){m=re(),f=[],o=g(w()),L=g(w()),v=null,R=!0,h=0,P=0,b=0,X=D(b),E=0,x=!1,p=!1,H()}function ee(){h>T&&(T=h,localStorage.setItem(ie,String(T)))}function se(){Y.innerHTML=`<span>Score</span><b>${h}</b>`,Z.innerHTML=`<span>High</span><b>${T}</b>`,J.innerHTML=`<span>Lines</span><b>${P}</b>`,U.innerHTML=`<span>Level</span><b>${b}</b>`}function k(e,t){return M(m,o,e,t)?!1:(o.x+=e,o.y+=t,!0)}function te(){ye(m,o);let e=ve(m);if(e){P+=e,h+=he(e,b);let t=Math.floor(P/10);t!==b&&(b=t,X=D(b))}ee(),o=L,o.x=Math.floor(10/2)-2,o.y=-1,L=g(w()),R=!0,M(m,o,0,0)&&(p=!0)}function Ce(){k(0,1)?(h+=1,ee()):te()}function Se(){if(p||x)return;let e=0;for(;!M(m,o,0,1);)o.y++,e++;h+=e*2,ee(),te()}function we(){if(!R||p||x)return;R=!1;let e=o.type;v==null?(v=e,o=L,o.x=Math.floor(10/2)-2,o.y=-1,L=g(w())):(o=g(v),v=e),M(m,o,0,0)&&(p=!0)}function Le(){if(p||x)return;let e=be(o.m),t=[0,-1,1,-2,2];for(let n of t)if(!M(m,o,n,0,e)){o.m=e,o.x+=n;return}}function H(){p?(N.innerHTML="<h2>Game Over</h2><p>Press R to restart.</p>",S.style.display="grid"):x?(N.innerHTML="<h2>Paused</h2><p>Press P to resume.</p>",S.style.display="grid"):S.style.display="none"}var a=26;function ce(){let e=Math.min(760,window.innerHeight-120);a=Math.max(18,Math.floor(e/20));let t=window.devicePixelRatio||1;C.style.width=`${10*a}px`,C.style.height=`${20*a}px`,C.width=Math.floor(10*a*t),C.height=Math.floor(20*a*t),i.setTransform(t,0,0,t,0,0);let n=Math.floor(a*.9);for(let{c:r}of[c,d])r.style.width=`${n*4}px`,r.style.height=`${n*4}px`,r.width=Math.floor(n*4*t),r.height=Math.floor(n*4*t);c.g.setTransform(t,0,0,t,0,0),d.g.setTransform(t,0,0,t,0,0)}function de(e,t,n,r,l=1){r&&(e.save(),e.globalAlpha=l,e.fillStyle=me[r],e.fillRect(t*a,n*a,a,a),e.strokeStyle="rgba(0,0,0,0.35)",e.lineWidth=1,e.strokeRect(t*a+.5,n*a+.5,a-1,a-1),e.restore())}function O(e,t,n,r,l=1){for(let u=0;u<4;u++)for(let s=0;s<4;s++){let y=t[u][s];y&&de(e,n+s,r+u,y,l)}}function Me(){let e=o.y;for(;!M(m,o,0,e-o.y+1);)e++;return e}function Re(e,t,n){e.clearRect(0,0,t,n),e.fillStyle="rgba(0,0,0,0.28)",e.fillRect(0,0,t,n)}function Oe(){Re(i,10*a,20*a),i.save(),i.strokeStyle="rgba(255,255,255,0.06)";for(let n=1;n<10;n++)i.beginPath(),i.moveTo(n*a+.5,0),i.lineTo(n*a+.5,20*a),i.stroke();for(let n=1;n<20;n++)i.beginPath(),i.moveTo(0,n*a+.5),i.lineTo(10*a,n*a+.5),i.stroke();i.restore();for(let n=0;n<20;n++)for(let r=0;r<10;r++){let l=m[n][r];l&&de(i,r,n,l,1)}if(!p){let n=Me();O(i,o.m,o.x,n,.22)}O(i,o.m,o.x,o.y,1);let e=Math.floor(a*.9),t=window.devicePixelRatio||1;if(c.g.setTransform(t,0,0,t,0,0),c.g.clearRect(0,0,e*4,e*4),c.g.fillStyle="rgba(0,0,0,0.28)",c.g.fillRect(0,0,e*4,e*4),c.g.save(),c.g.scale(e/a,e/a),O(c.g,L.m,0,0,1),c.g.restore(),d.g.setTransform(t,0,0,t,0,0),d.g.clearRect(0,0,e*4,e*4),d.g.fillStyle="rgba(0,0,0,0.28)",d.g.fillRect(0,0,e*4,e*4),v){let n=g(v);d.g.save(),d.g.scale(e/a,e/a),O(d.g,n.m,0,0,R?1:.6),d.g.restore()}se(),H()}function pe(e){let t=e-ne;ne=e,!x&&!p&&(E+=t,E>=X&&(E=0,k(0,1)||te())),Oe(),requestAnimationFrame(pe)}function ue(){p||(x=!x,H())}_.onclick=()=>le();Q.onclick=()=>ue();window.addEventListener("keydown",e=>{let t=e.key;if(["ArrowLeft","ArrowRight","ArrowDown","ArrowUp"," "].includes(t)&&e.preventDefault(),t==="r"||t==="R"){le();return}if(t==="p"||t==="P"){ue();return}x||p||(t==="ArrowLeft"?k(-1,0):t==="ArrowRight"?k(1,0):t==="ArrowDown"?Ce():t==="ArrowUp"?Le():t===" "?Se():(t==="c"||t==="C")&&we())});window.addEventListener("resize",()=>{ce()});ce();se();H();requestAnimationFrame(pe);

</script>
</body>
</html>