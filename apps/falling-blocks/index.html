<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Falling Blocks</title>
<style>*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden}body{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}</style>
<script>(function(){if(window.__yaarCaptureInstalled)return;window.__yaarCaptureInstalled=true;function respond(requestId,imageData){window.parent.postMessage({type:"yaar:capture-response",requestId,imageData},"*")}function inlineStyles(original,clone){var origEls=original.querySelectorAll("*");var cloneEls=clone.querySelectorAll("*");for(var i=0;i<origEls.length&&i<cloneEls.length;i++){var cs=window.getComputedStyle(origEls[i]);cloneEls[i].setAttribute("style",cs.cssText)}var rootCs=window.getComputedStyle(original);clone.setAttribute("style",rootCs.cssText)}function svgToCanvas(svgStr,w,h,cb){var blob=new Blob([svgStr],{type:"image/svg+xml;charset=utf-8"});var url=URL.createObjectURL(blob);var img=new Image;img.onload=function(){var c=document.createElement("canvas");c.width=w;c.height=h;var ctx=c.getContext("2d");ctx.drawImage(img,0,0,w,h);URL.revokeObjectURL(url);cb(c.toDataURL("image/png"))};img.onerror=function(){URL.revokeObjectURL(url);cb(null)};img.src=url}window.addEventListener("message",function(e){if(!e.data||e.data.type!=="yaar:capture-request")return;var requestId=e.data.requestId;var imageData=null;try{var canvases=document.querySelectorAll("canvas");if(canvases.length>0){var largest=null;var largestArea=0;for(var i=0;i<canvases.length;i++){var area=canvases[i].width*canvases[i].height;if(area>largestArea){largestArea=area;largest=canvases[i]}}if(largest){imageData=largest.toDataURL("image/png")}}if(imageData){respond(requestId,imageData);return}var svgs=document.querySelectorAll("svg");if(svgs.length>0){var largest=null;var largestArea=0;for(var i=0;i<svgs.length;i++){var rect=svgs[i].getBoundingClientRect();var area=rect.width*rect.height;if(area>largestArea){largestArea=area;largest=svgs[i]}}if(largest){var serializer=new XMLSerializer;var svgStr=serializer.serializeToString(largest);var rect=largest.getBoundingClientRect();svgToCanvas(svgStr,rect.width||300,rect.height||150,function(data){respond(requestId,data)});return}}var body=document.body;if(body){var w=Math.min(body.scrollWidth,window.innerWidth)||window.innerWidth||800;var h=Math.min(body.scrollHeight,window.innerHeight)||window.innerHeight||600;var clone=body.cloneNode(true);inlineStyles(body,clone);var remove=clone.querySelectorAll("script,iframe");for(var i=0;i<remove.length;i++)remove[i].remove();var xmlns="http://www.w3.org/1999/xhtml";var svgNS="http://www.w3.org/2000/svg";var xhtml=new XMLSerializer().serializeToString(clone);var svgStr='<svg xmlns="'+svgNS+'" width="'+w+'" height="'+h+'">'+'<foreignObject width="100%" height="100%">'+'<body xmlns="'+xmlns+'" style="margin:0;padding:0;">'+xhtml+"</body></foreignObject></svg>";svgToCanvas(svgStr,w,h,function(data){respond(requestId,data)});return}}catch(ex){}respond(requestId,null)})})();(function(){if(window.__yaarStorageInstalled)return;window.__yaarStorageInstalled=true;function encodePath(p){return p.split("/").map(encodeURIComponent).join("/")}window.yaar=window.yaar||{};window.yaar.storage={async save(path,data){var body;if(typeof data==="string"){body=data}else if(data instanceof Blob){body=await data.arrayBuffer()}else if(data instanceof ArrayBuffer){body=data}else if(data instanceof Uint8Array){body=data.buffer.slice(data.byteOffset,data.byteOffset+data.byteLength)}else{body=String(data)}var res=await fetch("/api/storage/"+encodePath(path),{method:"POST",body});if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Save failed")}return res.json()},async read(path,options){var mode=options&&options.as||"auto";var res=await fetch("/api/storage/"+encodePath(path));if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Read failed")}if(mode==="blob")return res.blob();if(mode==="arraybuffer")return res.arrayBuffer();if(mode==="json")return res.json();if(mode==="text")return res.text();var ct=res.headers.get("content-type")||"";if(ct.includes("json"))return res.json();if(ct.startsWith("text/"))return res.text();return res.blob()},async list(dirPath){var p=dirPath?encodePath(dirPath):"";var res=await fetch("/api/storage/"+p+"?list=true");if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"List failed")}return res.json()},async remove(path){var res=await fetch("/api/storage/"+encodePath(path),{method:"DELETE"});if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Delete failed")}return res.json()},url:function(path){return"/api/storage/"+encodePath(path)}}})();(function(){if(window.__yaarFetchProxyInstalled)return;window.__yaarFetchProxyInstalled=true;var realFetch=window.fetch.bind(window);var sessionId="";try{var sp=new URLSearchParams(location.search);var raw=sp.get("sessionId")||"";if(/^[a-zA-Z0-9_-]+$/.test(raw))sessionId=raw}catch(e){}window.fetch=function(input,init){var url;if(input instanceof Request){url=input.url}else{url=String(input)}if(url.startsWith("/")||url.startsWith("./")||url.startsWith("../")){return realFetch(input,init)}try{var parsed=new URL(url,location.origin);if(parsed.origin===location.origin){return realFetch(input,init)}}catch(e){return realFetch(input,init)}var method=init&&init.method||(input instanceof Request?input.method:"GET");var headers={};if(init&&init.headers){if(init.headers instanceof Headers){init.headers.forEach(function(v,k){headers[k]=v})}else if(Array.isArray(init.headers)){init.headers.forEach(function(pair){headers[pair[0]]=pair[1]})}else{headers=Object.assign({},init.headers)}}else if(input instanceof Request){input.headers.forEach(function(v,k){headers[k]=v})}var bodyPromise;if(init&&init.body!=null){if(typeof init.body==="string"){bodyPromise=Promise.resolve(init.body)}else{bodyPromise=new Response(init.body).text()}}else if(input instanceof Request&&method!=="GET"&&method!=="HEAD"){bodyPromise=input.text()}else{bodyPromise=Promise.resolve(undefined)}return bodyPromise.then(function(bodyStr){var payload={url,method,headers};if(bodyStr!==undefined)payload.body=bodyStr;if(sessionId)payload.sessionId=sessionId;return realFetch("/api/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)})}).then(function(proxyRes){if(!proxyRes.ok){return proxyRes.json().then(function(err){throw new Error(err.error||"Fetch proxy error: "+proxyRes.status)})}return proxyRes.json()}).then(function(data){var body;if(data.bodyEncoding==="base64"){var bin=atob(data.body);var bytes=new Uint8Array(bin.length);for(var i=0;i<bin.length;i++)bytes[i]=bin.charCodeAt(i);body=bytes.buffer}else{body=data.body}return new Response(body,{status:data.status,statusText:data.statusText,headers:data.headers})})}})();(function(){if(window.__yaarAppProtocolInstalled)return;window.__yaarAppProtocolInstalled=true;window.yaar=window.yaar||{};var registration=null;window.yaar.app={register:function(config){registration=config;window.parent.postMessage({type:"yaar:app-ready",appId:config.appId},"*")},sendInteraction:function(description){window.parent.postMessage({type:"yaar:app-interaction",content:typeof description==="string"?description:JSON.stringify(description)},"*")}};window.addEventListener("message",function(e){if(!e.data||!e.data.type)return;var msg=e.data;var requestId=msg.requestId;if(msg.type==="yaar:app-manifest-request"){if(!registration){window.parent.postMessage({type:"yaar:app-manifest-response",requestId,manifest:null,error:"No app registered"},"*");return}var manifest={appId:registration.appId,name:registration.name,state:{},commands:{}};if(registration.state){for(var key in registration.state){var s=registration.state[key];manifest.state[key]={description:s.description};if(s.schema)manifest.state[key].schema=s.schema}}if(registration.commands){for(var key in registration.commands){var c=registration.commands[key];manifest.commands[key]={description:c.description};if(c.params)manifest.commands[key].params=c.params;if(c.returns)manifest.commands[key].returns=c.returns}}window.parent.postMessage({type:"yaar:app-manifest-response",requestId,manifest},"*");return}if(msg.type==="yaar:app-query-request"){if(!registration||!registration.state||!registration.state[msg.stateKey]){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:"Unknown state key: "+msg.stateKey},"*");return}try{var result=registration.state[msg.stateKey].handler();if(result&&typeof result.then==="function"){result.then(function(data){window.parent.postMessage({type:"yaar:app-query-response",requestId,data},"*")}).catch(function(err){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:String(err)},"*")})}else{window.parent.postMessage({type:"yaar:app-query-response",requestId,data:result},"*")}}catch(err){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:String(err)},"*")}return}if(msg.type==="yaar:app-command-request"){if(!registration||!registration.commands||!registration.commands[msg.command]){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:"Unknown command: "+msg.command},"*");return}try{var result=registration.commands[msg.command].handler(msg.params);if(result&&typeof result.then==="function"){result.then(function(data){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:data},"*")}).catch(function(err){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:String(err)},"*")})}else{window.parent.postMessage({type:"yaar:app-command-response",requestId,result},"*")}}catch(err){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:String(err)},"*")}return}})})();</script>
</head>
<body>
<div id="app"></div>
<script type="module">
var fq=["#000000","#00D7FF","#2F6BFF","#FF9E2C","#FFE04A","#58E05E","#B35CFF","#FF4C68"],Eq={I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],J:[[2,0,0,0],[2,2,2,0],[0,0,0,0],[0,0,0,0]],L:[[0,0,3,0],[3,3,3,0],[0,0,0,0],[0,0,0,0]],O:[[0,4,4,0],[0,4,4,0],[0,0,0,0],[0,0,0,0]],S:[[0,5,5,0],[5,5,0,0],[0,0,0,0],[0,0,0,0]],T:[[0,6,0,0],[6,6,6,0],[0,0,0,0],[0,0,0,0]],Z:[[7,7,0,0],[0,7,7,0],[0,0,0,0],[0,0,0,0]]};function Yq(q){return q.map((G)=>G.slice())}function Dq(q){let G=Array.from({length:4},()=>Array(4).fill(0));for(let J=0;J<4;J++)for(let Q=0;Q<4;Q++)G[Q][3-J]=q[J][Q];return G}function Qq(){return Array.from({length:20},()=>Array(10).fill(0))}var Rq=["I","J","L","O","S","T","Z"],E=[];function z(){if(E.length===0){E=Rq.slice();for(let q=E.length-1;q>0;q--){let G=Math.floor(Math.random()*(q+1));[E[q],E[G]]=[E[G],E[q]]}}return E.pop()}function R(q){return{type:q,m:Yq(Eq[q]),x:Math.floor(5)-2,y:-1}}function k(q,G,J=0,Q=0,Z){let _=Z??G.m;for(let $=0;$<4;$++)for(let P=0;P<4;P++){if(!_[$][P])continue;let g=G.x+P+J,m=G.y+$+Q;if(g<0||g>=10)return!0;if(m>=20)return!0;if(m>=0&&q[m][g])return!0}return!1}function Pq(q,G){for(let J=0;J<4;J++)for(let Q=0;Q<4;Q++){let Z=G.m[J][Q];if(!Z)continue;let _=G.x+Q,$=G.y+J;if($>=0&&$<20&&_>=0&&_<10)q[$][_]=Z}}function Wq(q){let G=0;for(let J=19;J>=0;J--)if(q[J].every((Q)=>Q!==0))q.splice(J,1),q.unshift(Array(10).fill(0)),G++,J++;return G}function u(q){return Math.max(90,800-q*60)}function Iq(q,G){return([0,100,300,500,800][q]??q*200)*(G+1)}var Uq=document.createElement("style");Uq.textContent=`
  :root { color-scheme: dark; }
  html, body { height: 100%; }
  body {
    margin: 0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    background: radial-gradient(1200px 900px at 20% 0%, #1b2440 0%, #0b0f1a 55%, #070910 100%);
    color: #e9eefc;
    display: grid;
    place-items: center;
  }
  #app {
    display: flex;
    gap: 16px;
    padding: 18px;
    border-radius: 18px;
    background: rgba(10, 13, 25, 0.7);
    box-shadow: 0 10px 35px rgba(0,0,0,0.45);
    border: 1px solid rgba(255,255,255,0.08);
    backdrop-filter: blur(10px);
  }
  .panel {
    display: flex;
    flex-direction: column;
    gap: 12px;
    min-width: 210px;
  }
  .title {
    font-weight: 800;
    letter-spacing: 0.3px;
    font-size: 18px;
  }
  .card {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px;
    padding: 12px;
  }
  .stat {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 8px;
    font-size: 14px;
    opacity: 0.95;
  }
  .stat b { font-variant-numeric: tabular-nums; }
  .help {
    font-size: 12px;
    line-height: 1.35;
    opacity: 0.85;
  }
  canvas {
    image-rendering: pixelated;
    background: rgba(0,0,0,0.35);
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.08);
  }
  .miniWrap { display: flex; gap: 10px; }
  .miniCol { display:flex; flex-direction: column; gap: 8px; }
  .miniLabel { font-size: 12px; opacity: 0.85; }
  .btnRow { display:flex; gap: 8px; flex-wrap: wrap; }
  button {
    appearance: none;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.06);
    color: #e9eefc;
    padding: 8px 10px;
    border-radius: 10px;
    font-weight: 650;
    cursor: pointer;
  }
  button:hover { background: rgba(255,255,255,0.10); }
  button:active { transform: translateY(1px); }
  .overlay {
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;
    pointer-events: none;
  }
  .overlayBox {
    pointer-events: none;
    text-align: center;
    padding: 14px 16px;
    border-radius: 14px;
    background: rgba(0,0,0,0.55);
    border: 1px solid rgba(255,255,255,0.10);
    max-width: 320px;
  }
  .overlayBox h2 { margin: 0 0 6px 0; font-size: 18px; }
  .overlayBox p { margin: 0; font-size: 13px; opacity: 0.9; }
`;document.head.appendChild(Uq);document.body.innerHTML="";var b=document.createElement("div");b.id="app";var C=document.createElement("div");C.style.position="relative";var A=document.createElement("canvas"),X=A.getContext("2d"),T=document.createElement("div");T.className="overlay";var M=document.createElement("div");M.className="overlayBox";T.appendChild(M);C.appendChild(A);C.appendChild(T);var v=document.createElement("div");v.className="panel";var x=document.createElement("div");x.className="title";x.textContent="Falling Blocks";var y=document.createElement("div");y.className="card";var s=document.createElement("div");s.className="stat";var p=document.createElement("div");p.className="stat";var c=document.createElement("div");c.className="stat";var o=document.createElement("div");o.className="stat";y.append(s,o,p,c);var l=document.createElement("div");l.className="card";var d=document.createElement("div");d.className="miniWrap";function Vq(q){let G=document.createElement("div");G.className="miniCol";let J=document.createElement("div");J.className="miniLabel",J.textContent=q;let Q=document.createElement("canvas"),Z=Q.getContext("2d");return G.append(J,Q),{wrap:G,c:Q,g:Z}}var F=Vq("Next"),N=Vq("Hold");d.append(F.wrap,N.wrap);l.appendChild(d);var n=document.createElement("div");n.className="card";var i=document.createElement("div");i.className="btnRow";var t=document.createElement("button");t.textContent="Restart (R)";var a=document.createElement("button");a.textContent="Pause (P)";i.append(t,a);n.appendChild(i);var r=document.createElement("div");r.className="help";r.textContent="←/→ move • ↑ rotate • ↓ soft drop • Space hard drop • C hold • P pause • R restart";v.append(x,y,l,n,r);b.append(C,v);document.body.appendChild(b);var f=Qq(),U=R(z()),H=R(z()),W=null,S=!0,I=0,L=0,D=0,e=u(D),K=0,Jq=0,Y=!1,j=!1,Xq="falling-blocks:hi",B=Number(localStorage.getItem(Xq)??"0")||0;function Zq(){f=Qq(),E=[],U=R(z()),H=R(z()),W=null,S=!0,I=0,L=0,D=0,e=u(D),K=0,Y=!1,j=!1,O()}function qq(){if(I>B)B=I,localStorage.setItem(Xq,String(B))}function $q(){s.innerHTML=`<span>Score</span><b>${I}</b>`,o.innerHTML=`<span>High</span><b>${B}</b>`,p.innerHTML=`<span>Lines</span><b>${L}</b>`,c.innerHTML=`<span>Level</span><b>${D}</b>`}function h(q,G){if(!k(f,U,q,G))return U.x+=q,U.y+=G,!0;return!1}function Gq(){Pq(f,U);let q=Wq(f);if(q){L+=q,I+=Iq(q,D);let G=Math.floor(L/10);if(G!==D)D=G,e=u(D)}if(qq(),U=H,U.x=Math.floor(5)-2,U.y=-1,H=R(z()),S=!0,k(f,U,0,0))j=!0}function Aq(){if(!h(0,1))Gq();else I+=1,qq()}function Tq(){if(j||Y)return;let q=0;while(!k(f,U,0,1))U.y++,q++;I+=q*2,qq(),Gq()}function zq(){if(!S||j||Y)return;S=!1;let q=U.type;if(W==null)W=q,U=H,U.x=Math.floor(5)-2,U.y=-1,H=R(z());else U=R(W),W=q;if(k(f,U,0,0))j=!0}function Hq(){if(j||Y)return;let q=Dq(U.m),G=[0,-1,1,-2,2];for(let J of G)if(!k(f,U,J,0,q)){U.m=q,U.x+=J;return}}function O(){if(j)M.innerHTML="<h2>Game Over</h2><p>Press R to restart.</p>",T.style.display="grid";else if(Y)M.innerHTML="<h2>Paused</h2><p>Press P to resume.</p>",T.style.display="grid";else T.style.display="none"}var V=26;function Fq(){let q=Math.min(760,window.innerHeight-120);V=Math.max(18,Math.floor(q/20));let G=window.devicePixelRatio||1;A.style.width=`${10*V}px`,A.style.height=`${20*V}px`,A.width=Math.floor(10*V*G),A.height=Math.floor(20*V*G),X.setTransform(G,0,0,G,0,0);let J=Math.floor(V*0.9);for(let{c:Q}of[F,N])Q.style.width=`${J*4}px`,Q.style.height=`${J*4}px`,Q.width=Math.floor(J*4*G),Q.height=Math.floor(J*4*G);F.g.setTransform(G,0,0,G,0,0),N.g.setTransform(G,0,0,G,0,0)}function Nq(q,G,J,Q,Z=1){if(!Q)return;q.save(),q.globalAlpha=Z,q.fillStyle=fq[Q],q.fillRect(G*V,J*V,V,V),q.strokeStyle="rgba(0,0,0,0.35)",q.lineWidth=1,q.strokeRect(G*V+0.5,J*V+0.5,V-1,V-1),q.restore()}function w(q,G,J,Q,Z=1){for(let _=0;_<4;_++)for(let $=0;$<4;$++){let P=G[_][$];if(!P)continue;Nq(q,J+$,Q+_,P,Z)}}function kq(){let q=U.y;while(!k(f,U,0,q-U.y+1))q++;return q}function Sq(q,G,J){q.clearRect(0,0,G,J),q.fillStyle="rgba(0,0,0,0.28)",q.fillRect(0,0,G,J)}function wq(){Sq(X,10*V,20*V),X.save(),X.strokeStyle="rgba(255,255,255,0.06)";for(let J=1;J<10;J++)X.beginPath(),X.moveTo(J*V+0.5,0),X.lineTo(J*V+0.5,20*V),X.stroke();for(let J=1;J<20;J++)X.beginPath(),X.moveTo(0,J*V+0.5),X.lineTo(10*V,J*V+0.5),X.stroke();X.restore();for(let J=0;J<20;J++)for(let Q=0;Q<10;Q++){let Z=f[J][Q];if(Z)Nq(X,Q,J,Z,1)}if(!j){let J=kq();w(X,U.m,U.x,J,0.22)}w(X,U.m,U.x,U.y,1);let q=Math.floor(V*0.9),G=window.devicePixelRatio||1;if(F.g.setTransform(G,0,0,G,0,0),F.g.clearRect(0,0,q*4,q*4),F.g.fillStyle="rgba(0,0,0,0.28)",F.g.fillRect(0,0,q*4,q*4),F.g.save(),F.g.scale(q/V,q/V),w(F.g,H.m,0,0,1),F.g.restore(),N.g.setTransform(G,0,0,G,0,0),N.g.clearRect(0,0,q*4,q*4),N.g.fillStyle="rgba(0,0,0,0.28)",N.g.fillRect(0,0,q*4,q*4),W){let J=R(W);N.g.save(),N.g.scale(q/V,q/V),w(N.g,J.m,0,0,S?1:0.6),N.g.restore()}$q(),O()}function jq(q){let G=q-Jq;if(Jq=q,!Y&&!j){if(K+=G,K>=e){if(K=0,!h(0,1))Gq()}}wq(),requestAnimationFrame(jq)}function _q(){if(j)return;Y=!Y,O()}t.onclick=()=>Zq();a.onclick=()=>_q();window.addEventListener("keydown",(q)=>{let G=q.key;if(["ArrowLeft","ArrowRight","ArrowDown","ArrowUp"," "].includes(G))q.preventDefault();if(G==="r"||G==="R"){Zq();return}if(G==="p"||G==="P"){_q();return}if(Y||j)return;if(G==="ArrowLeft")h(-1,0);else if(G==="ArrowRight")h(1,0);else if(G==="ArrowDown")Aq();else if(G==="ArrowUp")Hq();else if(G===" ")Tq();else if(G==="c"||G==="C")zq()});window.addEventListener("resize",()=>{Fq()});Fq();$q();O();requestAnimationFrame(jq);

</script>
</body>
</html>