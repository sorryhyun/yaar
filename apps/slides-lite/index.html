<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slides Lite</title>
<style>*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden}body{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}</style>
<script>(function(){if(window.__yaarCaptureInstalled)return;window.__yaarCaptureInstalled=true;function respond(requestId,imageData){window.parent.postMessage({type:"yaar:capture-response",requestId,imageData},"*")}function inlineStyles(original,clone){var origEls=original.querySelectorAll("*");var cloneEls=clone.querySelectorAll("*");for(var i=0;i<origEls.length&&i<cloneEls.length;i++){var cs=window.getComputedStyle(origEls[i]);cloneEls[i].setAttribute("style",cs.cssText)}var rootCs=window.getComputedStyle(original);clone.setAttribute("style",rootCs.cssText)}function svgToCanvas(svgStr,w,h,cb){var blob=new Blob([svgStr],{type:"image/svg+xml;charset=utf-8"});var url=URL.createObjectURL(blob);var img=new Image;img.onload=function(){var c=document.createElement("canvas");c.width=w;c.height=h;var ctx=c.getContext("2d");ctx.drawImage(img,0,0,w,h);URL.revokeObjectURL(url);cb(c.toDataURL("image/png"))};img.onerror=function(){URL.revokeObjectURL(url);cb(null)};img.src=url}window.addEventListener("message",function(e){if(!e.data||e.data.type!=="yaar:capture-request")return;var requestId=e.data.requestId;var imageData=null;try{var canvases=document.querySelectorAll("canvas");if(canvases.length>0){var largest=null;var largestArea=0;for(var i=0;i<canvases.length;i++){var area=canvases[i].width*canvases[i].height;if(area>largestArea){largestArea=area;largest=canvases[i]}}if(largest){imageData=largest.toDataURL("image/png")}}if(imageData){respond(requestId,imageData);return}var svgs=document.querySelectorAll("svg");if(svgs.length>0){var largest=null;var largestArea=0;for(var i=0;i<svgs.length;i++){var rect=svgs[i].getBoundingClientRect();var area=rect.width*rect.height;if(area>largestArea){largestArea=area;largest=svgs[i]}}if(largest){var serializer=new XMLSerializer;var svgStr=serializer.serializeToString(largest);var rect=largest.getBoundingClientRect();svgToCanvas(svgStr,rect.width||300,rect.height||150,function(data){respond(requestId,data)});return}}var body=document.body;if(body){var w=Math.min(body.scrollWidth,window.innerWidth)||window.innerWidth||800;var h=Math.min(body.scrollHeight,window.innerHeight)||window.innerHeight||600;var clone=body.cloneNode(true);inlineStyles(body,clone);var remove=clone.querySelectorAll("script,iframe");for(var i=0;i<remove.length;i++)remove[i].remove();var xmlns="http://www.w3.org/1999/xhtml";var svgNS="http://www.w3.org/2000/svg";var xhtml=new XMLSerializer().serializeToString(clone);var svgStr='<svg xmlns="'+svgNS+'" width="'+w+'" height="'+h+'">'+'<foreignObject width="100%" height="100%">'+'<body xmlns="'+xmlns+'" style="margin:0;padding:0;">'+xhtml+"</body></foreignObject></svg>";svgToCanvas(svgStr,w,h,function(data){respond(requestId,data)});return}}catch(ex){}respond(requestId,null)})})();(function(){if(window.__yaarStorageInstalled)return;window.__yaarStorageInstalled=true;function encodePath(p){return p.split("/").map(encodeURIComponent).join("/")}window.yaar=window.yaar||{};window.yaar.storage={async save(path,data){var body;if(typeof data==="string"){body=data}else if(data instanceof Blob){body=await data.arrayBuffer()}else if(data instanceof ArrayBuffer){body=data}else if(data instanceof Uint8Array){body=data.buffer.slice(data.byteOffset,data.byteOffset+data.byteLength)}else{body=String(data)}var res=await fetch("/api/storage/"+encodePath(path),{method:"POST",body});if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Save failed")}return res.json()},async read(path,options){var mode=options&&options.as||"auto";var res=await fetch("/api/storage/"+encodePath(path));if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Read failed")}if(mode==="blob")return res.blob();if(mode==="arraybuffer")return res.arrayBuffer();if(mode==="json")return res.json();if(mode==="text")return res.text();var ct=res.headers.get("content-type")||"";if(ct.includes("json"))return res.json();if(ct.startsWith("text/"))return res.text();return res.blob()},async list(dirPath){var p=dirPath?encodePath(dirPath):"";var res=await fetch("/api/storage/"+p+"?list=true");if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"List failed")}return res.json()},async remove(path){var res=await fetch("/api/storage/"+encodePath(path),{method:"DELETE"});if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Delete failed")}return res.json()},url:function(path){return"/api/storage/"+encodePath(path)}}})();(function(){if(window.__yaarFetchProxyInstalled)return;window.__yaarFetchProxyInstalled=true;var realFetch=window.fetch.bind(window);var sessionId="";try{var sp=new URLSearchParams(location.search);var raw=sp.get("sessionId")||"";if(/^[a-zA-Z0-9_-]+$/.test(raw))sessionId=raw}catch(e){}window.fetch=function(input,init){var url;if(input instanceof Request){url=input.url}else{url=String(input)}if(url.startsWith("/")||url.startsWith("./")||url.startsWith("../")){return realFetch(input,init)}try{var parsed=new URL(url,location.origin);if(parsed.origin===location.origin){return realFetch(input,init)}}catch(e){return realFetch(input,init)}var method=init&&init.method||(input instanceof Request?input.method:"GET");var headers={};if(init&&init.headers){if(init.headers instanceof Headers){init.headers.forEach(function(v,k){headers[k]=v})}else if(Array.isArray(init.headers)){init.headers.forEach(function(pair){headers[pair[0]]=pair[1]})}else{headers=Object.assign({},init.headers)}}else if(input instanceof Request){input.headers.forEach(function(v,k){headers[k]=v})}var bodyPromise;if(init&&init.body!=null){if(typeof init.body==="string"){bodyPromise=Promise.resolve(init.body)}else{bodyPromise=new Response(init.body).text()}}else if(input instanceof Request&&method!=="GET"&&method!=="HEAD"){bodyPromise=input.text()}else{bodyPromise=Promise.resolve(undefined)}return bodyPromise.then(function(bodyStr){var payload={url,method,headers};if(bodyStr!==undefined)payload.body=bodyStr;if(sessionId)payload.sessionId=sessionId;return realFetch("/api/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)})}).then(function(proxyRes){if(!proxyRes.ok){return proxyRes.json().then(function(err){throw new Error(err.error||"Fetch proxy error: "+proxyRes.status)})}return proxyRes.json()}).then(function(data){var body;if(data.bodyEncoding==="base64"){var bin=atob(data.body);var bytes=new Uint8Array(bin.length);for(var i=0;i<bin.length;i++)bytes[i]=bin.charCodeAt(i);body=bytes.buffer}else{body=data.body}return new Response(body,{status:data.status,statusText:data.statusText,headers:data.headers})})}})();(function(){if(window.__yaarAppProtocolInstalled)return;window.__yaarAppProtocolInstalled=true;window.yaar=window.yaar||{};var registration=null;window.yaar.app={register:function(config){registration=config;window.parent.postMessage({type:"yaar:app-ready",appId:config.appId},"*")},sendInteraction:function(description){window.parent.postMessage({type:"yaar:app-interaction",content:typeof description==="string"?description:JSON.stringify(description)},"*")}};window.addEventListener("message",function(e){if(!e.data||!e.data.type)return;var msg=e.data;var requestId=msg.requestId;if(msg.type==="yaar:app-manifest-request"){if(!registration){window.parent.postMessage({type:"yaar:app-manifest-response",requestId,manifest:null,error:"No app registered"},"*");return}var manifest={appId:registration.appId,name:registration.name,state:{},commands:{}};if(registration.state){for(var key in registration.state){var s=registration.state[key];manifest.state[key]={description:s.description};if(s.schema)manifest.state[key].schema=s.schema}}if(registration.commands){for(var key in registration.commands){var c=registration.commands[key];manifest.commands[key]={description:c.description};if(c.params)manifest.commands[key].params=c.params;if(c.returns)manifest.commands[key].returns=c.returns}}window.parent.postMessage({type:"yaar:app-manifest-response",requestId,manifest},"*");return}if(msg.type==="yaar:app-query-request"){if(!registration||!registration.state||!registration.state[msg.stateKey]){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:"Unknown state key: "+msg.stateKey},"*");return}try{var result=registration.state[msg.stateKey].handler();if(result&&typeof result.then==="function"){result.then(function(data){window.parent.postMessage({type:"yaar:app-query-response",requestId,data},"*")}).catch(function(err){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:String(err)},"*")})}else{window.parent.postMessage({type:"yaar:app-query-response",requestId,data:result},"*")}}catch(err){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:String(err)},"*")}return}if(msg.type==="yaar:app-command-request"){if(!registration||!registration.commands||!registration.commands[msg.command]){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:"Unknown command: "+msg.command},"*");return}try{var result=registration.commands[msg.command].handler(msg.params);if(result&&typeof result.then==="function"){result.then(function(data){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:data},"*")}).catch(function(err){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:String(err)},"*")})}else{window.parent.postMessage({type:"yaar:app-command-response",requestId,result},"*")}}catch(err){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:String(err)},"*")}return}})})();</script>
</head>
<body>
<div id="app"></div>
<script type="module">
function p(Y){localStorage.setItem("slides-lite:draft",JSON.stringify(Y))}function n(){let Y=localStorage.getItem("slides-lite:draft");if(!Y)return null;try{return JSON.parse(Y)}catch{return null}}var T=()=>globalThis.crypto&&("randomUUID"in globalThis.crypto)?globalThis.crypto.randomUUID():`id-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,10)}`;function t(Y,J){let N=Date.now()-Y,X=Math.max(1,Math.floor(Math.abs(N)/1000)),Z=[[60,"second"],[60,"minute"],[24,"hour"],[30,"day"],[12,"month"],[1/0,"year"]],G=X,$="second";for(let[q,O]of Z){if($=O,G<q)break;G=Math.floor(G/q)}let F=`${G} ${$}${G===1?"":"s"}`;if(!J?.addSuffix)return F;return N>=0?`${F} ago`:`in ${F}`}var z={"classic-light":{name:"Classic Light",bg:"#ffffff",fg:"#1f2937",accent:"#2563eb",canvas:"linear-gradient(180deg, #eef2ff 0%, #f8fafc 100%)"},"midnight-dark":{name:"Midnight Dark",bg:"#111827",fg:"#f9fafb",accent:"#60a5fa",canvas:"linear-gradient(180deg, #0f172a 0%, #111827 100%)"},ocean:{name:"Ocean",bg:"#e0f2fe",fg:"#0c4a6e",accent:"#0284c7",canvas:"linear-gradient(180deg, #dbeafe 0%, #e0f2fe 100%)"},sunset:{name:"Sunset",bg:"#fff7ed",fg:"#7c2d12",accent:"#ea580c",canvas:"linear-gradient(180deg, #ffedd5 0%, #fff7ed 100%)"}},V=document.getElementById("app"),i=["16:9","4:3","1:1"];function v(Y){return H(typeof Y==="string"?Y:"16:9").normalized}function H(Y){let J=Y.trim().match(/^(\d+(?:\.\d+)?)\s*[:/]\s*(\d+(?:\.\d+)?)$/),N=J?Number(J[1]):16,X=J?Number(J[2]):9;if(!Number.isFinite(N)||!Number.isFinite(X)||N<=0||X<=0)return{width:16,height:9,cssValue:"16 / 9",normalized:"16:9",preset:"16:9"};let Z=Number(N.toFixed(3)),G=Number(X.toFixed(3)),$=`${Z}:${G}`,F=i.includes($)?$:"custom";return{width:Z,height:G,cssValue:`${Z} / ${G}`,normalized:$,preset:F}}var K=w(n()??s()),L=!1,Q=0,S=0,f=null,A="",D={dirty:!1,lastSavedAt:Date.now()},d=e(()=>W(!1),700);function e(Y,J=300){let N=null;return(...X)=>{if(N)window.clearTimeout(N);N=window.setTimeout(()=>Y(...X),J)}}function w(Y){let J=((Y.slides?.length)?Y.slides:[M()]).map((N)=>({id:N.id||T(),layout:N.layout||"title-body",title:N.title||"",body:N.body||"",imageUrl:N.imageUrl||"",notes:N.notes||""}));return{title:Y.title||"Untitled Deck",themeId:z[Y.themeId]?Y.themeId:"classic-light",slides:J,activeIndex:Math.min(Math.max(Y.activeIndex??0,0),J.length-1),aspectRatio:v(Y.aspectRatio)}}function M(Y="title-body"){return{id:T(),layout:Y,title:"New Slide",body:"",imageUrl:"",notes:""}}function s(){return{title:"Untitled Deck",themeId:"classic-light",slides:[M()],activeIndex:0,aspectRatio:"16:9"}}function a(Y){return typeof Y==="string"&&Y in z}function YY(Y){return Y==="title-body"||Y==="title-image"||Y==="section"}function C(Y){let J=Y??{};return{id:J.id||T(),layout:YY(J.layout)?J.layout:"title-body",title:J.title||"",body:J.body||"",imageUrl:J.imageUrl||"",notes:J.notes||""}}function JY(){return JSON.parse(JSON.stringify(K))}function P(){if(K.activeIndex<0)K.activeIndex=0;if(K.activeIndex>K.slides.length-1)K.activeIndex=K.slides.length-1}function I(){return P(),K.slides[K.activeIndex]}function B(){D.dirty=!0,u(),d()}function W(Y=!1){if(p(K),D.dirty=!1,D.lastSavedAt=Date.now(),u(),Y)XY("Saved")}function j(Y){return Y.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function KY(Y){try{let J=new URL(Y);if(J.protocol==="http:"||J.protocol==="https:")return J.toString();return null}catch{return null}}function E(Y){let J=[],N=(Z)=>{return J.push(Z),`@@TOK${J.length-1}@@`},X=Y.replace(/`([^`\n]+)`/g,(Z,G)=>N(`<code>${j(G)}</code>`)).replace(/\[([^\]]+)\]\(([^\s)]+)\)/g,(Z,G,$)=>{let F=KY($);if(!F)return N(j(G));return N(`<a href="${j(F)}" target="_blank" rel="noopener noreferrer">${j(G)}</a>`)});return X=j(X).replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/__(.+?)__/g,"<strong>$1</strong>").replace(/_(.+?)_/g,"<em>$1</em>"),X.replace(/@@TOK(\d+)@@/g,(Z,G)=>J[Number(G)]??"")}function NY(Y){return/(^#{1,6}\s)|(^>\s)|(^\s*[-*+]\s)|(^\s*\d+\.\s)|(\*\*)|(\*)|(`)|\[[^\]]+\]\([^\)]+\)|(^```)|(^---\s*$)/m.test(Y)}function h(Y){let J=Y||"";if(!NY(J))return`<p>${j(J).replaceAll(`
`,"<br/>")}</p>`;let N=J.replaceAll(`\r
`,`
`).split(`
`),X=[],Z=!1,G=!1,$=!1,F=[],q=()=>{if(Z)X.push("</ul>"),Z=!1;if(G)X.push("</ol>"),G=!1},O=()=>{if(!$)return;X.push(`<pre><code>${j(F.join(`
`))}</code></pre>`),$=!1,F=[]};for(let U of N){if(U.trim().startsWith("```")){if(q(),$)O();else $=!0,F=[];continue}if($){F.push(U);continue}if(!U.trim()){q();continue}let x=U.match(/^(#{1,6})\s+(.+)$/);if(x){q();let c=x[1].length;X.push(`<h${c}>${E(x[2])}</h${c}>`);continue}let m=U.match(/^\s*[-*+]\s+(.+)$/);if(m){if(G)X.push("</ol>"),G=!1;if(!Z)X.push("<ul>"),Z=!0;X.push(`<li>${E(m[1])}</li>`);continue}let k=U.match(/^\s*\d+\.\s+(.+)$/);if(k){if(Z)X.push("</ul>"),Z=!1;if(!G)X.push("<ol>"),G=!0;X.push(`<li>${E(k[1])}</li>`);continue}if(/^---\s*$/.test(U)){q(),X.push("<hr/>");continue}let o=U.match(/^>\s?(.+)$/);if(o){q(),X.push(`<blockquote>${E(o[1])}</blockquote>`);continue}q(),X.push(`<p>${E(U)}</p>`)}return q(),O(),X.length?X.join(""):"<p></p>"}function y(Y,J){let N=z[J],X=Y.imageUrl?`<img src="${Y.imageUrl}" style="max-width:100%; max-height:260px; border-radius:12px; margin-top:12px; box-shadow:0 8px 20px rgba(0,0,0,.15);"/>`:"";if(Y.layout==="section")return`<div class="slide section" style="background:${N.bg};color:${N.fg};border-top:10px solid ${N.accent};">
      <h1>${j(Y.title||"Section")}</h1>
      <div class="slide-body">${h(Y.body||"")}</div>
    </div>`;if(Y.layout==="title-image")return`<div class="slide" style="background:${N.bg};color:${N.fg};border-top:10px solid ${N.accent};">
      <h1>${j(Y.title||"Title")}</h1>
      ${X||'<div style="opacity:.65; padding:8px 0;">No image selected</div>'}
      <div class="slide-body">${h(Y.body||"")}</div>
    </div>`;return`<div class="slide" style="background:${N.bg};color:${N.fg};border-top:10px solid ${N.accent};">
    <h1>${j(Y.title||"Title")}</h1>
    <div class="slide-body">${h(Y.body||"")}</div>
  </div>`}function _(){if(!K.slides.length)K.slides.push(M());P();let Y=z[K.themeId],J=I(),N=H(K.aspectRatio);V.innerHTML=`
    <style>
      * { box-sizing: border-box; }
      body { margin: 0; font-family: Inter, system-ui, Arial, sans-serif; color: #111827; }
      input, textarea, select, button { font: inherit; }
      .root { height: 100vh; display: grid; grid-template-rows: 62px 1fr; background: #f8fafc; }
      .topbar {
        display: flex; align-items: center; gap: 8px; padding: 10px 12px;
        border-bottom: 1px solid #e5e7eb; background: rgba(255,255,255,0.92); backdrop-filter: blur(6px);
      }
      .topbar input, .topbar select, .topbar button, .panel input, .panel textarea, .panel select, .left input {
        border: 1px solid #d1d5db; border-radius: 10px; padding: 8px 10px; font-size: 13px;
      }
      .topbar button, .panel button, .thumb-actions button { cursor: pointer; background: white; }
      .topbar button.primary { background: #111827; color: white; border-color: #111827; }
      .topbar button:focus-visible, .panel button:focus-visible { outline: 2px solid #93c5fd; outline-offset: 1px; }
      .chip { font-size: 12px; border-radius: 999px; padding: 5px 10px; background: #eef2ff; color: #1d4ed8; }
      .chip.dirty { background: #fef3c7; color: #92400e; }
      .main { display: grid; grid-template-columns: 260px 1fr 320px; height: calc(100vh - 62px); }
      .left { border-right: 1px solid #e5e7eb; overflow: auto; padding: 10px; background: #ffffff; }
      .left-head { display:grid; gap:8px; margin-bottom: 8px; }
      .left small { color:#6b7280; font-size:11px; }
      .thumb {
        border: 1px solid #d1d5db; border-radius: 12px; padding: 10px; margin-bottom: 8px; cursor: pointer;
        background: white; transition: transform .12s ease, box-shadow .12s ease;
      }
      .thumb:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,.07); }
      .thumb.active { border-color: #2563eb; box-shadow: 0 0 0 1px #2563eb inset; }
      .thumb h4 { margin: 0 0 4px; font-size: 12px; }
      .thumb p { margin: 0; font-size: 11px; color: #6b7280; min-height: 28px; }
      .thumb-badges { margin-top:6px; display:flex; align-items:center; justify-content:space-between; }
      .thumb-badge { font-size: 10px; color:#334155; background:#e2e8f0; border-radius:999px; padding:2px 6px; }
      .thumb-actions { display: flex; gap: 4px; }
      .thumb-actions button { font-size: 11px; padding: 3px 6px; }
      .center { display: grid; place-items: center; background: ${Y.canvas}; padding: 18px; transition: background .18s ease; }
      .slide {
        width: min(980px, 100%); aspect-ratio: ${N.cssValue}; border-radius: 16px;
        padding: 38px; overflow: auto; box-shadow: 0 16px 42px rgba(0,0,0,.18);
      }
      .slide h1 { margin-top: 0; margin-bottom: 14px; font-size: clamp(24px, 4vw, 44px); }
      .slide-body { font-size: clamp(14px, 1.7vw, 26px); line-height: 1.35; }
      .slide-body p { margin: 0 0 10px; }
      .slide-body ul, .slide-body ol { margin: 0 0 12px 1.2em; padding: 0; }
      .slide-body li { margin: 0 0 6px; }
      .slide-body h2, .slide-body h3, .slide-body h4, .slide-body h5, .slide-body h6 { margin: 8px 0 8px; }
      .slide-body blockquote { margin: 8px 0; padding: 6px 12px; border-left: 4px solid ${Y.accent}; opacity: 0.92; }
      .slide-body code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: rgba(148, 163, 184, 0.18); border-radius: 5px; padding: 0 4px; }
      .slide-body pre { margin: 10px 0; padding: 10px 12px; border-radius: 10px; background: rgba(15, 23, 42, 0.08); overflow: auto; }
      .slide-body pre code { background: transparent; padding: 0; }
      .slide-body hr { border: 0; border-top: 1px solid rgba(100, 116, 139, 0.45); margin: 12px 0; }
      .slide-body a { color: ${Y.accent}; text-decoration: underline; }
      .panel { border-left: 1px solid #e5e7eb; padding: 12px; overflow: auto; background: #ffffff; }
      .field { margin-bottom: 10px; display: grid; gap: 6px; }
      .field label { font-size: 12px; color: #4b5563; font-weight: 600; display:flex; justify-content:space-between; }
      .panel textarea { min-height: 120px; resize: vertical; }
      .small { font-size: 11px; color: #64748b; }
      .present { position: fixed; inset: 0; z-index: 9999; background: #0b1020; display: grid; place-items: center; }
      .present-ui { position: fixed; bottom: 14px; left: 50%; transform: translateX(-50%); display:flex; gap:8px; align-items:center; }
      .present-ui button { border: 0; border-radius: 8px; padding: 8px 10px; cursor: pointer; }
      .present-pill { color: #e2e8f0; font-size: 12px; background: rgba(30,41,59,.7); border-radius:999px; padding:6px 10px; }
      .progress { position: fixed; top: 0; left: 0; height: 4px; background: #38bdf8; transition: width .15s linear; }
    </style>
    <div class="root">
      <div class="topbar">
        <input id="deckTitle" value="${j(K.title)}" style="min-width:220px;" />
        <select id="themeSelect">
          ${Object.entries(z).map(([X,Z])=>`<option value="${X}" ${X===K.themeId?"selected":""}>${Z.name}</option>`).join("")}
        </select>
        <select id="ratioSel" title="Slide ratio">
          ${i.map((X)=>`<option value="${X}" ${N.preset===X?"selected":""}>${X}</option>`).join("")}
          <option value="custom" ${N.preset==="custom"?"selected":""}>Custom</option>
        </select>
        <input id="ratioW" type="number" min="0.1" step="0.1" value="${N.width}" style="width:72px;" ${N.preset==="custom"?"":"disabled"} />
        <span>:</span>
        <input id="ratioH" type="number" min="0.1" step="0.1" value="${N.height}" style="width:72px;" ${N.preset==="custom"?"":"disabled"} />
        <button id="newDeckBtn">New</button>
        <button id="dupBtn">Duplicate</button>
        <button id="addBtn">Add Slide</button>
        <button id="saveBtn">Save</button>
        <button class="primary" id="presentBtn">Present</button>
        <button id="exportBtn">Export PDF</button>
        <span class="chip" id="saveBadge"></span>
      </div>
      <div class="main">
        <div class="left">
          <div class="left-head">
            <input id="filterIn" placeholder="Filter slides…" value="${j(A)}" />
            <small>Tip: Alt+↑ / Alt+↓ to reorder • Ctrl/Cmd+Enter to present</small>
          </div>
          <div id="thumbs"></div>
        </div>
        <div class="center" id="canvas"></div>
        <div class="panel">
          <div class="field"><label>Layout</label>
            <select id="layoutSel">
              <option value="title-body" ${J.layout==="title-body"?"selected":""}>Title + Body</option>
              <option value="title-image" ${J.layout==="title-image"?"selected":""}>Title + Image</option>
              <option value="section" ${J.layout==="section"?"selected":""}>Section</option>
            </select>
          </div>
          <div class="field"><label>Title <span class="small">${J.title.length} chars</span></label><input id="titleIn" value="${j(J.title)}"></div>
          <div class="field"><label>Body (Markdown supported) <span class="small">${J.body.length} chars</span></label><textarea id="bodyIn">${j(J.body)}</textarea></div>
          <div class="field"><label>Speaker Notes</label><textarea id="notesIn" placeholder="Private presenter notes…">${j(J.notes)}</textarea></div>
          <div class="field"><label>Image URL</label><input id="imgIn" placeholder="https://..." value="${j(J.imageUrl)}"></div>
          <div class="field" style="display:flex; gap:8px;"><button id="delBtn">Delete Slide</button><button id="sectionBtn">Quick Section</button></div>
          <div class="small">Autosave enabled. Notes are hidden in exported slides.</div>
        </div>
      </div>
    </div>
  `,R(),g(!0),GY(),u()}function R(){let Y=V.querySelector("#thumbs"),J=A.trim().toLowerCase();Y.innerHTML="",K.slides.forEach((N,X)=>{let Z=`${N.title} ${N.body} ${N.notes}`.toLowerCase();if(J&&!Z.includes(J))return;let G=document.createElement("div");G.className=`thumb ${X===K.activeIndex?"active":""}`,G.innerHTML=`
      <h4>${X+1}. ${j(N.title||"Untitled")}</h4>
      <p>${j((N.body||"").slice(0,72))}</p>
      <div class="thumb-badges">
        <span class="thumb-badge">${j(N.layout)}</span>
        <div class="thumb-actions">
          <button data-act="up" data-idx="${X}">↑</button>
          <button data-act="down" data-idx="${X}">↓</button>
        </div>
      </div>
    `,G.addEventListener("click",($)=>{if($.target.tagName.toLowerCase()==="button")return;K.activeIndex=X,_()}),G.querySelectorAll("button").forEach(($)=>{$.addEventListener("click",(F)=>{F.stopPropagation();let q=F.currentTarget,O=Number(q.dataset.idx);if(q.dataset.act==="up")b(O,O-1);if(q.dataset.act==="down")b(O,O+1)})}),Y.appendChild(G)})}function b(Y,J){if(J<0||J>=K.slides.length||Y===J)return;let[N]=K.slides.splice(Y,1);K.slides.splice(J,0,N),K.activeIndex=J,B(),_()}function g(Y=!1){let J=V.querySelector("#canvas");if(J.innerHTML=y(I(),K.themeId),Y){let N=J.querySelector(".slide");if(N)N.animate([{opacity:0,transform:"translateY(16px)"},{opacity:1,transform:"translateY(0px)"}],{duration:260,easing:"cubic-bezier(0.22, 1, 0.36, 1)"})}}function GY(){let Y=I();V.querySelector("#deckTitle").oninput=(G)=>{K.title=G.target.value,B()},V.querySelector("#themeSelect").onchange=(G)=>{K.themeId=G.target.value,B(),_()};let J=V.querySelector("#ratioSel"),N=V.querySelector("#ratioW"),X=V.querySelector("#ratioH");J.onchange=(G)=>{let $=G.target.value;if($==="custom"){N.disabled=!1,X.disabled=!1;let F=H(K.aspectRatio);K.aspectRatio=`${F.width}:${F.height}`}else N.disabled=!0,X.disabled=!0,K.aspectRatio=$;B(),_()};let Z=()=>{if(J.value!=="custom")return;let G=Number(N.value),$=Number(X.value);if(!Number.isFinite(G)||!Number.isFinite($)||G<=0||$<=0)return;K.aspectRatio=`${Number(G.toFixed(3))}:${Number($.toFixed(3))}`,B(),_()};N.oninput=Z,X.oninput=Z,V.querySelector("#layoutSel").onchange=(G)=>{Y.layout=G.target.value,B(),_()},V.querySelector("#titleIn").oninput=(G)=>{Y.title=G.target.value,B(),g(),R()},V.querySelector("#bodyIn").oninput=(G)=>{Y.body=G.target.value,B(),g(),R()},V.querySelector("#notesIn").oninput=(G)=>{Y.notes=G.target.value,B(),R()},V.querySelector("#imgIn").oninput=(G)=>{Y.imageUrl=G.target.value,B(),g()},V.querySelector("#filterIn").oninput=(G)=>{A=G.target.value,R()},V.querySelector("#addBtn").onclick=()=>{K.slides.splice(K.activeIndex+1,0,M()),K.activeIndex+=1,B(),_()},V.querySelector("#sectionBtn").onclick=()=>{let G=M("section");G.title="Section Title",G.body="Add key message",K.slides.splice(K.activeIndex+1,0,G),K.activeIndex+=1,B(),_()},V.querySelector("#dupBtn").onclick=()=>{let G=I();K.slides.splice(K.activeIndex+1,0,{...G,id:T(),title:`${G.title} (copy)`}),K.activeIndex+=1,B(),_()},V.querySelector("#delBtn").onclick=()=>{if(K.slides.length===1)K.slides[0]=M(),K.activeIndex=0;else K.slides.splice(K.activeIndex,1),P();B(),_()},V.querySelector("#newDeckBtn").onclick=()=>{K=s(),A="",B(),_()},V.querySelector("#saveBtn").onclick=()=>W(!0),V.querySelector("#presentBtn").onclick=()=>{L=!0,Q=K.activeIndex,S=Date.now(),r()},V.querySelector("#exportBtn").onclick=ZY}function u(){let Y=V.querySelector("#saveBadge");if(!Y)return;if(D.dirty){Y.classList.add("dirty"),Y.textContent="Saving…";return}Y.classList.remove("dirty"),Y.textContent=`Saved ${t(D.lastSavedAt,{addSuffix:!0})}`}function XY(Y){let J=document.createElement("div");J.textContent=Y,J.style.cssText="position:fixed;top:14px;right:14px;background:#111827;color:white;padding:9px 12px;border-radius:10px;z-index:99999",document.body.appendChild(J),J.animate([{opacity:0,transform:"translateY(-10px)"},{opacity:1,transform:"translateY(0px)"}],{duration:220,easing:"ease-out"}),setTimeout(()=>{let N=J.animate([{opacity:1,transform:"translateY(0px)"},{opacity:0,transform:"translateY(-6px)"}],{duration:180,easing:"ease-in"});N.onfinish=()=>J.remove()},900)}function r(){if(!L)return;let Y=K.slides[Q],J=document.createElement("div");J.className="present",J.innerHTML=`
    <div class="progress" id="presentProgress" style="width:${(Q+1)/K.slides.length*100}%"></div>
    <div style="width:min(1200px,96vw);" id="presentSlideWrap">${y(Y,K.themeId)}</div>
    <div class="present-ui">
      <span class="present-pill" id="presentCounter">${Q+1} / ${K.slides.length}</span>
      <span class="present-pill" id="presentTimer">00:00</span>
      <button id="prevP">Prev</button>
      <button id="nextP">Next</button>
      <button id="exitP">Exit</button>
    </div>
  `,document.body.appendChild(J);let N=()=>{let G=J.querySelector("#presentSlideWrap");G.innerHTML=y(K.slides[Q],K.themeId);let $=J.querySelector("#presentProgress");$.style.width=`${(Q+1)/K.slides.length*100}%`;let F=J.querySelector("#presentCounter");F.textContent=`${Q+1} / ${K.slides.length}`,G.querySelector(".slide")?.animate([{opacity:0.3,transform:"translateX(10px)"},{opacity:1,transform:"translateX(0px)"}],{duration:200,easing:"cubic-bezier(0.22, 1, 0.36, 1)"})},X=()=>{if(L=!1,f)window.clearInterval(f);f=null,J.remove(),window.removeEventListener("keydown",Z)},Z=(G)=>{if(!L)return;if(G.key==="Escape")X();if(G.key==="ArrowRight"&&Q<K.slides.length-1)Q+=1,N();if(G.key==="ArrowLeft"&&Q>0)Q-=1,N()};f=window.setInterval(()=>{let G=J.querySelector("#presentTimer");if(!G)return;let $=Math.floor((Date.now()-S)/1000),F=String(Math.floor($/60)).padStart(2,"0"),q=String($%60).padStart(2,"0");G.textContent=`${F}:${q}`},1000),window.addEventListener("keydown",Z),J.querySelector("#prevP").onclick=()=>{if(Q>0)Q-=1;N()},J.querySelector("#nextP").onclick=()=>{if(Q<K.slides.length-1)Q+=1;N()},J.querySelector("#exitP").onclick=X}function ZY(){let Y=H(K.aspectRatio),J=`
    <html>
      <head>
        <title>${j(K.title)}</title>
        <style>
          body { margin:0; font-family: Inter, Arial, sans-serif; }
          .page { page-break-after: always; padding: 24px; }
          .slide { width: 100%; aspect-ratio: ${Y.cssValue}; border-radius: 12px; padding: 32px; box-sizing: border-box; }
          .slide h1 { margin:0 0 12px; font-size: 42px; }
          .slide-body { font-size: 24px; line-height: 1.35; }
          .slide-body p { margin: 0 0 10px; }
          .slide-body ul, .slide-body ol { margin: 0 0 12px 1.2em; padding: 0; }
          .slide-body li { margin: 0 0 6px; }
          .slide-body blockquote { margin: 8px 0; padding: 6px 12px; border-left: 4px solid #475569; }
          .slide-body code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
          .slide-body pre { margin: 10px 0; padding: 10px 12px; border-radius: 8px; background: rgba(15, 23, 42, 0.08); overflow: auto; }
          .slide-body a { color: #1d4ed8; text-decoration: underline; }
          @media print { .page:last-child { page-break-after: auto; } }
        </style>
      </head>
      <body>
        ${K.slides.map((X)=>`<div class="page">${y(X,K.themeId)}</div>`).join("")}
        <script>window.onload = () => window.print();<\/script>
      </body>
    </html>
  `,N=window.open("","_blank");if(!N){alert("Popup blocked. Please allow popups to export PDF.");return}N.document.open(),N.document.write(J),N.document.close()}window.addEventListener("keydown",(Y)=>{if((Y.ctrlKey||Y.metaKey)&&Y.key.toLowerCase()==="s")Y.preventDefault(),W(!0);if((Y.ctrlKey||Y.metaKey)&&Y.key==="Enter"&&!L)Y.preventDefault(),L=!0,Q=K.activeIndex,S=Date.now(),r();if(Y.altKey&&Y.key==="ArrowUp")Y.preventDefault(),b(K.activeIndex,K.activeIndex-1);if(Y.altKey&&Y.key==="ArrowDown")Y.preventDefault(),b(K.activeIndex,K.activeIndex+1)});_();W(!1);var l=window.yaar?.app;function $Y(Y,J){try{let N=JSON.parse(Y);if(Array.isArray(N)){let X=N.map((Z)=>C(Z));return{title:J,slides:X.length?X:[M()]}}if(N&&typeof N==="object"){let X=N;if(Array.isArray(X.slides)){let Z=w({title:X.title||J,themeId:a(X.themeId)?X.themeId:"classic-light",slides:X.slides.map((G)=>C(G)),activeIndex:typeof X.activeIndex==="number"?X.activeIndex:0,aspectRatio:v(X.aspectRatio)});return{title:Z.title,slides:Z.slides}}}}catch{}return{title:J,slides:[C({title:J,body:Y})]}}if(l)l.register({appId:"slides-lite",name:"Slides Lite",state:{deck:{description:"Current full deck object",handler:()=>JY()},activeSlide:{description:"Currently selected slide",handler:()=>({...I()})},title:{description:"Current deck title",handler:()=>K.title},theme:{description:"Current deck theme id",handler:()=>K.themeId},aspectRatio:{description:"Current slide aspect ratio (e.g., 16:9)",handler:()=>K.aspectRatio},activeIndex:{description:"Current active slide index",handler:()=>K.activeIndex},slideCount:{description:"Number of slides in the deck",handler:()=>K.slides.length}},commands:{setDeck:{description:"Replace entire deck. Params: { deck: Deck }",params:{type:"object",properties:{deck:{type:"object"}},required:["deck"]},handler:(Y)=>{return K=w(Y.deck),A="",W(!1),_(),{ok:!0,slideCount:K.slides.length}}},setSlides:{description:'Set slides in replace/append mode. Params: { slides: Slide[], mode?: "replace"|"append" }',params:{type:"object",properties:{slides:{type:"array",items:{type:"object"}},mode:{type:"string",enum:["replace","append"]}},required:["slides"]},handler:(Y)=>{let J=(Array.isArray(Y.slides)?Y.slides:[]).map((X)=>C(X)),N=Y.mode||"replace";if(N==="append"){if(J.length)K.slides.push(...J);K.activeIndex=Math.max(0,K.slides.length-1)}else K.slides=J.length?J:[M()],K.activeIndex=0;return P(),W(!1),_(),{ok:!0,mode:N,slideCount:K.slides.length}}},appendSlides:{description:"Append many slides at once. Params: { slides: Slide[] }",params:{type:"object",properties:{slides:{type:"array",items:{type:"object"}}},required:["slides"]},handler:(Y)=>{let J=(Array.isArray(Y.slides)?Y.slides:[]).map((N)=>C(N));if(J.length)K.slides.push(...J),K.activeIndex=K.slides.length-1,P(),W(!1),_();return{ok:!0,appended:J.length,slideCount:K.slides.length}}},setActiveIndex:{description:"Set active slide index. Params: { index: number }",params:{type:"object",properties:{index:{type:"number"}},required:["index"]},handler:(Y)=>{return K.activeIndex=Math.max(0,Math.min(Math.floor(Y.index),K.slides.length-1)),_(),{ok:!0,activeIndex:K.activeIndex}}},setTheme:{description:"Set deck theme. Params: { themeId: ThemeId }",params:{type:"object",properties:{themeId:{type:"string"}},required:["themeId"]},handler:(Y)=>{if(!a(Y.themeId))return{ok:!1,error:`Invalid themeId: ${String(Y.themeId)}`};return K.themeId=Y.themeId,W(!1),_(),{ok:!0,themeId:K.themeId}}},setAspectRatio:{description:"Set deck aspect ratio. Params: { aspectRatio: string }",params:{type:"object",properties:{aspectRatio:{type:"string"}},required:["aspectRatio"]},handler:(Y)=>{return K.aspectRatio=v(Y.aspectRatio),W(!1),_(),{ok:!0,aspectRatio:K.aspectRatio}}},saveToStorage:{description:"Save current deck JSON to YAAR storage. Params: { path: string }",params:{type:"object",properties:{path:{type:"string"}},required:["path"]},handler:async(Y)=>{let J=window.yaar?.storage;if(!J)return{ok:!1,error:"Storage API not available"};let N=JSON.stringify(K,null,2);return await J.save(Y.path,N),{ok:!0,path:Y.path,slideCount:K.slides.length}}},loadFromStorage:{description:'Load one/many files from YAAR storage and merge into deck. Params: { path?: string, paths?: string[], mode?: "replace"|"append" }',params:{type:"object",properties:{path:{type:"string"},paths:{type:"array",items:{type:"string"}},mode:{type:"string",enum:["replace","append"]}}},handler:async(Y)=>{let J=window.yaar?.storage;if(!J)return{ok:!1,error:"Storage API not available"};let N=[...Y.path?[Y.path]:[],...Array.isArray(Y.paths)?Y.paths:[]].filter(($)=>typeof $==="string"&&$.trim().length>0);if(!N.length)return{ok:!1,error:"Provide path or paths"};let X=[],Z=K.title;for(let $ of N){let F=await J.read($,{as:"text"}),q=($.split("/").pop()||$).replace(/\.[^/.]+$/,"")||"Imported Deck",O=$Y(F,q);if(!Z||Z==="Untitled Deck")Z=O.title||Z;X.push(...O.slides)}let G=Y.mode||"replace";if(G==="append"){if(X.length)K.slides.push(...X);K.activeIndex=Math.max(0,K.slides.length-1)}else K.slides=X.length?X:[M()],K.activeIndex=0,K.title=Z||K.title;return P(),W(!1),_(),{ok:!0,mode:G,loaded:X.length,paths:N}}},readStorageFile:{description:'Read one file from YAAR storage. Params: { path: string, as?: "text"|"json"|"auto" }',params:{type:"object",properties:{path:{type:"string"},as:{type:"string",enum:["text","json","auto"]}},required:["path"]},handler:async(Y)=>{let J=window.yaar?.storage;if(!J)return{ok:!1,error:"Storage API not available"};let N=Y.as||"text",X=await J.read(Y.path,{as:N});return{ok:!0,path:Y.path,as:N,content:X}}},readStorageFiles:{description:'Read many files from YAAR storage. Params: { paths: string[], as?: "text"|"json"|"auto" }',params:{type:"object",properties:{paths:{type:"array",items:{type:"string"}},as:{type:"string",enum:["text","json","auto"]}},required:["paths"]},handler:async(Y)=>{let J=window.yaar?.storage;if(!J)return{ok:!1,error:"Storage API not available"};let N=Y.as||"text",X=(Array.isArray(Y.paths)?Y.paths:[]).filter((G)=>typeof G==="string"&&G.trim().length>0),Z=await Promise.all(X.map(async(G)=>({path:G,content:await J.read(G,{as:N})})));return{ok:!0,as:N,files:Z}}}}});

</script>
</body>
</html>