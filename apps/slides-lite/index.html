<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>slides-lite</title>
<style>*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden}body{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}</style>
<script>(function(){if(window.__yaarCaptureInstalled)return;window.__yaarCaptureInstalled=!0;function s(r,n){window.parent.postMessage({type:"yaar:capture-response",requestId:r,imageData:n},"*")}function o(r,n){for(var d=r.querySelectorAll("*"),u=n.querySelectorAll("*"),i=0;i<d.length&&i<u.length;i++){var t=window.getComputedStyle(d[i]);u[i].setAttribute("style",t.cssText)}var a=window.getComputedStyle(r);n.setAttribute("style",a.cssText)}function e(r,n,d,u){var i=new Blob([r],{type:"image/svg+xml;charset=utf-8"}),t=URL.createObjectURL(i),a=new Image;a.onload=function(){var f=document.createElement("canvas");f.width=n,f.height=d;var p=f.getContext("2d");p.drawImage(a,0,0,n,d),URL.revokeObjectURL(t),u(f.toDataURL("image/png"))},a.onerror=function(){URL.revokeObjectURL(t),u(null)},a.src=t}window.addEventListener("message",function(r){if(!(!r.data||r.data.type!=="yaar:capture-request")){var n=r.data.requestId,d=null;try{var u=document.querySelectorAll("canvas");if(u.length>0){for(var i=null,t=0,a=0;a<u.length;a++){var f=u[a].width*u[a].height;f>t&&(t=f,i=u[a])}i&&(d=i.toDataURL("image/png"))}if(d){s(n,d);return}var p=document.querySelectorAll("svg");if(p.length>0){for(var i=null,t=0,a=0;a<p.length;a++){var c=p[a].getBoundingClientRect(),f=c.width*c.height;f>t&&(t=f,i=p[a])}if(i){var v=new XMLSerializer,w=v.serializeToString(i),c=i.getBoundingClientRect();e(w,c.width||300,c.height||150,function(j){s(n,j)});return}}var l=document.body;if(l){var h=Math.min(l.scrollWidth,window.innerWidth)||window.innerWidth||800,g=Math.min(l.scrollHeight,window.innerHeight)||window.innerHeight||600,y=l.cloneNode(!0);o(l,y);for(var m=y.querySelectorAll("script,iframe"),a=0;a<m.length;a++)m[a].remove();var q="http://www.w3.org/1999/xhtml",b="http://www.w3.org/2000/svg",I=new XMLSerializer().serializeToString(y),w='<svg xmlns="'+b+'" width="'+h+'" height="'+g+'"><foreignObject width="100%" height="100%"><body xmlns="'+q+'" style="margin:0;padding:0;">'+I+"</body></foreignObject></svg>";e(w,h,g,function(S){s(n,S)});return}}catch{}s(n,null)}})})(),function(){if(window.__yaarStorageInstalled)return;window.__yaarStorageInstalled=!0;function s(o){return o.split("/").map(encodeURIComponent).join("/")}window.yaar=window.yaar||{},window.yaar.storage={async save(o,e){var r;typeof e=="string"?r=e:e instanceof Blob?r=await e.arrayBuffer():e instanceof ArrayBuffer?r=e:e instanceof Uint8Array?r=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):r=String(e);var n=await fetch("/api/storage/"+s(o),{method:"POST",body:r});if(!n.ok){var d=await n.json().catch(function(){return{error:n.statusText}});throw new Error(d.error||"Save failed")}return n.json()},async read(o,e){var r=e&&e.as||"auto",n=await fetch("/api/storage/"+s(o));if(!n.ok){var d=await n.json().catch(function(){return{error:n.statusText}});throw new Error(d.error||"Read failed")}if(r==="blob")return n.blob();if(r==="arraybuffer")return n.arrayBuffer();if(r==="json")return n.json();if(r==="text")return n.text();var u=n.headers.get("content-type")||"";return u.includes("json")?n.json():u.startsWith("text/")?n.text():n.blob()},async list(o){var e=o?s(o):"",r=await fetch("/api/storage/"+e+"?list=true");if(!r.ok){var n=await r.json().catch(function(){return{error:r.statusText}});throw new Error(n.error||"List failed")}return r.json()},async remove(o){var e=await fetch("/api/storage/"+s(o),{method:"DELETE"});if(!e.ok){var r=await e.json().catch(function(){return{error:e.statusText}});throw new Error(r.error||"Delete failed")}return e.json()},url:function(o){return"/api/storage/"+s(o)}}}(),function(){if(!window.__yaarFetchProxyInstalled){window.__yaarFetchProxyInstalled=!0;var s=window.fetch.bind(window);window.fetch=function(o,e){var r;if(o instanceof Request?r=o.url:r=String(o),r.startsWith("/")||r.startsWith("./")||r.startsWith("../"))return s(o,e);try{var n=new URL(r,location.origin);if(n.origin===location.origin)return s(o,e)}catch{return s(o,e)}var d=e&&e.method||(o instanceof Request?o.method:"GET"),u={};e&&e.headers?e.headers instanceof Headers?e.headers.forEach(function(t,a){u[a]=t}):Array.isArray(e.headers)?e.headers.forEach(function(t){u[t[0]]=t[1]}):u=Object.assign({},e.headers):o instanceof Request&&o.headers.forEach(function(t,a){u[a]=t});var i;return e&&e.body!=null?typeof e.body=="string"?i=Promise.resolve(e.body):i=new Response(e.body).text():o instanceof Request&&d!=="GET"&&d!=="HEAD"?i=o.text():i=Promise.resolve(void 0),i.then(function(t){var a={url:r,method:d,headers:u};return t!==void 0&&(a.body=t),s("/api/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}).then(function(t){return t.ok?t.json():t.json().then(function(a){throw new Error(a.error||"Fetch proxy error: "+t.status)})}).then(function(t){var a;if(t.bodyEncoding==="base64"){for(var f=atob(t.body),p=new Uint8Array(f.length),c=0;c<f.length;c++)p[c]=f.charCodeAt(c);a=p.buffer}else a=t.body;return new Response(a,{status:t.status,statusText:t.statusText,headers:t.headers})})}}}(),function(){if(!window.__yaarAppProtocolInstalled){window.__yaarAppProtocolInstalled=!0,window.yaar=window.yaar||{};var s=null;window.yaar.app={register:function(o){s=o,window.parent.postMessage({type:"yaar:app-ready",appId:o.appId},"*")},sendInteraction:function(o){window.parent.postMessage({type:"yaar:app-interaction",content:typeof o=="string"?o:JSON.stringify(o)},"*")}},window.addEventListener("message",function(o){if(!(!o.data||!o.data.type)){var e=o.data,r=e.requestId;if(e.type==="yaar:app-manifest-request"){if(!s){window.parent.postMessage({type:"yaar:app-manifest-response",requestId:r,manifest:null,error:"No app registered"},"*");return}var n={appId:s.appId,name:s.name,state:{},commands:{}};if(s.state)for(var d in s.state){var u=s.state[d];n.state[d]={description:u.description},u.schema&&(n.state[d].schema=u.schema)}if(s.commands)for(var d in s.commands){var i=s.commands[d];n.commands[d]={description:i.description},i.params&&(n.commands[d].params=i.params),i.returns&&(n.commands[d].returns=i.returns)}window.parent.postMessage({type:"yaar:app-manifest-response",requestId:r,manifest:n},"*");return}if(e.type==="yaar:app-query-request"){if(!s||!s.state||!s.state[e.stateKey]){window.parent.postMessage({type:"yaar:app-query-response",requestId:r,data:null,error:"Unknown state key: "+e.stateKey},"*");return}try{var t=s.state[e.stateKey].handler();t&&typeof t.then=="function"?t.then(function(a){window.parent.postMessage({type:"yaar:app-query-response",requestId:r,data:a},"*")}).catch(function(a){window.parent.postMessage({type:"yaar:app-query-response",requestId:r,data:null,error:String(a)},"*")}):window.parent.postMessage({type:"yaar:app-query-response",requestId:r,data:t},"*")}catch(a){window.parent.postMessage({type:"yaar:app-query-response",requestId:r,data:null,error:String(a)},"*")}return}if(e.type==="yaar:app-command-request"){if(!s||!s.commands||!s.commands[e.command]){window.parent.postMessage({type:"yaar:app-command-response",requestId:r,result:null,error:"Unknown command: "+e.command},"*");return}try{var t=s.commands[e.command].handler(e.params);t&&typeof t.then=="function"?t.then(function(f){window.parent.postMessage({type:"yaar:app-command-response",requestId:r,result:f},"*")}).catch(function(f){window.parent.postMessage({type:"yaar:app-command-response",requestId:r,result:null,error:String(f)},"*")}):window.parent.postMessage({type:"yaar:app-command-response",requestId:r,result:t},"*")}catch(a){window.parent.postMessage({type:"yaar:app-command-response",requestId:r,result:null,error:String(a)},"*")}return}}})}}();</script>
</head>
<body>
<div id="app"></div>
<script type="module">
var S="slides-lite:draft";function k(i){localStorage.setItem(S,JSON.stringify(i))}function T(){let i=localStorage.getItem(S);if(!i)return null;try{return JSON.parse(i)}catch{return null}}var y={"classic-light":{name:"Classic Light",bg:"#ffffff",fg:"#1f2937",accent:"#2563eb"},"midnight-dark":{name:"Midnight Dark",bg:"#111827",fg:"#f9fafb",accent:"#60a5fa"},ocean:{name:"Ocean",bg:"#e0f2fe",fg:"#0c4a6e",accent:"#0284c7"},sunset:{name:"Sunset",bg:"#fff7ed",fg:"#7c2d12",accent:"#ea580c"}},l=document.getElementById("app");function I(){return Math.random().toString(36).slice(2,10)}function b(i="title-body"){return{id:I(),layout:i,title:"New Slide",body:"",imageUrl:""}}function L(){return{title:"Untitled Deck",themeId:"classic-light",slides:[b()],activeIndex:0}}var e=T()??L(),m=!1,s=0;function w(){e.activeIndex<0&&(e.activeIndex=0),e.activeIndex>e.slides.length-1&&(e.activeIndex=e.slides.length-1)}function u(){k(e)}function h(){return w(),e.slides[e.activeIndex]}function g(i,t){let n=y[t],a=i.imageUrl?`<img src="${i.imageUrl}" style="max-width:100%; max-height:260px; border-radius:10px; margin-top:12px;"/>`:"";return i.layout==="section"?`<div class="slide section" style="background:${n.bg};color:${n.fg};border-top:10px solid ${n.accent};">
      <h1>${o(i.title||"Section")}</h1>
      <p>${o(i.body||"")}</p>
    </div>`:i.layout==="title-image"?`<div class="slide" style="background:${n.bg};color:${n.fg};border-top:10px solid ${n.accent};">
      <h1>${o(i.title||"Title")}</h1>
      ${a||'<div style="opacity:.6">No image selected</div>'}
      <p>${o(i.body||"")}</p>
    </div>`:`<div class="slide" style="background:${n.bg};color:${n.fg};border-top:10px solid ${n.accent};">
    <h1>${o(i.title||"Title")}</h1>
    <p>${o(i.body||"")}</p>
  </div>`}function o(i){return i.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function r(){e.slides.length||e.slides.push(b()),w();let i=y[e.themeId],t=h();l.innerHTML=`
    <style>
      * { box-sizing: border-box; }
      body { margin: 0; font-family: Inter, system-ui, Arial, sans-serif; }
      .root { height: 100vh; display: grid; grid-template-rows: 56px 1fr; }
      .topbar {
        display: flex; align-items: center; gap: 8px; padding: 10px 12px;
        border-bottom: 1px solid #e5e7eb; background: #f9fafb;
      }
      .topbar input, .topbar select, .topbar button, .panel input, .panel textarea, .panel select {
        border: 1px solid #d1d5db; border-radius: 8px; padding: 7px 9px; font-size: 13px;
      }
      .topbar button { cursor: pointer; background: white; }
      .topbar button.primary { background: #111827; color: white; border-color: #111827; }
      .main { display: grid; grid-template-columns: 220px 1fr 280px; height: calc(100vh - 56px); }
      .left { border-right: 1px solid #e5e7eb; overflow: auto; padding: 10px; }
      .thumb { border: 1px solid #d1d5db; border-radius: 10px; padding: 8px; margin-bottom: 8px; cursor: pointer; background: white; }
      .thumb.active { border-color: #2563eb; box-shadow: 0 0 0 1px #2563eb inset; }
      .thumb h4 { margin: 0 0 4px; font-size: 12px; }
      .thumb p { margin: 0; font-size: 11px; color: #6b7280; }
      .thumb-actions { margin-top: 6px; display: flex; gap: 4px; }
      .thumb-actions button { font-size: 11px; padding: 4px 6px; }
      .center { display: grid; place-items: center; background: #f3f4f6; padding: 18px; }
      .slide {
        width: min(900px, 100%); aspect-ratio: 16 / 9; border-radius: 14px;
        padding: 36px; overflow: auto; box-shadow: 0 10px 40px rgba(0,0,0,.12);
      }
      .slide h1 { margin-top: 0; margin-bottom: 14px; font-size: clamp(24px, 4vw, 44px); }
      .slide p { font-size: clamp(14px, 1.7vw, 26px); line-height: 1.35; white-space: pre-wrap; }
      .panel { border-left: 1px solid #e5e7eb; padding: 12px; overflow: auto; }
      .field { margin-bottom: 10px; display: grid; gap: 6px; }
      .field label { font-size: 12px; color: #4b5563; font-weight: 600; }
      .panel textarea { min-height: 140px; resize: vertical; }
      .muted { font-size: 12px; color: #6b7280; }
      .present {
        position: fixed; inset: 0; z-index: 9999; background: #0b1020; display: grid; place-items: center;
      }
      .present-ui { position: fixed; bottom: 14px; left: 50%; transform: translateX(-50%); display:flex; gap:8px; }
      .present-ui button { border: 0; border-radius: 8px; padding: 8px 10px; cursor: pointer; }
    </style>
    <div class="root">
      <div class="topbar">
        <input id="deckTitle" value="${o(e.title)}" style="min-width:220px;" />
        <select id="themeSelect">
          ${Object.entries(y).map(([a,c])=>`<option value="${a}" ${a===e.themeId?"selected":""}>${c.name}</option>`).join("")}
        </select>
        <button id="newDeckBtn">New</button>
        <button id="dupBtn">Duplicate Slide</button>
        <button id="addBtn">Add Slide</button>
        <button id="saveBtn">Save</button>
        <button class="primary" id="presentBtn">Present</button>
        <button id="exportBtn">Export PDF</button>
        <span class="muted" style="margin-left:auto;">${e.slides.length} slides</span>
      </div>
      <div class="main">
        <div class="left" id="thumbs"></div>
        <div class="center" id="canvas"></div>
        <div class="panel">
          <div class="field"><label>Layout</label>
            <select id="layoutSel">
              <option value="title-body" ${t.layout==="title-body"?"selected":""}>Title + Body</option>
              <option value="title-image" ${t.layout==="title-image"?"selected":""}>Title + Image</option>
              <option value="section" ${t.layout==="section"?"selected":""}>Section</option>
            </select>
          </div>
          <div class="field"><label>Title</label><input id="titleIn" value="${o(t.title)}"></div>
          <div class="field"><label>Body</label><textarea id="bodyIn">${o(t.body)}</textarea></div>
          <div class="field"><label>Image URL</label><input id="imgIn" placeholder="https://..." value="${o(t.imageUrl)}"></div>
          <div class="field"><button id="delBtn">Delete Slide</button></div>
          <div class="muted">Autosave is on. Tip: Ctrl/Cmd+S to save manually.</div>
        </div>
      </div>
    </div>
  `;let n=l.querySelector("#thumbs");n.innerHTML="",e.slides.forEach((a,c)=>{let p=document.createElement("div");p.className=`thumb ${c===e.activeIndex?"active":""}`,p.innerHTML=`<h4>${c+1}. ${o(a.title||"Untitled")}</h4><p>${o((a.body||"").slice(0,60))}</p>
      <div class="thumb-actions">
        <button data-act="up" data-idx="${c}">\u2191</button>
        <button data-act="down" data-idx="${c}">\u2193</button>
      </div>`,p.addEventListener("click",x=>{x.target.tagName.toLowerCase()!=="button"&&(e.activeIndex=c,r())}),p.querySelectorAll("button").forEach(x=>{x.addEventListener("click",f=>{f.stopPropagation();let v=f.currentTarget,d=Number(v.dataset.idx);v.dataset.act==="up"&&d>0&&([e.slides[d-1],e.slides[d]]=[e.slides[d],e.slides[d-1]],e.activeIndex=d-1),v.dataset.act==="down"&&d<e.slides.length-1&&([e.slides[d+1],e.slides[d]]=[e.slides[d],e.slides[d+1]],e.activeIndex=d+1),u(),r()})}),n.appendChild(p)}),l.querySelector("#canvas").innerHTML=g(t,e.themeId),$(),u()}function $(){let i=h();l.querySelector("#deckTitle").oninput=t=>{e.title=t.target.value,u()},l.querySelector("#themeSelect").onchange=t=>{e.themeId=t.target.value,r()},l.querySelector("#layoutSel").onchange=t=>{i.layout=t.target.value,r()},l.querySelector("#titleIn").oninput=t=>{i.title=t.target.value,r()},l.querySelector("#bodyIn").oninput=t=>{i.body=t.target.value,r()},l.querySelector("#imgIn").oninput=t=>{i.imageUrl=t.target.value,r()},l.querySelector("#addBtn").onclick=()=>{e.slides.splice(e.activeIndex+1,0,b()),e.activeIndex+=1,r()},l.querySelector("#dupBtn").onclick=()=>{let t=h();e.slides.splice(e.activeIndex+1,0,{...t,id:I(),title:`${t.title} (copy)`}),e.activeIndex+=1,r()},l.querySelector("#delBtn").onclick=()=>{e.slides.length===1?(e.slides[0]=b(),e.activeIndex=0):(e.slides.splice(e.activeIndex,1),w()),r()},l.querySelector("#newDeckBtn").onclick=()=>{e=L(),r()},l.querySelector("#saveBtn").onclick=()=>{u(),E("Saved")},l.querySelector("#presentBtn").onclick=()=>{m=!0,s=e.activeIndex,H()},l.querySelector("#exportBtn").onclick=M}function E(i){let t=document.createElement("div");t.textContent=i,t.style.cssText="position:fixed;top:14px;right:14px;background:#111827;color:white;padding:8px 10px;border-radius:8px;z-index:99999",document.body.appendChild(t),setTimeout(()=>t.remove(),1e3)}function H(){if(!m)return;let i=e.slides[s],t=document.createElement("div");t.className="present",t.innerHTML=`
    <div style="width:min(1200px,96vw);">${g(i,e.themeId)}</div>
    <div class="present-ui">
      <button id="prevP">Prev</button>
      <button id="nextP">Next</button>
      <button id="exitP">Exit</button>
    </div>
  `,document.body.appendChild(t);let n=()=>{m=!1,t.remove(),window.removeEventListener("keydown",c)},a=()=>{t.querySelector("div").innerHTML=g(e.slides[s],e.themeId)},c=p=>{m&&(p.key==="Escape"&&n(),p.key==="ArrowRight"&&s<e.slides.length-1&&(s+=1,a()),p.key==="ArrowLeft"&&s>0&&(s-=1,a()))};window.addEventListener("keydown",c),t.querySelector("#prevP").onclick=()=>{s>0&&(s-=1),a()},t.querySelector("#nextP").onclick=()=>{s<e.slides.length-1&&(s+=1),a()},t.querySelector("#exitP").onclick=n}function M(){let i=`
    <html>
      <head>
        <title>${o(e.title)}</title>
        <style>
          body { margin:0; font-family: Inter, Arial, sans-serif; }
          .page { page-break-after: always; padding: 24px; }
          .slide { width: 100%; aspect-ratio: 16/9; border-radius: 12px; padding: 32px; box-sizing: border-box; }
          .slide h1 { margin:0 0 12px; font-size: 42px; }
          .slide p { font-size: 24px; white-space: pre-wrap; }
          @media print { .page:last-child { page-break-after: auto; } }
        </style>
      </head>
      <body>
        ${e.slides.map(n=>`<div class="page">${g(n,e.themeId)}</div>`).join("")}
        <script>window.onload = () => window.print();<\/script>
      </body>
    </html>
  `,t=window.open("","_blank");if(!t)return alert("Popup blocked. Please allow popups to export PDF.");t.document.open(),t.document.write(i),t.document.close()}window.addEventListener("keydown",i=>{(i.ctrlKey||i.metaKey)&&i.key.toLowerCase()==="s"&&(i.preventDefault(),u(),E("Saved"))});r();

</script>
</body>
</html>