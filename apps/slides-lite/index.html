<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slides Lite</title>
<style>*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden}body{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}</style>
<script>(function(){if(window.__yaarCaptureInstalled)return;window.__yaarCaptureInstalled=true;function respond(requestId,imageData){window.parent.postMessage({type:"yaar:capture-response",requestId,imageData},"*")}function inlineStyles(original,clone){var origEls=original.querySelectorAll("*");var cloneEls=clone.querySelectorAll("*");for(var i=0;i<origEls.length&&i<cloneEls.length;i++){var cs=window.getComputedStyle(origEls[i]);cloneEls[i].setAttribute("style",cs.cssText)}var rootCs=window.getComputedStyle(original);clone.setAttribute("style",rootCs.cssText)}function svgToCanvas(svgStr,w,h,cb){var blob=new Blob([svgStr],{type:"image/svg+xml;charset=utf-8"});var url=URL.createObjectURL(blob);var img=new Image;img.onload=function(){var c=document.createElement("canvas");c.width=w;c.height=h;var ctx=c.getContext("2d");ctx.drawImage(img,0,0,w,h);URL.revokeObjectURL(url);cb(c.toDataURL("image/png"))};img.onerror=function(){URL.revokeObjectURL(url);cb(null)};img.src=url}window.addEventListener("message",function(e){if(!e.data||e.data.type!=="yaar:capture-request")return;var requestId=e.data.requestId;var imageData=null;try{var canvases=document.querySelectorAll("canvas");if(canvases.length>0){var largest=null;var largestArea=0;for(var i=0;i<canvases.length;i++){var area=canvases[i].width*canvases[i].height;if(area>largestArea){largestArea=area;largest=canvases[i]}}if(largest){imageData=largest.toDataURL("image/png")}}if(imageData){respond(requestId,imageData);return}var svgs=document.querySelectorAll("svg");if(svgs.length>0){var largest=null;var largestArea=0;for(var i=0;i<svgs.length;i++){var rect=svgs[i].getBoundingClientRect();var area=rect.width*rect.height;if(area>largestArea){largestArea=area;largest=svgs[i]}}if(largest){var serializer=new XMLSerializer;var svgStr=serializer.serializeToString(largest);var rect=largest.getBoundingClientRect();svgToCanvas(svgStr,rect.width||300,rect.height||150,function(data){respond(requestId,data)});return}}var body=document.body;if(body){var w=Math.min(body.scrollWidth,window.innerWidth)||window.innerWidth||800;var h=Math.min(body.scrollHeight,window.innerHeight)||window.innerHeight||600;var clone=body.cloneNode(true);inlineStyles(body,clone);var remove=clone.querySelectorAll("script,iframe");for(var i=0;i<remove.length;i++)remove[i].remove();var xmlns="http://www.w3.org/1999/xhtml";var svgNS="http://www.w3.org/2000/svg";var xhtml=new XMLSerializer().serializeToString(clone);var svgStr='<svg xmlns="'+svgNS+'" width="'+w+'" height="'+h+'">'+'<foreignObject width="100%" height="100%">'+'<body xmlns="'+xmlns+'" style="margin:0;padding:0;">'+xhtml+"</body></foreignObject></svg>";svgToCanvas(svgStr,w,h,function(data){respond(requestId,data)});return}}catch(ex){}respond(requestId,null)})})();(function(){if(window.__yaarStorageInstalled)return;window.__yaarStorageInstalled=true;function encodePath(p){return p.split("/").map(encodeURIComponent).join("/")}window.yaar=window.yaar||{};window.yaar.storage={async save(path,data){var body;if(typeof data==="string"){body=data}else if(data instanceof Blob){body=await data.arrayBuffer()}else if(data instanceof ArrayBuffer){body=data}else if(data instanceof Uint8Array){body=data.buffer.slice(data.byteOffset,data.byteOffset+data.byteLength)}else{body=String(data)}var res=await fetch("/api/storage/"+encodePath(path),{method:"POST",body});if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Save failed")}return res.json()},async read(path,options){var mode=options&&options.as||"auto";var res=await fetch("/api/storage/"+encodePath(path));if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Read failed")}if(mode==="blob")return res.blob();if(mode==="arraybuffer")return res.arrayBuffer();if(mode==="json")return res.json();if(mode==="text")return res.text();var ct=res.headers.get("content-type")||"";if(ct.includes("json"))return res.json();if(ct.startsWith("text/"))return res.text();return res.blob()},async list(dirPath){var p=dirPath?encodePath(dirPath):"";var res=await fetch("/api/storage/"+p+"?list=true");if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"List failed")}return res.json()},async remove(path){var res=await fetch("/api/storage/"+encodePath(path),{method:"DELETE"});if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Delete failed")}return res.json()},url:function(path){return"/api/storage/"+encodePath(path)}}})();(function(){if(window.__yaarFetchProxyInstalled)return;window.__yaarFetchProxyInstalled=true;var realFetch=window.fetch.bind(window);var sessionId="";try{var sp=new URLSearchParams(location.search);var raw=sp.get("sessionId")||"";if(/^[a-zA-Z0-9_-]+$/.test(raw))sessionId=raw}catch(e){}window.fetch=function(input,init){var url;if(input instanceof Request){url=input.url}else{url=String(input)}if(url.startsWith("/")||url.startsWith("./")||url.startsWith("../")){return realFetch(input,init)}try{var parsed=new URL(url,location.origin);if(parsed.origin===location.origin){return realFetch(input,init)}}catch(e){return realFetch(input,init)}var method=init&&init.method||(input instanceof Request?input.method:"GET");var headers={};if(init&&init.headers){if(init.headers instanceof Headers){init.headers.forEach(function(v,k){headers[k]=v})}else if(Array.isArray(init.headers)){init.headers.forEach(function(pair){headers[pair[0]]=pair[1]})}else{headers=Object.assign({},init.headers)}}else if(input instanceof Request){input.headers.forEach(function(v,k){headers[k]=v})}var bodyPromise;if(init&&init.body!=null){if(typeof init.body==="string"){bodyPromise=Promise.resolve(init.body)}else{bodyPromise=new Response(init.body).text()}}else if(input instanceof Request&&method!=="GET"&&method!=="HEAD"){bodyPromise=input.text()}else{bodyPromise=Promise.resolve(undefined)}return bodyPromise.then(function(bodyStr){var payload={url,method,headers};if(bodyStr!==undefined)payload.body=bodyStr;if(sessionId)payload.sessionId=sessionId;return realFetch("/api/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)})}).then(function(proxyRes){if(!proxyRes.ok){return proxyRes.json().then(function(err){throw new Error(err.error||"Fetch proxy error: "+proxyRes.status)})}return proxyRes.json()}).then(function(data){var body;if(data.bodyEncoding==="base64"){var bin=atob(data.body);var bytes=new Uint8Array(bin.length);for(var i=0;i<bin.length;i++)bytes[i]=bin.charCodeAt(i);body=bytes.buffer}else{body=data.body}return new Response(body,{status:data.status,statusText:data.statusText,headers:data.headers})})}})();(function(){if(window.__yaarAppProtocolInstalled)return;window.__yaarAppProtocolInstalled=true;window.yaar=window.yaar||{};var registration=null;window.yaar.app={register:function(config){registration=config;window.parent.postMessage({type:"yaar:app-ready",appId:config.appId},"*")},sendInteraction:function(description){window.parent.postMessage({type:"yaar:app-interaction",content:typeof description==="string"?description:JSON.stringify(description)},"*")}};window.addEventListener("message",function(e){if(!e.data||!e.data.type)return;var msg=e.data;var requestId=msg.requestId;if(msg.type==="yaar:app-manifest-request"){if(!registration){window.parent.postMessage({type:"yaar:app-manifest-response",requestId,manifest:null,error:"No app registered"},"*");return}var manifest={appId:registration.appId,name:registration.name,state:{},commands:{}};if(registration.state){for(var key in registration.state){var s=registration.state[key];manifest.state[key]={description:s.description};if(s.schema)manifest.state[key].schema=s.schema}}if(registration.commands){for(var key in registration.commands){var c=registration.commands[key];manifest.commands[key]={description:c.description};if(c.params)manifest.commands[key].params=c.params;if(c.returns)manifest.commands[key].returns=c.returns}}window.parent.postMessage({type:"yaar:app-manifest-response",requestId,manifest},"*");return}if(msg.type==="yaar:app-query-request"){if(!registration||!registration.state||!registration.state[msg.stateKey]){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:"Unknown state key: "+msg.stateKey},"*");return}try{var result=registration.state[msg.stateKey].handler();if(result&&typeof result.then==="function"){result.then(function(data){window.parent.postMessage({type:"yaar:app-query-response",requestId,data},"*")}).catch(function(err){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:String(err)},"*")})}else{window.parent.postMessage({type:"yaar:app-query-response",requestId,data:result},"*")}}catch(err){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:String(err)},"*")}return}if(msg.type==="yaar:app-command-request"){if(!registration||!registration.commands||!registration.commands[msg.command]){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:"Unknown command: "+msg.command},"*");return}try{var result=registration.commands[msg.command].handler(msg.params);if(result&&typeof result.then==="function"){result.then(function(data){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:data},"*")}).catch(function(err){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:String(err)},"*")})}else{window.parent.postMessage({type:"yaar:app-command-response",requestId,result},"*")}}catch(err){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:String(err)},"*")}return}})})();</script>
</head>
<body>
<div id="app"></div>
<script type="module">
function B(t){localStorage.setItem("slides-lite:draft",JSON.stringify(t))}function q(){let t=localStorage.getItem("slides-lite:draft");if(!t)return null;try{return JSON.parse(t)}catch{return null}}var E=()=>globalThis.crypto&&("randomUUID"in globalThis.crypto)?globalThis.crypto.randomUUID():`id-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,10)}`;function P(t,e){let i=Date.now()-t,l=Math.max(1,Math.floor(Math.abs(i)/1000)),f=[[60,"second"],[60,"minute"],[24,"hour"],[30,"day"],[12,"month"],[1/0,"year"]],a=l,c="second";for(let[m,b]of f){if(c=b,a<m)break;a=Math.floor(a/m)}let p=`${a} ${c}${a===1?"":"s"}`;if(!e?.addSuffix)return p;return i>=0?`${p} ago`:`in ${p}`}var w={"classic-light":{name:"Classic Light",bg:"#ffffff",fg:"#1f2937",accent:"#2563eb",canvas:"linear-gradient(180deg, #eef2ff 0%, #f8fafc 100%)"},"midnight-dark":{name:"Midnight Dark",bg:"#111827",fg:"#f9fafb",accent:"#60a5fa",canvas:"linear-gradient(180deg, #0f172a 0%, #111827 100%)"},ocean:{name:"Ocean",bg:"#e0f2fe",fg:"#0c4a6e",accent:"#0284c7",canvas:"linear-gradient(180deg, #dbeafe 0%, #e0f2fe 100%)"},sunset:{name:"Sunset",bg:"#fff7ed",fg:"#7c2d12",accent:"#ea580c",canvas:"linear-gradient(180deg, #ffedd5 0%, #fff7ed 100%)"}},o=document.getElementById("app"),n=N(q()??A()),g=!1,r=0,M=0,h=null,T="",y={dirty:!1,lastSavedAt:Date.now()},C=U(()=>L(!1),700);function U(t,e=300){let i=null;return(...l)=>{if(i)window.clearTimeout(i);i=window.setTimeout(()=>t(...l),e)}}function N(t){let e=((t.slides?.length)?t.slides:[x()]).map((i)=>({id:i.id||E(),layout:i.layout||"title-body",title:i.title||"",body:i.body||"",imageUrl:i.imageUrl||"",notes:i.notes||""}));return{title:t.title||"Untitled Deck",themeId:w[t.themeId]?t.themeId:"classic-light",slides:e,activeIndex:Math.min(Math.max(t.activeIndex??0,0),e.length-1)}}function x(t="title-body"){return{id:E(),layout:t,title:"New Slide",body:"",imageUrl:"",notes:""}}function A(){return{title:"Untitled Deck",themeId:"classic-light",slides:[x()],activeIndex:0}}function H(){if(n.activeIndex<0)n.activeIndex=0;if(n.activeIndex>n.slides.length-1)n.activeIndex=n.slides.length-1}function k(){return H(),n.slides[n.activeIndex]}function d(){y.dirty=!0,D(),C()}function L(t=!1){if(B(n),y.dirty=!1,y.lastSavedAt=Date.now(),D(),t)Y("Saved")}function s(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function I(t,e){let i=w[e],l=t.imageUrl?`<img src="${t.imageUrl}" style="max-width:100%; max-height:260px; border-radius:12px; margin-top:12px; box-shadow:0 8px 20px rgba(0,0,0,.15);"/>`:"";if(t.layout==="section")return`<div class="slide section" style="background:${i.bg};color:${i.fg};border-top:10px solid ${i.accent};">
      <h1>${s(t.title||"Section")}</h1>
      <p>${s(t.body||"")}</p>
    </div>`;if(t.layout==="title-image")return`<div class="slide" style="background:${i.bg};color:${i.fg};border-top:10px solid ${i.accent};">
      <h1>${s(t.title||"Title")}</h1>
      ${l||'<div style="opacity:.65; padding:8px 0;">No image selected</div>'}
      <p>${s(t.body||"")}</p>
    </div>`;return`<div class="slide" style="background:${i.bg};color:${i.fg};border-top:10px solid ${i.accent};">
    <h1>${s(t.title||"Title")}</h1>
    <p>${s(t.body||"")}</p>
  </div>`}function u(){if(!n.slides.length)n.slides.push(x());H();let t=w[n.themeId],e=k();o.innerHTML=`
    <style>
      * { box-sizing: border-box; }
      body { margin: 0; font-family: Inter, system-ui, Arial, sans-serif; color: #111827; }
      input, textarea, select, button { font: inherit; }
      .root { height: 100vh; display: grid; grid-template-rows: 62px 1fr; background: #f8fafc; }
      .topbar {
        display: flex; align-items: center; gap: 8px; padding: 10px 12px;
        border-bottom: 1px solid #e5e7eb; background: rgba(255,255,255,0.92); backdrop-filter: blur(6px);
      }
      .topbar input, .topbar select, .topbar button, .panel input, .panel textarea, .panel select, .left input {
        border: 1px solid #d1d5db; border-radius: 10px; padding: 8px 10px; font-size: 13px;
      }
      .topbar button, .panel button, .thumb-actions button { cursor: pointer; background: white; }
      .topbar button.primary { background: #111827; color: white; border-color: #111827; }
      .topbar button:focus-visible, .panel button:focus-visible { outline: 2px solid #93c5fd; outline-offset: 1px; }
      .chip { font-size: 12px; border-radius: 999px; padding: 5px 10px; background: #eef2ff; color: #1d4ed8; }
      .chip.dirty { background: #fef3c7; color: #92400e; }
      .main { display: grid; grid-template-columns: 260px 1fr 320px; height: calc(100vh - 62px); }
      .left { border-right: 1px solid #e5e7eb; overflow: auto; padding: 10px; background: #ffffff; }
      .left-head { display:grid; gap:8px; margin-bottom: 8px; }
      .left small { color:#6b7280; font-size:11px; }
      .thumb {
        border: 1px solid #d1d5db; border-radius: 12px; padding: 10px; margin-bottom: 8px; cursor: pointer;
        background: white; transition: transform .12s ease, box-shadow .12s ease;
      }
      .thumb:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,.07); }
      .thumb.active { border-color: #2563eb; box-shadow: 0 0 0 1px #2563eb inset; }
      .thumb h4 { margin: 0 0 4px; font-size: 12px; }
      .thumb p { margin: 0; font-size: 11px; color: #6b7280; min-height: 28px; }
      .thumb-badges { margin-top:6px; display:flex; align-items:center; justify-content:space-between; }
      .thumb-badge { font-size: 10px; color:#334155; background:#e2e8f0; border-radius:999px; padding:2px 6px; }
      .thumb-actions { display: flex; gap: 4px; }
      .thumb-actions button { font-size: 11px; padding: 3px 6px; }
      .center { display: grid; place-items: center; background: ${t.canvas}; padding: 18px; transition: background .18s ease; }
      .slide {
        width: min(980px, 100%); aspect-ratio: 16 / 9; border-radius: 16px;
        padding: 38px; overflow: auto; box-shadow: 0 16px 42px rgba(0,0,0,.18);
      }
      .slide h1 { margin-top: 0; margin-bottom: 14px; font-size: clamp(24px, 4vw, 44px); }
      .slide p { font-size: clamp(14px, 1.7vw, 26px); line-height: 1.35; white-space: pre-wrap; }
      .panel { border-left: 1px solid #e5e7eb; padding: 12px; overflow: auto; background: #ffffff; }
      .field { margin-bottom: 10px; display: grid; gap: 6px; }
      .field label { font-size: 12px; color: #4b5563; font-weight: 600; display:flex; justify-content:space-between; }
      .panel textarea { min-height: 120px; resize: vertical; }
      .small { font-size: 11px; color: #64748b; }
      .present { position: fixed; inset: 0; z-index: 9999; background: #0b1020; display: grid; place-items: center; }
      .present-ui { position: fixed; bottom: 14px; left: 50%; transform: translateX(-50%); display:flex; gap:8px; align-items:center; }
      .present-ui button { border: 0; border-radius: 8px; padding: 8px 10px; cursor: pointer; }
      .present-pill { color: #e2e8f0; font-size: 12px; background: rgba(30,41,59,.7); border-radius:999px; padding:6px 10px; }
      .progress { position: fixed; top: 0; left: 0; height: 4px; background: #38bdf8; transition: width .15s linear; }
    </style>
    <div class="root">
      <div class="topbar">
        <input id="deckTitle" value="${s(n.title)}" style="min-width:220px;" />
        <select id="themeSelect">
          ${Object.entries(w).map(([i,l])=>`<option value="${i}" ${i===n.themeId?"selected":""}>${l.name}</option>`).join("")}
        </select>
        <button id="newDeckBtn">New</button>
        <button id="dupBtn">Duplicate</button>
        <button id="addBtn">Add Slide</button>
        <button id="saveBtn">Save</button>
        <button class="primary" id="presentBtn">Present</button>
        <button id="exportBtn">Export PDF</button>
        <span class="chip" id="saveBadge"></span>
      </div>
      <div class="main">
        <div class="left">
          <div class="left-head">
            <input id="filterIn" placeholder="Filter slides…" value="${s(T)}" />
            <small>Tip: Alt+↑ / Alt+↓ to reorder • Ctrl/Cmd+Enter to present</small>
          </div>
          <div id="thumbs"></div>
        </div>
        <div class="center" id="canvas"></div>
        <div class="panel">
          <div class="field"><label>Layout</label>
            <select id="layoutSel">
              <option value="title-body" ${e.layout==="title-body"?"selected":""}>Title + Body</option>
              <option value="title-image" ${e.layout==="title-image"?"selected":""}>Title + Image</option>
              <option value="section" ${e.layout==="section"?"selected":""}>Section</option>
            </select>
          </div>
          <div class="field"><label>Title <span class="small">${e.title.length} chars</span></label><input id="titleIn" value="${s(e.title)}"></div>
          <div class="field"><label>Body <span class="small">${e.body.length} chars</span></label><textarea id="bodyIn">${s(e.body)}</textarea></div>
          <div class="field"><label>Speaker Notes</label><textarea id="notesIn" placeholder="Private presenter notes…">${s(e.notes)}</textarea></div>
          <div class="field"><label>Image URL</label><input id="imgIn" placeholder="https://..." value="${s(e.imageUrl)}"></div>
          <div class="field" style="display:flex; gap:8px;"><button id="delBtn">Delete Slide</button><button id="sectionBtn">Quick Section</button></div>
          <div class="small">Autosave enabled. Notes are hidden in exported slides.</div>
        </div>
      </div>
    </div>
  `,v(),S(!0),K(),D()}function v(){let t=o.querySelector("#thumbs"),e=T.trim().toLowerCase();t.innerHTML="",n.slides.forEach((i,l)=>{let f=`${i.title} ${i.body} ${i.notes}`.toLowerCase();if(e&&!f.includes(e))return;let a=document.createElement("div");a.className=`thumb ${l===n.activeIndex?"active":""}`,a.innerHTML=`
      <h4>${l+1}. ${s(i.title||"Untitled")}</h4>
      <p>${s((i.body||"").slice(0,72))}</p>
      <div class="thumb-badges">
        <span class="thumb-badge">${s(i.layout)}</span>
        <div class="thumb-actions">
          <button data-act="up" data-idx="${l}">↑</button>
          <button data-act="down" data-idx="${l}">↓</button>
        </div>
      </div>
    `,a.addEventListener("click",(c)=>{if(c.target.tagName.toLowerCase()==="button")return;n.activeIndex=l,u()}),a.querySelectorAll("button").forEach((c)=>{c.addEventListener("click",(p)=>{p.stopPropagation();let m=p.currentTarget,b=Number(m.dataset.idx);if(m.dataset.act==="up")$(b,b-1);if(m.dataset.act==="down")$(b,b+1)})}),t.appendChild(a)})}function $(t,e){if(e<0||e>=n.slides.length||t===e)return;let[i]=n.slides.splice(t,1);n.slides.splice(e,0,i),n.activeIndex=e,d(),u()}function S(t=!1){let e=o.querySelector("#canvas");if(e.innerHTML=I(k(),n.themeId),t){let i=e.querySelector(".slide");if(i)i.animate([{opacity:0,transform:"translateY(16px)"},{opacity:1,transform:"translateY(0px)"}],{duration:260,easing:"cubic-bezier(0.22, 1, 0.36, 1)"})}}function K(){let t=k();o.querySelector("#deckTitle").oninput=(e)=>{n.title=e.target.value,d()},o.querySelector("#themeSelect").onchange=(e)=>{n.themeId=e.target.value,d(),u()},o.querySelector("#layoutSel").onchange=(e)=>{t.layout=e.target.value,d(),u()},o.querySelector("#titleIn").oninput=(e)=>{t.title=e.target.value,d(),S(),v()},o.querySelector("#bodyIn").oninput=(e)=>{t.body=e.target.value,d(),S(),v()},o.querySelector("#notesIn").oninput=(e)=>{t.notes=e.target.value,d(),v()},o.querySelector("#imgIn").oninput=(e)=>{t.imageUrl=e.target.value,d(),S()},o.querySelector("#filterIn").oninput=(e)=>{T=e.target.value,v()},o.querySelector("#addBtn").onclick=()=>{n.slides.splice(n.activeIndex+1,0,x()),n.activeIndex+=1,d(),u()},o.querySelector("#sectionBtn").onclick=()=>{let e=x("section");e.title="Section Title",e.body="Add key message",n.slides.splice(n.activeIndex+1,0,e),n.activeIndex+=1,d(),u()},o.querySelector("#dupBtn").onclick=()=>{let e=k();n.slides.splice(n.activeIndex+1,0,{...e,id:E(),title:`${e.title} (copy)`}),n.activeIndex+=1,d(),u()},o.querySelector("#delBtn").onclick=()=>{if(n.slides.length===1)n.slides[0]=x(),n.activeIndex=0;else n.slides.splice(n.activeIndex,1),H();d(),u()},o.querySelector("#newDeckBtn").onclick=()=>{n=A(),T="",d(),u()},o.querySelector("#saveBtn").onclick=()=>L(!0),o.querySelector("#presentBtn").onclick=()=>{g=!0,r=n.activeIndex,M=Date.now(),z()},o.querySelector("#exportBtn").onclick=j}function D(){let t=o.querySelector("#saveBadge");if(!t)return;if(y.dirty){t.classList.add("dirty"),t.textContent="Saving…";return}t.classList.remove("dirty"),t.textContent=`Saved ${P(y.lastSavedAt,{addSuffix:!0})}`}function Y(t){let e=document.createElement("div");e.textContent=t,e.style.cssText="position:fixed;top:14px;right:14px;background:#111827;color:white;padding:9px 12px;border-radius:10px;z-index:99999",document.body.appendChild(e),e.animate([{opacity:0,transform:"translateY(-10px)"},{opacity:1,transform:"translateY(0px)"}],{duration:220,easing:"ease-out"}),setTimeout(()=>{let i=e.animate([{opacity:1,transform:"translateY(0px)"},{opacity:0,transform:"translateY(-6px)"}],{duration:180,easing:"ease-in"});i.onfinish=()=>e.remove()},900)}function z(){if(!g)return;let t=n.slides[r],e=document.createElement("div");e.className="present",e.innerHTML=`
    <div class="progress" id="presentProgress" style="width:${(r+1)/n.slides.length*100}%"></div>
    <div style="width:min(1200px,96vw);" id="presentSlideWrap">${I(t,n.themeId)}</div>
    <div class="present-ui">
      <span class="present-pill" id="presentCounter">${r+1} / ${n.slides.length}</span>
      <span class="present-pill" id="presentTimer">00:00</span>
      <button id="prevP">Prev</button>
      <button id="nextP">Next</button>
      <button id="exitP">Exit</button>
    </div>
  `,document.body.appendChild(e);let i=()=>{let a=e.querySelector("#presentSlideWrap");a.innerHTML=I(n.slides[r],n.themeId);let c=e.querySelector("#presentProgress");c.style.width=`${(r+1)/n.slides.length*100}%`;let p=e.querySelector("#presentCounter");p.textContent=`${r+1} / ${n.slides.length}`,a.querySelector(".slide")?.animate([{opacity:0.3,transform:"translateX(10px)"},{opacity:1,transform:"translateX(0px)"}],{duration:200,easing:"cubic-bezier(0.22, 1, 0.36, 1)"})},l=()=>{if(g=!1,h)window.clearInterval(h);h=null,e.remove(),window.removeEventListener("keydown",f)},f=(a)=>{if(!g)return;if(a.key==="Escape")l();if(a.key==="ArrowRight"&&r<n.slides.length-1)r+=1,i();if(a.key==="ArrowLeft"&&r>0)r-=1,i()};h=window.setInterval(()=>{let a=e.querySelector("#presentTimer");if(!a)return;let c=Math.floor((Date.now()-M)/1000),p=String(Math.floor(c/60)).padStart(2,"0"),m=String(c%60).padStart(2,"0");a.textContent=`${p}:${m}`},1000),window.addEventListener("keydown",f),e.querySelector("#prevP").onclick=()=>{if(r>0)r-=1;i()},e.querySelector("#nextP").onclick=()=>{if(r<n.slides.length-1)r+=1;i()},e.querySelector("#exitP").onclick=l}function j(){let t=`
    <html>
      <head>
        <title>${s(n.title)}</title>
        <style>
          body { margin:0; font-family: Inter, Arial, sans-serif; }
          .page { page-break-after: always; padding: 24px; }
          .slide { width: 100%; aspect-ratio: 16/9; border-radius: 12px; padding: 32px; box-sizing: border-box; }
          .slide h1 { margin:0 0 12px; font-size: 42px; }
          .slide p { font-size: 24px; white-space: pre-wrap; }
          @media print { .page:last-child { page-break-after: auto; } }
        </style>
      </head>
      <body>
        ${n.slides.map((i)=>`<div class="page">${I(i,n.themeId)}</div>`).join("")}
        <script>window.onload = () => window.print();</script>
      </body>
    </html>
  `,e=window.open("","_blank");if(!e){alert("Popup blocked. Please allow popups to export PDF.");return}e.document.open(),e.document.write(t),e.document.close()}window.addEventListener("keydown",(t)=>{if((t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="s")t.preventDefault(),L(!0);if((t.ctrlKey||t.metaKey)&&t.key==="Enter"&&!g)t.preventDefault(),g=!0,r=n.activeIndex,M=Date.now(),z();if(t.altKey&&t.key==="ArrowUp")t.preventDefault(),$(n.activeIndex,n.activeIndex-1);if(t.altKey&&t.key==="ArrowDown")t.preventDefault(),$(n.activeIndex,n.activeIndex+1)});u();L(!1);

</script>
</body>
</html>