<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slides Lite</title>
<style>*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden}body{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}</style>
<script>(function(){if(window.__yaarCaptureInstalled)return;window.__yaarCaptureInstalled=true;function respond(requestId,imageData){window.parent.postMessage({type:"yaar:capture-response",requestId,imageData},"*")}function inlineStyles(original,clone){var origEls=original.querySelectorAll("*");var cloneEls=clone.querySelectorAll("*");for(var i=0;i<origEls.length&&i<cloneEls.length;i++){var cs=window.getComputedStyle(origEls[i]);cloneEls[i].setAttribute("style",cs.cssText)}var rootCs=window.getComputedStyle(original);clone.setAttribute("style",rootCs.cssText)}function svgToCanvas(svgStr,w,h,cb){var blob=new Blob([svgStr],{type:"image/svg+xml;charset=utf-8"});var url=URL.createObjectURL(blob);var img=new Image;img.onload=function(){var c=document.createElement("canvas");c.width=w;c.height=h;var ctx=c.getContext("2d");ctx.drawImage(img,0,0,w,h);URL.revokeObjectURL(url);cb(c.toDataURL("image/png"))};img.onerror=function(){URL.revokeObjectURL(url);cb(null)};img.src=url}window.addEventListener("message",function(e){if(!e.data||e.data.type!=="yaar:capture-request")return;var requestId=e.data.requestId;var imageData=null;try{var canvases=document.querySelectorAll("canvas");if(canvases.length>0){var largest=null;var largestArea=0;for(var i=0;i<canvases.length;i++){var area=canvases[i].width*canvases[i].height;if(area>largestArea){largestArea=area;largest=canvases[i]}}if(largest){imageData=largest.toDataURL("image/png")}}if(imageData){respond(requestId,imageData);return}var svgs=document.querySelectorAll("svg");if(svgs.length>0){var largest=null;var largestArea=0;for(var i=0;i<svgs.length;i++){var rect=svgs[i].getBoundingClientRect();var area=rect.width*rect.height;if(area>largestArea){largestArea=area;largest=svgs[i]}}if(largest){var serializer=new XMLSerializer;var svgStr=serializer.serializeToString(largest);var rect=largest.getBoundingClientRect();svgToCanvas(svgStr,rect.width||300,rect.height||150,function(data){respond(requestId,data)});return}}var body=document.body;if(body){var w=Math.min(body.scrollWidth,window.innerWidth)||window.innerWidth||800;var h=Math.min(body.scrollHeight,window.innerHeight)||window.innerHeight||600;var clone=body.cloneNode(true);inlineStyles(body,clone);var remove=clone.querySelectorAll("script,iframe");for(var i=0;i<remove.length;i++)remove[i].remove();var xmlns="http://www.w3.org/1999/xhtml";var svgNS="http://www.w3.org/2000/svg";var xhtml=new XMLSerializer().serializeToString(clone);var svgStr='<svg xmlns="'+svgNS+'" width="'+w+'" height="'+h+'">'+'<foreignObject width="100%" height="100%">'+'<body xmlns="'+xmlns+'" style="margin:0;padding:0;">'+xhtml+"</body></foreignObject></svg>";svgToCanvas(svgStr,w,h,function(data){respond(requestId,data)});return}}catch(ex){}respond(requestId,null)})})();(function(){if(window.__yaarStorageInstalled)return;window.__yaarStorageInstalled=true;function encodePath(p){return p.split("/").map(encodeURIComponent).join("/")}window.yaar=window.yaar||{};window.yaar.storage={async save(path,data){var body;if(typeof data==="string"){body=data}else if(data instanceof Blob){body=await data.arrayBuffer()}else if(data instanceof ArrayBuffer){body=data}else if(data instanceof Uint8Array){body=data.buffer.slice(data.byteOffset,data.byteOffset+data.byteLength)}else{body=String(data)}var res=await fetch("/api/storage/"+encodePath(path),{method:"POST",body});if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Save failed")}return res.json()},async read(path,options){var mode=options&&options.as||"auto";var res=await fetch("/api/storage/"+encodePath(path));if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Read failed")}if(mode==="blob")return res.blob();if(mode==="arraybuffer")return res.arrayBuffer();if(mode==="json")return res.json();if(mode==="text")return res.text();var ct=res.headers.get("content-type")||"";if(ct.includes("json"))return res.json();if(ct.startsWith("text/"))return res.text();return res.blob()},async list(dirPath){var p=dirPath?encodePath(dirPath):"";var res=await fetch("/api/storage/"+p+"?list=true");if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"List failed")}return res.json()},async remove(path){var res=await fetch("/api/storage/"+encodePath(path),{method:"DELETE"});if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Delete failed")}return res.json()},url:function(path){return"/api/storage/"+encodePath(path)}}})();(function(){if(window.__yaarFetchProxyInstalled)return;window.__yaarFetchProxyInstalled=true;var realFetch=window.fetch.bind(window);var sessionId="";try{var sp=new URLSearchParams(location.search);var raw=sp.get("sessionId")||"";if(/^[a-zA-Z0-9_-]+$/.test(raw))sessionId=raw}catch(e){}window.fetch=function(input,init){var url;if(input instanceof Request){url=input.url}else{url=String(input)}if(url.startsWith("/")||url.startsWith("./")||url.startsWith("../")){return realFetch(input,init)}try{var parsed=new URL(url,location.origin);if(parsed.origin===location.origin){return realFetch(input,init)}}catch(e){return realFetch(input,init)}var method=init&&init.method||(input instanceof Request?input.method:"GET");var headers={};if(init&&init.headers){if(init.headers instanceof Headers){init.headers.forEach(function(v,k){headers[k]=v})}else if(Array.isArray(init.headers)){init.headers.forEach(function(pair){headers[pair[0]]=pair[1]})}else{headers=Object.assign({},init.headers)}}else if(input instanceof Request){input.headers.forEach(function(v,k){headers[k]=v})}var bodyPromise;if(init&&init.body!=null){if(typeof init.body==="string"){bodyPromise=Promise.resolve(init.body)}else{bodyPromise=new Response(init.body).text()}}else if(input instanceof Request&&method!=="GET"&&method!=="HEAD"){bodyPromise=input.text()}else{bodyPromise=Promise.resolve(undefined)}return bodyPromise.then(function(bodyStr){var payload={url,method,headers};if(bodyStr!==undefined)payload.body=bodyStr;if(sessionId)payload.sessionId=sessionId;return realFetch("/api/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)})}).then(function(proxyRes){if(!proxyRes.ok){return proxyRes.json().then(function(err){throw new Error(err.error||"Fetch proxy error: "+proxyRes.status)})}return proxyRes.json()}).then(function(data){var body;if(data.bodyEncoding==="base64"){var bin=atob(data.body);var bytes=new Uint8Array(bin.length);for(var i=0;i<bin.length;i++)bytes[i]=bin.charCodeAt(i);body=bytes.buffer}else{body=data.body}return new Response(body,{status:data.status,statusText:data.statusText,headers:data.headers})})}})();(function(){if(window.__yaarAppProtocolInstalled)return;window.__yaarAppProtocolInstalled=true;window.yaar=window.yaar||{};var registration=null;window.yaar.app={register:function(config){registration=config;window.parent.postMessage({type:"yaar:app-ready",appId:config.appId},"*")},sendInteraction:function(description){window.parent.postMessage({type:"yaar:app-interaction",content:typeof description==="string"?description:JSON.stringify(description)},"*")}};window.addEventListener("message",function(e){if(!e.data||!e.data.type)return;var msg=e.data;var requestId=msg.requestId;if(msg.type==="yaar:app-manifest-request"){if(!registration){window.parent.postMessage({type:"yaar:app-manifest-response",requestId,manifest:null,error:"No app registered"},"*");return}var manifest={appId:registration.appId,name:registration.name,state:{},commands:{}};if(registration.state){for(var key in registration.state){var s=registration.state[key];manifest.state[key]={description:s.description};if(s.schema)manifest.state[key].schema=s.schema}}if(registration.commands){for(var key in registration.commands){var c=registration.commands[key];manifest.commands[key]={description:c.description};if(c.params)manifest.commands[key].params=c.params;if(c.returns)manifest.commands[key].returns=c.returns}}window.parent.postMessage({type:"yaar:app-manifest-response",requestId,manifest},"*");return}if(msg.type==="yaar:app-query-request"){if(!registration||!registration.state||!registration.state[msg.stateKey]){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:"Unknown state key: "+msg.stateKey},"*");return}try{var result=registration.state[msg.stateKey].handler();if(result&&typeof result.then==="function"){result.then(function(data){window.parent.postMessage({type:"yaar:app-query-response",requestId,data},"*")}).catch(function(err){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:String(err)},"*")})}else{window.parent.postMessage({type:"yaar:app-query-response",requestId,data:result},"*")}}catch(err){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:String(err)},"*")}return}if(msg.type==="yaar:app-command-request"){if(!registration||!registration.commands||!registration.commands[msg.command]){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:"Unknown command: "+msg.command},"*");return}try{var result=registration.commands[msg.command].handler(msg.params);if(result&&typeof result.then==="function"){result.then(function(data){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:data},"*")}).catch(function(err){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:String(err)},"*")})}else{window.parent.postMessage({type:"yaar:app-command-response",requestId,result},"*")}}catch(err){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:String(err)},"*")}return}})})();</script>
</head>
<body>
<div id="app"></div>
<script type="module">
function S(o){localStorage.setItem("slides-lite:draft",JSON.stringify(o))}function w(){let o=localStorage.getItem("slides-lite:draft");if(!o)return null;try{return JSON.parse(o)}catch{return null}}var W=["16:9","4:3","1:1"];function F(o){let t=o.trim().match(/^(\d+(?:\.\d+)?)\s*[:/]\s*(\d+(?:\.\d+)?)$/),u=t?Number(t[1]):16,g=t?Number(t[2]):9;if(!Number.isFinite(u)||!Number.isFinite(g)||u<=0||g<=0)return{width:16,height:9,cssValue:"16 / 9",normalized:"16:9",preset:"16:9"};let i=Number(u.toFixed(3)),f=Number(g.toFixed(3)),h=`${i}:${f}`,$=W.includes(h)?h:"custom";return{width:i,height:f,cssValue:`${i} / ${f}`,normalized:h,preset:$}}function K(o){return F(typeof o==="string"?o:"16:9").normalized}var N={"classic-light":{name:"Classic Light",bg:"#ffffff",fg:"#1f2937",accent:"#2563eb",canvas:"linear-gradient(180deg, #eef2ff 0%, #f8fafc 100%)"},"midnight-dark":{name:"Midnight Dark",bg:"#111827",fg:"#f9fafb",accent:"#60a5fa",canvas:"linear-gradient(180deg, #0f172a 0%, #111827 100%)"},ocean:{name:"Ocean",bg:"#e0f2fe",fg:"#0c4a6e",accent:"#0284c7",canvas:"linear-gradient(180deg, #dbeafe 0%, #e0f2fe 100%)"},sunset:{name:"Sunset",bg:"#fff7ed",fg:"#7c2d12",accent:"#ea580c",canvas:"linear-gradient(180deg, #ffedd5 0%, #fff7ed 100%)"}};function Y(o){return typeof o==="string"&&o in N}var L=()=>globalThis.crypto&&("randomUUID"in globalThis.crypto)?globalThis.crypto.randomUUID():`id-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,10)}`;function a(o,t){let u=Date.now()-o,g=Math.max(1,Math.floor(Math.abs(u)/1000)),i=[[60,"second"],[60,"minute"],[24,"hour"],[30,"day"],[12,"month"],[1/0,"year"]],f=g,h="second";for(let[c,U]of i){if(h=U,f<c)break;f=Math.floor(f/c)}let $=`${f} ${h}${f===1?"":"s"}`;if(!t?.addSuffix)return $;return u>=0?`${$} ago`:`in ${$}`}function p(o,t=300){let u=null;return(...g)=>{if(u)window.clearTimeout(u);u=window.setTimeout(()=>o(...g),t)}}function m(o="title-body"){return{id:L(),layout:o,title:"New Slide",body:"",imageUrl:"",notes:""}}function z(){return{title:"Untitled Deck",themeId:"classic-light",slides:[m()],activeIndex:0,aspectRatio:"16:9"}}function e(o){return o==="title-body"||o==="title-image"||o==="section"}function R(o){let t=o??{};return{id:t.id||L(),layout:e(t.layout)?t.layout:"title-body",title:t.title||"",body:t.body||"",imageUrl:t.imageUrl||"",notes:t.notes||""}}function I(o){let t=((o.slides?.length)?o.slides:[m()]).map((u)=>({id:u.id||L(),layout:u.layout||"title-body",title:u.title||"",body:u.body||"",imageUrl:u.imageUrl||"",notes:u.notes||""}));return{title:o.title||"Untitled Deck",themeId:Y(o.themeId)?o.themeId:"classic-light",slides:t,activeIndex:Math.min(Math.max(o.activeIndex??0,0),t.length-1),aspectRatio:K(o.aspectRatio)}}function b(o){return o.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function oo(o){try{let t=new URL(o);if(t.protocol==="http:"||t.protocol==="https:")return t.toString();return null}catch{return null}}function q(o){let t=[],u=(i)=>{return t.push(i),`@@TOK${t.length-1}@@`},g=o.replace(/`([^`\n]+)`/g,(i,f)=>u(`<code>${b(f)}</code>`)).replace(/\[([^\]]+)\]\(([^\s)]+)\)/g,(i,f,h)=>{let $=oo(h);if(!$)return u(b(f));return u(`<a href="${b($)}" target="_blank" rel="noopener noreferrer">${b(f)}</a>`)});return g=b(g).replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/__(.+?)__/g,"<strong>$1</strong>").replace(/_(.+?)_/g,"<em>$1</em>"),g.replace(/@@TOK(\d+)@@/g,(i,f)=>t[Number(f)]??"")}function to(o){return/(^#{1,6}\s)|(^>\s)|(^\s*[-*+]\s)|(^\s*\d+\.\s)|(\*\*)|(\*)|(`)|\[[^\]]+\]\([^\)]+\)|(^```)|(^---\s*$)/m.test(o)}function X(o){let t=o||"";if(!to(t))return`<p>${b(t).replaceAll(`
`,"<br/>")}</p>`;let u=t.replaceAll(`\r
`,`
`).split(`
`),g=[],i=!1,f=!1,h=!1,$=[],c=()=>{if(i)g.push("</ul>"),i=!1;if(f)g.push("</ol>"),f=!1},U=()=>{if(!h)return;g.push(`<pre><code>${b($.join(`
`))}</code></pre>`),h=!1,$=[]};for(let _ of u){if(_.trim().startsWith("```")){if(c(),h)U();else h=!0,$=[];continue}if(h){$.push(_);continue}if(!_.trim()){c();continue}let T=_.match(/^(#{1,6})\s+(.+)$/);if(T){c();let v=T[1].length;g.push(`<h${v}>${q(T[2])}</h${v}>`);continue}let A=_.match(/^\s*[-*+]\s+(.+)$/);if(A){if(f)g.push("</ol>"),f=!1;if(!i)g.push("<ul>"),i=!0;g.push(`<li>${q(A[1])}</li>`);continue}let D=_.match(/^\s*\d+\.\s+(.+)$/);if(D){if(i)g.push("</ul>"),i=!1;if(!f)g.push("<ol>"),f=!0;g.push(`<li>${q(D[1])}</li>`);continue}if(/^---\s*$/.test(_)){c(),g.push("<hr/>");continue}let H=_.match(/^>\s?(.+)$/);if(H){c(),g.push(`<blockquote>${q(H[1])}</blockquote>`);continue}c(),g.push(`<p>${q(_)}</p>`)}return c(),U(),g.length?g.join(""):"<p></p>"}function J(o,t){let u=N[t],g=o.imageUrl?`<img src="${o.imageUrl}" style="max-width:100%; max-height:260px; border-radius:12px; margin-top:12px; box-shadow:0 8px 20px rgba(0,0,0,.15);"/>`:"";if(o.layout==="section")return`<div class="slide section" style="background:${u.bg};color:${u.fg};border-top:10px solid ${u.accent};">
      <h1>${b(o.title||"Section")}</h1>
      <div class="slide-body">${X(o.body||"")}</div>
    </div>`;if(o.layout==="title-image")return`<div class="slide" style="background:${u.bg};color:${u.fg};border-top:10px solid ${u.accent};">
      <h1>${b(o.title||"Title")}</h1>
      ${g||'<div style="opacity:.65; padding:8px 0;">No image selected</div>'}
      <div class="slide-body">${X(o.body||"")}</div>
    </div>`;return`<div class="slide" style="background:${u.bg};color:${u.fg};border-top:10px solid ${u.accent};">
    <h1>${b(o.title||"Title")}</h1>
    <div class="slide-body">${X(o.body||"")}</div>
  </div>`}var l=document.getElementById("app"),n=I(w()??z()),O=!1,s=0,P=0,Z=null,r="",j={dirty:!1,lastSavedAt:Date.now()},no=p(()=>M(!1),700);function uo(){return JSON.parse(JSON.stringify(n))}function E(){if(n.activeIndex<0)n.activeIndex=0;if(n.activeIndex>n.slides.length-1)n.activeIndex=n.slides.length-1}function G(){return E(),n.slides[n.activeIndex]}function x(){j.dirty=!0,Q(),no()}function M(o=!1){if(S(n),j.dirty=!1,j.lastSavedAt=Date.now(),Q(),o)go("Saved")}function y(){if(!n.slides.length)n.slides.push(m());E();let o=N[n.themeId],t=G(),u=F(n.aspectRatio);l.innerHTML=`
    <style>
      * { box-sizing: border-box; }
      body { margin: 0; font-family: Inter, system-ui, Arial, sans-serif; color: #111827; }
      input, textarea, select, button { font: inherit; }
      .root { height: 100vh; display: grid; grid-template-rows: 62px 1fr; background: #f8fafc; }
      .topbar {
        display: flex; align-items: center; gap: 8px; padding: 10px 12px;
        border-bottom: 1px solid #e5e7eb; background: rgba(255,255,255,0.92); backdrop-filter: blur(6px);
      }
      .topbar input, .topbar select, .topbar button, .panel input, .panel textarea, .panel select, .left input {
        border: 1px solid #d1d5db; border-radius: 10px; padding: 8px 10px; font-size: 13px;
      }
      .topbar button, .panel button, .thumb-actions button { cursor: pointer; background: white; }
      .topbar button.primary { background: #111827; color: white; border-color: #111827; }
      .topbar button:focus-visible, .panel button:focus-visible { outline: 2px solid #93c5fd; outline-offset: 1px; }
      .chip { font-size: 12px; border-radius: 999px; padding: 5px 10px; background: #eef2ff; color: #1d4ed8; }
      .chip.dirty { background: #fef3c7; color: #92400e; }
      .main { display: grid; grid-template-columns: 260px 1fr 320px; height: calc(100vh - 62px); }
      .left { border-right: 1px solid #e5e7eb; overflow: auto; padding: 10px; background: #ffffff; }
      .left-head { display:grid; gap:8px; margin-bottom: 8px; }
      .left small { color:#6b7280; font-size:11px; }
      .thumb {
        border: 1px solid #d1d5db; border-radius: 12px; padding: 10px; margin-bottom: 8px; cursor: pointer;
        background: white; transition: transform .12s ease, box-shadow .12s ease;
      }
      .thumb:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,.07); }
      .thumb.active { border-color: #2563eb; box-shadow: 0 0 0 1px #2563eb inset; }
      .thumb h4 { margin: 0 0 4px; font-size: 12px; }
      .thumb p { margin: 0; font-size: 11px; color: #6b7280; min-height: 28px; }
      .thumb-badges { margin-top:6px; display:flex; align-items:center; justify-content:space-between; }
      .thumb-badge { font-size: 10px; color:#334155; background:#e2e8f0; border-radius:999px; padding:2px 6px; }
      .thumb-actions { display: flex; gap: 4px; }
      .thumb-actions button { font-size: 11px; padding: 3px 6px; }
      .center { display: grid; place-items: center; background: ${o.canvas}; padding: 18px; transition: background .18s ease; }
      .slide {
        width: min(980px, 100%); aspect-ratio: ${u.cssValue}; border-radius: 16px;
        padding: 38px; overflow: auto; box-shadow: 0 16px 42px rgba(0,0,0,.18);
      }
      .slide h1 { margin-top: 0; margin-bottom: 14px; font-size: clamp(24px, 4vw, 44px); }
      .slide-body { font-size: clamp(14px, 1.7vw, 26px); line-height: 1.35; }
      .slide-body p { margin: 0 0 10px; }
      .slide-body ul, .slide-body ol { margin: 0 0 12px 1.2em; padding: 0; }
      .slide-body li { margin: 0 0 6px; }
      .slide-body h2, .slide-body h3, .slide-body h4, .slide-body h5, .slide-body h6 { margin: 8px 0 8px; }
      .slide-body blockquote { margin: 8px 0; padding: 6px 12px; border-left: 4px solid ${o.accent}; opacity: 0.92; }
      .slide-body code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: rgba(148, 163, 184, 0.18); border-radius: 5px; padding: 0 4px; }
      .slide-body pre { margin: 10px 0; padding: 10px 12px; border-radius: 10px; background: rgba(15, 23, 42, 0.08); overflow: auto; }
      .slide-body pre code { background: transparent; padding: 0; }
      .slide-body hr { border: 0; border-top: 1px solid rgba(100, 116, 139, 0.45); margin: 12px 0; }
      .slide-body a { color: ${o.accent}; text-decoration: underline; }
      .panel { border-left: 1px solid #e5e7eb; padding: 12px; overflow: auto; background: #ffffff; }
      .field { margin-bottom: 10px; display: grid; gap: 6px; }
      .field label { font-size: 12px; color: #4b5563; font-weight: 600; display:flex; justify-content:space-between; }
      .panel textarea { min-height: 120px; resize: vertical; }
      .small { font-size: 11px; color: #64748b; }
      .present { position: fixed; inset: 0; z-index: 9999; background: #0b1020; display: grid; place-items: center; }
      .present-ui { position: fixed; bottom: 14px; left: 50%; transform: translateX(-50%); display:flex; gap:8px; align-items:center; }
      .present-ui button { border: 0; border-radius: 8px; padding: 8px 10px; cursor: pointer; }
      .present-pill { color: #e2e8f0; font-size: 12px; background: rgba(30,41,59,.7); border-radius:999px; padding:6px 10px; }
      .progress { position: fixed; top: 0; left: 0; height: 4px; background: #38bdf8; transition: width .15s linear; }
    </style>
    <div class="root">
      <div class="topbar">
        <input id="deckTitle" value="${b(n.title)}" style="min-width:220px;" />
        <select id="themeSelect">
          ${Object.entries(N).map(([g,i])=>`<option value="${g}" ${g===n.themeId?"selected":""}>${i.name}</option>`).join("")}
        </select>
        <select id="ratioSel" title="Slide ratio">
          ${W.map((g)=>`<option value="${g}" ${u.preset===g?"selected":""}>${g}</option>`).join("")}
          <option value="custom" ${u.preset==="custom"?"selected":""}>Custom</option>
        </select>
        <input id="ratioW" type="number" min="0.1" step="0.1" value="${u.width}" style="width:72px;" ${u.preset==="custom"?"":"disabled"} />
        <span>:</span>
        <input id="ratioH" type="number" min="0.1" step="0.1" value="${u.height}" style="width:72px;" ${u.preset==="custom"?"":"disabled"} />
        <button id="newDeckBtn">New</button>
        <button id="dupBtn">Duplicate</button>
        <button id="addBtn">Add Slide</button>
        <button id="saveBtn">Save</button>
        <button class="primary" id="presentBtn">Present</button>
        <button id="exportBtn">Export PDF</button>
        <span class="chip" id="saveBadge"></span>
      </div>
      <div class="main">
        <div class="left">
          <div class="left-head">
            <input id="filterIn" placeholder="Filter slides…" value="${b(r)}" />
            <small>Tip: Alt+↑ / Alt+↓ to reorder • Ctrl/Cmd+Enter to present</small>
          </div>
          <div id="thumbs"></div>
        </div>
        <div class="center" id="canvas"></div>
        <div class="panel">
          <div class="field"><label>Layout</label>
            <select id="layoutSel">
              <option value="title-body" ${t.layout==="title-body"?"selected":""}>Title + Body</option>
              <option value="title-image" ${t.layout==="title-image"?"selected":""}>Title + Image</option>
              <option value="section" ${t.layout==="section"?"selected":""}>Section</option>
            </select>
          </div>
          <div class="field"><label>Title <span class="small">${t.title.length} chars</span></label><input id="titleIn" value="${b(t.title)}"></div>
          <div class="field"><label>Body (Markdown supported) <span class="small">${t.body.length} chars</span></label><textarea id="bodyIn">${b(t.body)}</textarea></div>
          <div class="field"><label>Speaker Notes</label><textarea id="notesIn" placeholder="Private presenter notes…">${b(t.notes)}</textarea></div>
          <div class="field"><label>Image URL</label><input id="imgIn" placeholder="https://..." value="${b(t.imageUrl)}"></div>
          <div class="field" style="display:flex; gap:8px;"><button id="delBtn">Delete Slide</button><button id="sectionBtn">Quick Section</button></div>
          <div class="small">Autosave enabled. Notes are hidden in exported slides.</div>
        </div>
      </div>
    </div>
  `,V(),B(!0),fo(),Q()}function V(){let o=l.querySelector("#thumbs"),t=r.trim().toLowerCase();o.innerHTML="",n.slides.forEach((u,g)=>{let i=`${u.title} ${u.body} ${u.notes}`.toLowerCase();if(t&&!i.includes(t))return;let f=document.createElement("div");f.className=`thumb ${g===n.activeIndex?"active":""}`,f.innerHTML=`
      <h4>${g+1}. ${b(u.title||"Untitled")}</h4>
      <p>${b((u.body||"").slice(0,72))}</p>
      <div class="thumb-badges">
        <span class="thumb-badge">${b(u.layout)}</span>
        <div class="thumb-actions">
          <button data-act="up" data-idx="${g}">↑</button>
          <button data-act="down" data-idx="${g}">↓</button>
        </div>
      </div>
    `,f.addEventListener("click",(h)=>{if(h.target.tagName.toLowerCase()==="button")return;n.activeIndex=g,y()}),f.querySelectorAll("button").forEach((h)=>{h.addEventListener("click",($)=>{$.stopPropagation();let c=$.currentTarget,U=Number(c.dataset.idx);if(c.dataset.act==="up")C(U,U-1);if(c.dataset.act==="down")C(U,U+1)})}),o.appendChild(f)})}function C(o,t){if(t<0||t>=n.slides.length||o===t)return;let[u]=n.slides.splice(o,1);n.slides.splice(t,0,u),n.activeIndex=t,x(),y()}function B(o=!1){let t=l.querySelector("#canvas");if(t.innerHTML=J(G(),n.themeId),o){let u=t.querySelector(".slide");if(u)u.animate([{opacity:0,transform:"translateY(16px)"},{opacity:1,transform:"translateY(0px)"}],{duration:260,easing:"cubic-bezier(0.22, 1, 0.36, 1)"})}}function fo(){let o=G();l.querySelector("#deckTitle").oninput=(f)=>{n.title=f.target.value,x()},l.querySelector("#themeSelect").onchange=(f)=>{n.themeId=f.target.value,x(),y()};let t=l.querySelector("#ratioSel"),u=l.querySelector("#ratioW"),g=l.querySelector("#ratioH");t.onchange=(f)=>{let h=f.target.value;if(h==="custom"){u.disabled=!1,g.disabled=!1;let $=F(n.aspectRatio);n.aspectRatio=`${$.width}:${$.height}`}else u.disabled=!0,g.disabled=!0,n.aspectRatio=h;x(),y()};let i=()=>{if(t.value!=="custom")return;let f=Number(u.value),h=Number(g.value);if(!Number.isFinite(f)||!Number.isFinite(h)||f<=0||h<=0)return;n.aspectRatio=`${Number(f.toFixed(3))}:${Number(h.toFixed(3))}`,x(),y()};u.oninput=i,g.oninput=i,l.querySelector("#layoutSel").onchange=(f)=>{o.layout=f.target.value,x(),y()},l.querySelector("#titleIn").oninput=(f)=>{o.title=f.target.value,x(),B(),V()},l.querySelector("#bodyIn").oninput=(f)=>{o.body=f.target.value,x(),B(),V()},l.querySelector("#notesIn").oninput=(f)=>{o.notes=f.target.value,x(),V()},l.querySelector("#imgIn").oninput=(f)=>{o.imageUrl=f.target.value,x(),B()},l.querySelector("#filterIn").oninput=(f)=>{r=f.target.value,V()},l.querySelector("#addBtn").onclick=()=>{n.slides.splice(n.activeIndex+1,0,m()),n.activeIndex+=1,x(),y()},l.querySelector("#sectionBtn").onclick=()=>{let f=m("section");f.title="Section Title",f.body="Add key message",n.slides.splice(n.activeIndex+1,0,f),n.activeIndex+=1,x(),y()},l.querySelector("#dupBtn").onclick=()=>{let f=G();n.slides.splice(n.activeIndex+1,0,{...f,id:L(),title:`${f.title} (copy)`}),n.activeIndex+=1,x(),y()},l.querySelector("#delBtn").onclick=()=>{if(n.slides.length===1)n.slides[0]=m(),n.activeIndex=0;else n.slides.splice(n.activeIndex,1),E();x(),y()},l.querySelector("#newDeckBtn").onclick=()=>{n=z(),r="",x(),y()},l.querySelector("#saveBtn").onclick=()=>M(!0),l.querySelector("#presentBtn").onclick=()=>{O=!0,s=n.activeIndex,P=Date.now(),d()},l.querySelector("#exportBtn").onclick=io}function Q(){let o=l.querySelector("#saveBadge");if(!o)return;if(j.dirty){o.classList.add("dirty"),o.textContent="Saving…";return}o.classList.remove("dirty"),o.textContent=`Saved ${a(j.lastSavedAt,{addSuffix:!0})}`}function go(o){let t=document.createElement("div");t.textContent=o,t.style.cssText="position:fixed;top:14px;right:14px;background:#111827;color:white;padding:9px 12px;border-radius:10px;z-index:99999",document.body.appendChild(t),t.animate([{opacity:0,transform:"translateY(-10px)"},{opacity:1,transform:"translateY(0px)"}],{duration:220,easing:"ease-out"}),setTimeout(()=>{let u=t.animate([{opacity:1,transform:"translateY(0px)"},{opacity:0,transform:"translateY(-6px)"}],{duration:180,easing:"ease-in"});u.onfinish=()=>t.remove()},900)}function d(){if(!O)return;let o=n.slides[s],t=document.createElement("div");t.className="present",t.innerHTML=`
    <div class="progress" id="presentProgress" style="width:${(s+1)/n.slides.length*100}%"></div>
    <div style="width:min(1200px,96vw);" id="presentSlideWrap">${J(o,n.themeId)}</div>
    <div class="present-ui">
      <span class="present-pill" id="presentCounter">${s+1} / ${n.slides.length}</span>
      <span class="present-pill" id="presentTimer">00:00</span>
      <button id="prevP">Prev</button>
      <button id="nextP">Next</button>
      <button id="exitP">Exit</button>
    </div>
  `,document.body.appendChild(t);let u=()=>{let f=t.querySelector("#presentSlideWrap");f.innerHTML=J(n.slides[s],n.themeId);let h=t.querySelector("#presentProgress");h.style.width=`${(s+1)/n.slides.length*100}%`;let $=t.querySelector("#presentCounter");$.textContent=`${s+1} / ${n.slides.length}`,f.querySelector(".slide")?.animate([{opacity:0.3,transform:"translateX(10px)"},{opacity:1,transform:"translateX(0px)"}],{duration:200,easing:"cubic-bezier(0.22, 1, 0.36, 1)"})},g=()=>{if(O=!1,Z)window.clearInterval(Z);Z=null,t.remove(),window.removeEventListener("keydown",i)},i=(f)=>{if(!O)return;if(f.key==="Escape")g();if(f.key==="ArrowRight"&&s<n.slides.length-1)s+=1,u();if(f.key==="ArrowLeft"&&s>0)s-=1,u()};Z=window.setInterval(()=>{let f=t.querySelector("#presentTimer");if(!f)return;let h=Math.floor((Date.now()-P)/1000),$=String(Math.floor(h/60)).padStart(2,"0"),c=String(h%60).padStart(2,"0");f.textContent=`${$}:${c}`},1000),window.addEventListener("keydown",i),t.querySelector("#prevP").onclick=()=>{if(s>0)s-=1;u()},t.querySelector("#nextP").onclick=()=>{if(s<n.slides.length-1)s+=1;u()},t.querySelector("#exitP").onclick=g}function io(){let o=F(n.aspectRatio),t=`
    <html>
      <head>
        <title>${b(n.title)}</title>
        <style>
          body { margin:0; font-family: Inter, Arial, sans-serif; }
          .page { page-break-after: always; padding: 24px; }
          .slide { width: 100%; aspect-ratio: ${o.cssValue}; border-radius: 12px; padding: 32px; box-sizing: border-box; }
          .slide h1 { margin:0 0 12px; font-size: 42px; }
          .slide-body { font-size: 24px; line-height: 1.35; }
          .slide-body p { margin: 0 0 10px; }
          .slide-body ul, .slide-body ol { margin: 0 0 12px 1.2em; padding: 0; }
          .slide-body li { margin: 0 0 6px; }
          .slide-body blockquote { margin: 8px 0; padding: 6px 12px; border-left: 4px solid #475569; }
          .slide-body code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
          .slide-body pre { margin: 10px 0; padding: 10px 12px; border-radius: 8px; background: rgba(15, 23, 42, 0.08); overflow: auto; }
          .slide-body a { color: #1d4ed8; text-decoration: underline; }
          @media print { .page:last-child { page-break-after: auto; } }
        </style>
      </head>
      <body>
        ${n.slides.map((g)=>`<div class="page">${J(g,n.themeId)}</div>`).join("")}
        <script>window.onload = () => window.print();<\/script>
      </body>
    </html>
  `,u=window.open("","_blank");if(!u){alert("Popup blocked. Please allow popups to export PDF.");return}u.document.open(),u.document.write(t),u.document.close()}window.addEventListener("keydown",(o)=>{if((o.ctrlKey||o.metaKey)&&o.key.toLowerCase()==="s")o.preventDefault(),M(!0);if((o.ctrlKey||o.metaKey)&&o.key==="Enter"&&!O)o.preventDefault(),O=!0,s=n.activeIndex,P=Date.now(),d();if(o.altKey&&o.key==="ArrowUp")o.preventDefault(),C(n.activeIndex,n.activeIndex-1);if(o.altKey&&o.key==="ArrowDown")o.preventDefault(),C(n.activeIndex,n.activeIndex+1)});y();M(!1);var k=window.yaar?.app;function ho(o,t){try{let u=JSON.parse(o);if(Array.isArray(u)){let g=u.map((i)=>R(i));return{title:t,slides:g.length?g:[m()]}}if(u&&typeof u==="object"){let g=u;if(Array.isArray(g.slides)){let i=I({title:g.title||t,themeId:Y(g.themeId)?g.themeId:"classic-light",slides:g.slides.map((f)=>R(f)),activeIndex:typeof g.activeIndex==="number"?g.activeIndex:0,aspectRatio:K(g.aspectRatio)});return{title:i.title,slides:i.slides}}}}catch{}return{title:t,slides:[R({title:t,body:o})]}}if(k)k.register({appId:"slides-lite",name:"Slides Lite",state:{deck:{description:"Current full deck object",handler:()=>uo()},activeSlide:{description:"Currently selected slide",handler:()=>({...G()})},title:{description:"Current deck title",handler:()=>n.title},theme:{description:"Current deck theme id",handler:()=>n.themeId},aspectRatio:{description:"Current slide aspect ratio (e.g., 16:9)",handler:()=>n.aspectRatio},activeIndex:{description:"Current active slide index",handler:()=>n.activeIndex},slideCount:{description:"Number of slides in the deck",handler:()=>n.slides.length}},commands:{setDeck:{description:"Replace entire deck. Params: { deck: Deck }",params:{type:"object",properties:{deck:{type:"object"}},required:["deck"]},handler:(o)=>{return n=I(o.deck),r="",M(!1),y(),{ok:!0,slideCount:n.slides.length}}},setSlides:{description:'Set slides in replace/append mode. Params: { slides: Slide[], mode?: "replace"|"append" }',params:{type:"object",properties:{slides:{type:"array",items:{type:"object"}},mode:{type:"string",enum:["replace","append"]}},required:["slides"]},handler:(o)=>{let t=(Array.isArray(o.slides)?o.slides:[]).map((g)=>R(g)),u=o.mode||"replace";if(u==="append"){if(t.length)n.slides.push(...t);n.activeIndex=Math.max(0,n.slides.length-1)}else n.slides=t.length?t:[m()],n.activeIndex=0;return E(),M(!1),y(),{ok:!0,mode:u,slideCount:n.slides.length}}},appendSlides:{description:"Append many slides at once. Params: { slides: Slide[] }",params:{type:"object",properties:{slides:{type:"array",items:{type:"object"}}},required:["slides"]},handler:(o)=>{let t=(Array.isArray(o.slides)?o.slides:[]).map((u)=>R(u));if(t.length)n.slides.push(...t),n.activeIndex=n.slides.length-1,E(),M(!1),y();return{ok:!0,appended:t.length,slideCount:n.slides.length}}},setActiveIndex:{description:"Set active slide index. Params: { index: number }",params:{type:"object",properties:{index:{type:"number"}},required:["index"]},handler:(o)=>{return n.activeIndex=Math.max(0,Math.min(Math.floor(o.index),n.slides.length-1)),y(),{ok:!0,activeIndex:n.activeIndex}}},setTheme:{description:"Set deck theme. Params: { themeId: ThemeId }",params:{type:"object",properties:{themeId:{type:"string"}},required:["themeId"]},handler:(o)=>{if(!Y(o.themeId))return{ok:!1,error:`Invalid themeId: ${String(o.themeId)}`};return n.themeId=o.themeId,M(!1),y(),{ok:!0,themeId:n.themeId}}},setAspectRatio:{description:"Set deck aspect ratio. Params: { aspectRatio: string }",params:{type:"object",properties:{aspectRatio:{type:"string"}},required:["aspectRatio"]},handler:(o)=>{return n.aspectRatio=K(o.aspectRatio),M(!1),y(),{ok:!0,aspectRatio:n.aspectRatio}}},saveToStorage:{description:"Save current deck JSON to YAAR storage. Params: { path: string }",params:{type:"object",properties:{path:{type:"string"}},required:["path"]},handler:async(o)=>{let t=window.yaar?.storage;if(!t)return{ok:!1,error:"Storage API not available"};let u=JSON.stringify(n,null,2);return await t.save(o.path,u),{ok:!0,path:o.path,slideCount:n.slides.length}}},loadFromStorage:{description:'Load one/many files from YAAR storage and merge into deck. Params: { path?: string, paths?: string[], mode?: "replace"|"append" }',params:{type:"object",properties:{path:{type:"string"},paths:{type:"array",items:{type:"string"}},mode:{type:"string",enum:["replace","append"]}}},handler:async(o)=>{let t=window.yaar?.storage;if(!t)return{ok:!1,error:"Storage API not available"};let u=[...o.path?[o.path]:[],...Array.isArray(o.paths)?o.paths:[]].filter((h)=>typeof h==="string"&&h.trim().length>0);if(!u.length)return{ok:!1,error:"Provide path or paths"};let g=[],i=n.title;for(let h of u){let $=await t.read(h,{as:"text"}),c=(h.split("/").pop()||h).replace(/\.[^/.]+$/,"")||"Imported Deck",U=ho($,c);if(!i||i==="Untitled Deck")i=U.title||i;g.push(...U.slides)}let f=o.mode||"replace";if(f==="append"){if(g.length)n.slides.push(...g);n.activeIndex=Math.max(0,n.slides.length-1)}else n.slides=g.length?g:[m()],n.activeIndex=0,n.title=i||n.title;return E(),M(!1),y(),{ok:!0,mode:f,loaded:g.length,paths:u}}},readStorageFile:{description:'Read one file from YAAR storage. Params: { path: string, as?: "text"|"json"|"auto" }',params:{type:"object",properties:{path:{type:"string"},as:{type:"string",enum:["text","json","auto"]}},required:["path"]},handler:async(o)=>{let t=window.yaar?.storage;if(!t)return{ok:!1,error:"Storage API not available"};let u=o.as||"text",g=await t.read(o.path,{as:u});return{ok:!0,path:o.path,as:u,content:g}}},readStorageFiles:{description:'Read many files from YAAR storage. Params: { paths: string[], as?: "text"|"json"|"auto" }',params:{type:"object",properties:{paths:{type:"array",items:{type:"string"}},as:{type:"string",enum:["text","json","auto"]}},required:["paths"]},handler:async(o)=>{let t=window.yaar?.storage;if(!t)return{ok:!1,error:"Storage API not available"};let u=o.as||"text",g=(Array.isArray(o.paths)?o.paths:[]).filter((f)=>typeof f==="string"&&f.trim().length>0),i=await Promise.all(g.map(async(f)=>({path:f,content:await t.read(f,{as:u})})));return{ok:!0,as:u,files:i}}}}});

</script>
</body>
</html>