<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recent Papers</title>
<style>*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden}body{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}</style>
<script>(function(){if(window.__yaarCaptureInstalled)return;window.__yaarCaptureInstalled=true;function respond(requestId,imageData){window.parent.postMessage({type:"yaar:capture-response",requestId,imageData},"*")}function inlineStyles(original,clone){var origEls=original.querySelectorAll("*");var cloneEls=clone.querySelectorAll("*");for(var i=0;i<origEls.length&&i<cloneEls.length;i++){var cs=window.getComputedStyle(origEls[i]);cloneEls[i].setAttribute("style",cs.cssText)}var rootCs=window.getComputedStyle(original);clone.setAttribute("style",rootCs.cssText)}function svgToCanvas(svgStr,w,h,cb){var blob=new Blob([svgStr],{type:"image/svg+xml;charset=utf-8"});var url=URL.createObjectURL(blob);var img=new Image;img.onload=function(){var c=document.createElement("canvas");c.width=w;c.height=h;var ctx=c.getContext("2d");ctx.drawImage(img,0,0,w,h);URL.revokeObjectURL(url);cb(c.toDataURL("image/png"))};img.onerror=function(){URL.revokeObjectURL(url);cb(null)};img.src=url}window.addEventListener("message",function(e){if(!e.data||e.data.type!=="yaar:capture-request")return;var requestId=e.data.requestId;var imageData=null;try{var canvases=document.querySelectorAll("canvas");if(canvases.length>0){var largest=null;var largestArea=0;for(var i=0;i<canvases.length;i++){var area=canvases[i].width*canvases[i].height;if(area>largestArea){largestArea=area;largest=canvases[i]}}if(largest){imageData=largest.toDataURL("image/png")}}if(imageData){respond(requestId,imageData);return}var svgs=document.querySelectorAll("svg");if(svgs.length>0){var largest=null;var largestArea=0;for(var i=0;i<svgs.length;i++){var rect=svgs[i].getBoundingClientRect();var area=rect.width*rect.height;if(area>largestArea){largestArea=area;largest=svgs[i]}}if(largest){var serializer=new XMLSerializer;var svgStr=serializer.serializeToString(largest);var rect=largest.getBoundingClientRect();svgToCanvas(svgStr,rect.width||300,rect.height||150,function(data){respond(requestId,data)});return}}var body=document.body;if(body){var w=Math.min(body.scrollWidth,window.innerWidth)||window.innerWidth||800;var h=Math.min(body.scrollHeight,window.innerHeight)||window.innerHeight||600;var clone=body.cloneNode(true);inlineStyles(body,clone);var remove=clone.querySelectorAll("script,iframe");for(var i=0;i<remove.length;i++)remove[i].remove();var xmlns="http://www.w3.org/1999/xhtml";var svgNS="http://www.w3.org/2000/svg";var xhtml=new XMLSerializer().serializeToString(clone);var svgStr='<svg xmlns="'+svgNS+'" width="'+w+'" height="'+h+'">'+'<foreignObject width="100%" height="100%">'+'<body xmlns="'+xmlns+'" style="margin:0;padding:0;">'+xhtml+"</body></foreignObject></svg>";svgToCanvas(svgStr,w,h,function(data){respond(requestId,data)});return}}catch(ex){}respond(requestId,null)})})();(function(){if(window.__yaarStorageInstalled)return;window.__yaarStorageInstalled=true;function encodePath(p){return p.split("/").map(encodeURIComponent).join("/")}window.yaar=window.yaar||{};window.yaar.storage={async save(path,data){var body;if(typeof data==="string"){body=data}else if(data instanceof Blob){body=await data.arrayBuffer()}else if(data instanceof ArrayBuffer){body=data}else if(data instanceof Uint8Array){body=data.buffer.slice(data.byteOffset,data.byteOffset+data.byteLength)}else{body=String(data)}var res=await fetch("/api/storage/"+encodePath(path),{method:"POST",body});if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Save failed")}return res.json()},async read(path,options){var mode=options&&options.as||"auto";var res=await fetch("/api/storage/"+encodePath(path));if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Read failed")}if(mode==="blob")return res.blob();if(mode==="arraybuffer")return res.arrayBuffer();if(mode==="json")return res.json();if(mode==="text")return res.text();var ct=res.headers.get("content-type")||"";if(ct.includes("json"))return res.json();if(ct.startsWith("text/"))return res.text();return res.blob()},async list(dirPath){var p=dirPath?encodePath(dirPath):"";var res=await fetch("/api/storage/"+p+"?list=true");if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"List failed")}return res.json()},async remove(path){var res=await fetch("/api/storage/"+encodePath(path),{method:"DELETE"});if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Delete failed")}return res.json()},url:function(path){return"/api/storage/"+encodePath(path)}}})();(function(){if(window.__yaarFetchProxyInstalled)return;window.__yaarFetchProxyInstalled=true;var realFetch=window.fetch.bind(window);var sessionId="";try{var sp=new URLSearchParams(location.search);var raw=sp.get("sessionId")||"";if(/^[a-zA-Z0-9_-]+$/.test(raw))sessionId=raw}catch(e){}window.fetch=function(input,init){var url;if(input instanceof Request){url=input.url}else{url=String(input)}if(url.startsWith("/")||url.startsWith("./")||url.startsWith("../")){return realFetch(input,init)}try{var parsed=new URL(url,location.origin);if(parsed.origin===location.origin){return realFetch(input,init)}}catch(e){return realFetch(input,init)}var method=init&&init.method||(input instanceof Request?input.method:"GET");var headers={};if(init&&init.headers){if(init.headers instanceof Headers){init.headers.forEach(function(v,k){headers[k]=v})}else if(Array.isArray(init.headers)){init.headers.forEach(function(pair){headers[pair[0]]=pair[1]})}else{headers=Object.assign({},init.headers)}}else if(input instanceof Request){input.headers.forEach(function(v,k){headers[k]=v})}var bodyPromise;if(init&&init.body!=null){if(typeof init.body==="string"){bodyPromise=Promise.resolve(init.body)}else{bodyPromise=new Response(init.body).text()}}else if(input instanceof Request&&method!=="GET"&&method!=="HEAD"){bodyPromise=input.text()}else{bodyPromise=Promise.resolve(undefined)}return bodyPromise.then(function(bodyStr){var payload={url,method,headers};if(bodyStr!==undefined)payload.body=bodyStr;if(sessionId)payload.sessionId=sessionId;return realFetch("/api/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)})}).then(function(proxyRes){if(!proxyRes.ok){return proxyRes.json().then(function(err){throw new Error(err.error||"Fetch proxy error: "+proxyRes.status)})}return proxyRes.json()}).then(function(data){var body;if(data.bodyEncoding==="base64"){var bin=atob(data.body);var bytes=new Uint8Array(bin.length);for(var i=0;i<bin.length;i++)bytes[i]=bin.charCodeAt(i);body=bytes.buffer}else{body=data.body}return new Response(body,{status:data.status,statusText:data.statusText,headers:data.headers})})}})();(function(){if(window.__yaarAppProtocolInstalled)return;window.__yaarAppProtocolInstalled=true;window.yaar=window.yaar||{};var registration=null;window.yaar.app={register:function(config){registration=config;window.parent.postMessage({type:"yaar:app-ready",appId:config.appId},"*")},sendInteraction:function(description){window.parent.postMessage({type:"yaar:app-interaction",content:typeof description==="string"?description:JSON.stringify(description)},"*")}};window.addEventListener("message",function(e){if(!e.data||!e.data.type)return;var msg=e.data;var requestId=msg.requestId;if(msg.type==="yaar:app-manifest-request"){if(!registration){window.parent.postMessage({type:"yaar:app-manifest-response",requestId,manifest:null,error:"No app registered"},"*");return}var manifest={appId:registration.appId,name:registration.name,state:{},commands:{}};if(registration.state){for(var key in registration.state){var s=registration.state[key];manifest.state[key]={description:s.description};if(s.schema)manifest.state[key].schema=s.schema}}if(registration.commands){for(var key in registration.commands){var c=registration.commands[key];manifest.commands[key]={description:c.description};if(c.params)manifest.commands[key].params=c.params;if(c.returns)manifest.commands[key].returns=c.returns}}window.parent.postMessage({type:"yaar:app-manifest-response",requestId,manifest},"*");return}if(msg.type==="yaar:app-query-request"){if(!registration||!registration.state||!registration.state[msg.stateKey]){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:"Unknown state key: "+msg.stateKey},"*");return}try{var result=registration.state[msg.stateKey].handler();if(result&&typeof result.then==="function"){result.then(function(data){window.parent.postMessage({type:"yaar:app-query-response",requestId,data},"*")}).catch(function(err){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:String(err)},"*")})}else{window.parent.postMessage({type:"yaar:app-query-response",requestId,data:result},"*")}}catch(err){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:String(err)},"*")}return}if(msg.type==="yaar:app-command-request"){if(!registration||!registration.commands||!registration.commands[msg.command]){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:"Unknown command: "+msg.command},"*");return}try{var result=registration.commands[msg.command].handler(msg.params);if(result&&typeof result.then==="function"){result.then(function(data){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:data},"*")}).catch(function(err){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:String(err)},"*")})}else{window.parent.postMessage({type:"yaar:app-command-response",requestId,result},"*")}}catch(err){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:String(err)},"*")}return}})})();</script>
</head>
<body>
<div id="app"></div>
<script type="module">
var _=`
  <style>
    :root {
      color-scheme: dark;
      --bg: #0f1117;
      --panel: #161a22;
      --muted: #9aa3b2;
      --text: #e7ecf3;
      --accent: #6ea8fe;
      --border: #2a3140;
      --good: #9ad08f;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow-y: auto;
    }
    .wrap { max-width: 980px; margin: 0 auto; padding: 16px; }
    .top { display:flex; gap:10px; align-items:center; flex-wrap: wrap; margin-bottom: 14px; }
    h1 { margin:0; font-size: 20px; }
    .spacer { flex:1; }
    .muted { color: var(--muted); font-size: 13px; }
    input, button, select {
      background: #202838; color: var(--text); border: 1px solid var(--border);
      border-radius: 10px; padding: 8px 10px; font: inherit;
    }
    button { cursor: pointer; }
    button:hover { border-color: #3b4660; }
    input { min-width: 270px; }
    .recommend-btn { border-color: #385995; }
    .recommend-box {
      margin-top: 10px;
      margin-bottom: 10px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #141a25;
      display: none;
    }
    .recommend-title { margin: 0 0 8px; color: var(--good); font-size: 14px; }
    .recommend-item { margin: 0 0 8px; font-size: 13px; color: #d5deea; }
    .recommend-item:last-child { margin-bottom: 0; }
    .recommend-item a { color: var(--accent); text-decoration: none; }
    .recommend-item a:hover { text-decoration: underline; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
    .card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    .card-inner { display: grid; grid-template-columns: 170px 1fr; gap: 12px; }
    .thumb { width: 100%; height: 100%; min-height: 130px; object-fit: cover; background: #11151f; }
    .content { padding: 12px 14px 14px 0; }
    .title { margin: 0 0 8px; font-size: 17px; line-height: 1.3; }
    .title a { color: var(--text); text-decoration: none; }
    .title a:hover { color: var(--accent); text-decoration: underline; }
    .meta { display:flex; gap:10px; flex-wrap:wrap; color: var(--muted); font-size: 12px; margin-bottom: 8px; }
    .summary { margin: 0; color: #cdd6e3; font-size: 14px; line-height: 1.45; }
    .links { margin-top: 10px; display:flex; gap:10px; flex-wrap: wrap; }
    .links a { color: var(--accent); font-size: 13px; text-decoration: none; }
    .links a:hover { text-decoration: underline; }
    .tag { display:inline-block; padding:2px 8px; border:1px solid var(--border); border-radius:99px; font-size:11px; }
    .empty { padding: 24px; text-align:center; border: 1px dashed var(--border); border-radius: 12px; color: var(--muted); }
    @media (max-width: 760px) {
      .card-inner { grid-template-columns: 1fr; }
      .content { padding: 0 12px 12px 12px; }
      .thumb { min-height: 180px; }
      input { min-width: 100%; }
    }
  </style>
  <div class="wrap">
    <div class="top">
      <h1>\uD83D\uDCDA Recent Papers</h1>
      <span class="muted">Sources: Hugging Face + arXiv</span>
      <div class="spacer"></div>

      <label class="muted" for="sourceMode">Source</label>
      <select id="sourceMode">
        <option value="huggingface" selected>Hugging Face</option>
        <option value="arxiv">arXiv</option>
        <option value="both">Both</option>
      </select>

      <label class="muted" for="limit">Limit</label>
      <select id="limit">
        <option value="10">10</option>
        <option value="20" selected>20</option>
        <option value="40">40</option>
      </select>

      <label class="muted" for="dayRange">Days</label>
      <select id="dayRange">
        <option value="all" selected>All</option>
        <option value="1">1 day</option>
        <option value="3">3 days</option>
        <option value="7">7 days</option>
        <option value="14">14 days</option>
        <option value="30">30 days</option>
      </select>

      <label class="muted" for="sortBy">Sort</label>
      <select id="sortBy">
        <option value="newest" selected>Newest</option>
        <option value="oldest">Oldest</option>
        <option value="vote">Most votes</option>
        <option value="comments">Most comments</option>
        <option value="title">Title (A→Z)</option>
      </select>

      <input id="arxivQuery" value="cat:cs.AI OR cat:cs.LG" placeholder="arXiv query (e.g. all:transformer OR cat:cs.AI)" />

      <button id="recommend2" class="recommend-btn">Recommend 2 papers</button>
      <button id="refresh">Refresh</button>
    </div>
    <div id="status" class="muted">Loading…</div>
    <div id="recommendations" class="recommend-box"></div>
    <div id="list" class="grid" style="margin-top:10px"></div>
  </div>
`;function j(e){if(!e)return"Unknown date";let t=new Date(e);if(Number.isNaN(t.getTime()))return e;return t.toLocaleString()}function s(e){return e.source||"huggingface"}function b(e){return e?.paper?.publishedAt||e?.publishedAt}function d(e){let t=b(e);if(!t)return 0;let r=new Date(t).getTime();return Number.isFinite(r)?r:0}function y(e){let t=e?.paper?.upvotes??e?.upvotes??0;return Number.isFinite(t)?t:0}function l(e){let t=e?.numComments??0;return Number.isFinite(t)?t:0}function f(e){return e?.paper?.id||e?.id||"unknown"}function h(e){return e?.paper?.title||e?.title||"Untitled paper"}function A(e){return e?.paper?.ai_summary||e?.summary||e?.paper?.summary||"No summary available."}function P(e){if(e?.arxiv?.absUrl)return e.arxiv.absUrl;return`https://arxiv.org/abs/${f(e)}`}function R(e){return String(e||"").replace(/\s+/g," ").trim()}function q(e){let t=String(e||"").trim();if(!t)return"";return t.match(/\/abs\/(.+)$/)?.[1]||t}function v(e,t){let r=e.getElementsByTagName(t)[0];return R(r?.textContent||"")}function O(e){return e==="vote"?"trending":"publishedAt"}async function X(e,t,r){let n=R(t||"cat:cs.AI OR cat:cs.LG")||"cat:cs.AI OR cat:cs.LG",o=r==="newest"?"submittedDate":"lastUpdatedDate",i=r==="oldest"?"ascending":"descending",x=`https://export.arxiv.org/api/query?search_query=${encodeURIComponent(n)}&start=0&max_results=${Math.max(1,e)}&sortBy=${o}&sortOrder=${i}`,g=await fetch(x);if(!g.ok)throw Error(`arXiv HTTP ${g.status}`);let D=await g.text(),$=new DOMParser().parseFromString(D,"application/xml");if($.querySelector("parsererror"))throw Error("arXiv feed parse error");return Array.from($.getElementsByTagName("entry")).map((p)=>{let z=v(p,"id"),H=q(z),te=v(p,"title"),re=v(p,"summary"),ae=v(p,"published")||v(p,"updated"),ne=Array.from(p.getElementsByTagName("author")).map((B)=>v(B,"name")).filter(Boolean),oe=Array.from(p.getElementsByTagName("link")).find((B)=>B.getAttribute("title")==="pdf")?.getAttribute("href")||"",ie=(p.getElementsByTagName("arxiv:primary_category")[0]||p.getElementsByTagName("primary_category")[0])?.getAttribute("term")||"";return{source:"arxiv",id:H,title:te,summary:re,publishedAt:ae,upvotes:0,numComments:0,arxiv:{absUrl:z||`https://arxiv.org/abs/${H}`,pdfUrl:oe||`https://arxiv.org/pdf/${H}.pdf`,primaryCategory:ie,authors:ne}}})}async function Q(e,t){let r=O(t),a=await fetch(`https://huggingface.co/api/daily_papers?limit=${e}&sort=${r}`);if(!a.ok)throw Error(`HF HTTP ${a.status}`);let n=await a.json();return(Array.isArray(n)?n:[]).map((o)=>({...o,source:"huggingface"}))}async function N(e,t){let r=String(e||"").trim();if(!r)throw Error("Missing paper id");if(t[r])return t[r];let a=await fetch(`https://huggingface.co/api/papers/${encodeURIComponent(r)}`);if(!a.ok)throw Error(`HTTP ${a.status}`);let n=await a.json(),o={id:n?.id||r,title:n?.title||"",summary:n?.summary||"",aiSummary:n?.ai_summary||"",keywords:Array.isArray(n?.ai_keywords)?n.ai_keywords:[],authors:Array.isArray(n?.authors)?n.authors.map((i)=>i?.name).filter(Boolean):[],upvotes:Number(n?.upvotes||0),publishedAt:n?.publishedAt||"",projectPage:n?.projectPage||"",githubRepo:n?.githubRepo||"",githubStars:Number(n?.githubStars||0),links:{huggingFace:`https://huggingface.co/papers/${n?.id||r}`,arxiv:`https://arxiv.org/abs/${n?.id||r}`}};return t[r]=o,o}function se(e,t){if(!t.length){e.style.display="none",e.innerHTML="";return}e.style.display="block",e.innerHTML=`
    <h3 class="recommend-title">\uD83E\uDD16 Today's 2 recommended papers</h3>
    ${t.map((r,a)=>`
      <p class="recommend-item">
        <strong>${a+1}.</strong>
        <a href="${r.url||`https://arxiv.org/abs/${r.id}`}" target="_blank" rel="noreferrer">${r.title}</a>
        — ${r.reason} (\uD83D\uDC4D ${r.upvotes}, \uD83D\uDCAC ${r.comments})
      </p>
    `).join("")}
  `}function Z(e){let t=s(e),r=f(e),a=h(e),n=A(e),o=b(e),i=e?.organization?.fullname||e?.organization?.name||e?.arxiv?.primaryCategory,x=l(e),g=y(e);return`
    <article class="card">
      <div class="card-inner">
        <img class="thumb" src="${t==="huggingface"?e?.thumbnail||"https://huggingface.co/front/assets/huggingface_logo-noborder.svg":"https://static.arxiv.org/static/browse/0.3.4/images/arxiv-logo-one-color-white.svg"}" alt="thumbnail for ${a.replace(/"/g,"&quot;")}" loading="lazy" />
        <div class="content">
          <h2 class="title"><a href="${P(e)}" target="_blank" rel="noreferrer">${a}</a></h2>
          <div class="meta">
            <span class="tag">${t==="huggingface"?"Hugging Face":"arXiv"}</span>
            <span>\uD83D\uDDD3 ${j(o)}</span>
            <span>\uD83D\uDC4D ${g}</span>
            <span>\uD83D\uDCAC ${x} comments</span>
            ${i?`<span>\uD83C\uDFF7 ${i}</span>`:""}
          </div>
          <p class="summary">${n}</p>
          <div class="links">
            ${t==="huggingface"?`<a href="https://huggingface.co/papers/${r}" target="_blank" rel="noreferrer">Hugging Face</a>`:""}
            <a href="${P(e)}" target="_blank" rel="noreferrer">arXiv</a>
            ${e?.arxiv?.pdfUrl?`<a href="${e.arxiv.pdfUrl}" target="_blank" rel="noreferrer">PDF</a>`:""}
          </div>
        </div>
      </div>
    </article>
  `}function G(e,t){if(!t.length)return`
      <section style="margin-top: 12px;">
        <h3 style="margin: 0 0 10px; font-size: 15px; color: #cfd8e6;">${e} (0)</h3>
        <div class="empty">No papers available for this source.</div>
      </section>
    `;return`
    <section style="margin-top: 12px;">
      <h3 style="margin: 0 0 10px; font-size: 15px; color: #cfd8e6;">${e} (${t.length})</h3>
      <div class="grid">${t.map((r)=>Z(r)).join("")}</div>
    </section>
  `}function J({statusEl:e,listEl:t,recommendBoxEl:r,papers:a,sourcePapers:n,recommendations:o,loading:i,sourceMode:x}){let g=a.filter((c)=>s(c)==="huggingface").length,D=a.filter((c)=>s(c)==="arxiv").length;if(e.textContent=i?"Loading papers...":`Showing ${a.length} of ${n.length} papers (HF ${g} • arXiv ${D}) • Last updated ${new Date().toLocaleTimeString()}`,se(r,o),!a.length){t.innerHTML='<div class="empty">No papers available for this filter.</div>';return}if(x==="both"){let c=a.filter((E)=>s(E)==="huggingface"),$=a.filter((E)=>s(E)==="arxiv");t.innerHTML=`${G("Hugging Face Papers",c)}${G("arXiv Papers",$)}`;return}t.innerHTML=`<div class="grid">${a.map((c)=>Z(c)).join("")}</div>`}var W=document.createElement("div");W.innerHTML=_;document.body.appendChild(W);var Y=document.getElementById("status"),pe=document.getElementById("list"),M=document.getElementById("sourceMode"),k=document.getElementById("limit"),F=document.getElementById("dayRange"),w=document.getElementById("sortBy"),U=document.getElementById("arxivQuery"),le=document.getElementById("recommendations"),ce=document.getElementById("recommend2"),de=document.getElementById("refresh"),I=[],m=[],T=[],C={},S=!1;function V(){let e=F.value,t=w.value,r=[...I];if(e!=="all"){let a=Number(e);if(Number.isFinite(a)&&a>0){let n=Date.now()-a*24*60*60*1000;r=r.filter((o)=>d(o)>=n)}}if(t==="newest")r.sort((a,n)=>d(n)-d(a));else if(t==="oldest")r.sort((a,n)=>d(a)-d(n));else if(t==="vote")r.sort((a,n)=>{let o=y(n)-y(a);if(o!==0)return o;let i=l(n)-l(a);if(i!==0)return i;return d(n)-d(a)});else if(t==="comments")r.sort((a,n)=>l(n)-l(a));else if(t==="title")r.sort((a,n)=>h(a).localeCompare(h(n)));m=r}function L(){J({statusEl:Y,listEl:pe,recommendBoxEl:le,papers:m,sourcePapers:I,recommendations:T,loading:S,sourceMode:M.value})}async function u(){if(S)return;S=!0,L();try{let e=Number(k.value||20),t=M.value,r=[],a=[];if(t==="huggingface"||t==="both"){let n=t==="both"?Math.ceil(e/2):e;r=await Q(n,w.value)}if(t==="arxiv"||t==="both"){let n=t==="both"?Math.floor(e/2)||1:e;a=await X(n,U.value,w.value)}I=[...r,...a],V()}catch(e){I=[],m=[],Y.textContent=`Failed to load papers: ${e?.message||String(e)}`}finally{S=!1,L()}}function me(){V(),L()}function ee(e){let t={event:"recent-papers:recommend-2",source:e,date:new Date().toISOString(),context:{mode:M.value,arxivQuery:U.value,limit:Number(k.value||20),dayRange:F.value,sortBy:w.value,visibleCount:m.length},papers:m.slice(0,Math.max(1,Number(k.value||20))).map((r)=>({id:f(r),title:h(r),source:s(r),summary:r?.summary||r?.paper?.summary||"",aiSummary:r?.paper?.ai_summary||"",upvotes:y(r),comments:l(r),publishedAt:b(r),authors:s(r)==="arxiv"?r?.arxiv?.authors||[]:(r?.paper?.authors||[]).map((a)=>a?.name).filter(Boolean),links:{huggingFace:`https://huggingface.co/papers/${f(r)}`,arxiv:P(r)}}))};window.yaar?.app?.sendInteraction?.(t)}de.addEventListener("click",()=>u());M.addEventListener("change",()=>u());k.addEventListener("change",()=>u());F.addEventListener("change",()=>me());w.addEventListener("change",async()=>u());U.addEventListener("keydown",(e)=>{if(e.key==="Enter")u()});ce.addEventListener("click",()=>ee("button"));u();var K=window.yaar?.app;if(K)K.register({appId:"recent-papers",name:"Recent Papers",state:{papers:{description:"Current filtered paper list loaded in the UI",handler:()=>m.map((e)=>({id:f(e),source:s(e),title:h(e),summary:A(e),upvotes:y(e),comments:l(e)}))},recommendations:{description:"Current recommended papers",handler:()=>T},paperDetailsCache:{description:"Cached detailed paper data fetched by paper id",handler:()=>C}},commands:{refresh:{description:"Reload papers from selected sources",params:{type:"object",properties:{}},handler:async()=>{return await u(),{ok:!0,count:m.length}}},recommendTop2Today:{description:"Ask the AI agent to recommend 2 papers from current context",params:{type:"object",properties:{}},handler:async()=>{if(!I.length)await u();return ee("app-command"),{ok:!0,queued:!0,candidateCount:m.length}}},fetchPaperDetails:{description:"Fetch detailed summary/content metadata for one Hugging Face paper by id",params:{type:"object",properties:{id:{type:"string"}},required:["id"]},handler:async(e)=>{return{ok:!0,detail:await N(e.id,C)}}},fetchPaperDetailsBatch:{description:"Fetch detailed summary/content metadata for multiple Hugging Face paper ids",params:{type:"object",properties:{ids:{type:"array",items:{type:"string"}}},required:["ids"]},handler:async(e)=>{let t=Array.isArray(e.ids)?e.ids.filter(Boolean).slice(0,20):[],r=[];for(let a of t)try{r.push(await N(a,C))}catch(n){r.push({id:a,error:n?.message||String(n)})}return{ok:!0,count:r.length,details:r}}},setRecommendations:{description:"Set AI-generated recommendations to display in the UI",params:{type:"object",properties:{recommendations:{type:"array",items:{type:"object",properties:{id:{type:"string"},title:{type:"string"},reason:{type:"string"},upvotes:{type:"number"},comments:{type:"number"},source:{type:"string"},url:{type:"string"}},required:["id","title","reason"]}}},required:["recommendations"]},handler:async(e)=>{return T=(e.recommendations||[]).slice(0,2).map((t)=>({id:String(t.id||""),title:String(t.title||"Untitled paper"),reason:String(t.reason||""),upvotes:Number(t.upvotes||0),comments:Number(t.comments||0),source:t.source||"arxiv",url:String(t.url||"")})),L(),{ok:!0,count:T.length}}}}});

</script>
</body>
</html>