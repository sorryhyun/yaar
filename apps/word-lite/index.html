<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Word Lite</title>
<style>*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden}body{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}</style>
<script>(function(){if(window.__yaarCaptureInstalled)return;window.__yaarCaptureInstalled=true;function respond(requestId,imageData){window.parent.postMessage({type:"yaar:capture-response",requestId,imageData},"*")}function inlineStyles(original,clone){var origEls=original.querySelectorAll("*");var cloneEls=clone.querySelectorAll("*");for(var i=0;i<origEls.length&&i<cloneEls.length;i++){var cs=window.getComputedStyle(origEls[i]);cloneEls[i].setAttribute("style",cs.cssText)}var rootCs=window.getComputedStyle(original);clone.setAttribute("style",rootCs.cssText)}function svgToCanvas(svgStr,w,h,cb){var blob=new Blob([svgStr],{type:"image/svg+xml;charset=utf-8"});var url=URL.createObjectURL(blob);var img=new Image;img.onload=function(){var c=document.createElement("canvas");c.width=w;c.height=h;var ctx=c.getContext("2d");ctx.drawImage(img,0,0,w,h);URL.revokeObjectURL(url);cb(c.toDataURL("image/png"))};img.onerror=function(){URL.revokeObjectURL(url);cb(null)};img.src=url}window.addEventListener("message",function(e){if(!e.data||e.data.type!=="yaar:capture-request")return;var requestId=e.data.requestId;var imageData=null;try{var canvases=document.querySelectorAll("canvas");if(canvases.length>0){var largest=null;var largestArea=0;for(var i=0;i<canvases.length;i++){var area=canvases[i].width*canvases[i].height;if(area>largestArea){largestArea=area;largest=canvases[i]}}if(largest){imageData=largest.toDataURL("image/png")}}if(imageData){respond(requestId,imageData);return}var svgs=document.querySelectorAll("svg");if(svgs.length>0){var largest=null;var largestArea=0;for(var i=0;i<svgs.length;i++){var rect=svgs[i].getBoundingClientRect();var area=rect.width*rect.height;if(area>largestArea){largestArea=area;largest=svgs[i]}}if(largest){var serializer=new XMLSerializer;var svgStr=serializer.serializeToString(largest);var rect=largest.getBoundingClientRect();svgToCanvas(svgStr,rect.width||300,rect.height||150,function(data){respond(requestId,data)});return}}var body=document.body;if(body){var w=Math.min(body.scrollWidth,window.innerWidth)||window.innerWidth||800;var h=Math.min(body.scrollHeight,window.innerHeight)||window.innerHeight||600;var clone=body.cloneNode(true);inlineStyles(body,clone);var remove=clone.querySelectorAll("script,iframe");for(var i=0;i<remove.length;i++)remove[i].remove();var xmlns="http://www.w3.org/1999/xhtml";var svgNS="http://www.w3.org/2000/svg";var xhtml=new XMLSerializer().serializeToString(clone);var svgStr='<svg xmlns="'+svgNS+'" width="'+w+'" height="'+h+'">'+'<foreignObject width="100%" height="100%">'+'<body xmlns="'+xmlns+'" style="margin:0;padding:0;">'+xhtml+"</body></foreignObject></svg>";svgToCanvas(svgStr,w,h,function(data){respond(requestId,data)});return}}catch(ex){}respond(requestId,null)})})();(function(){if(window.__yaarStorageInstalled)return;window.__yaarStorageInstalled=true;function encodePath(p){return p.split("/").map(encodeURIComponent).join("/")}window.yaar=window.yaar||{};window.yaar.storage={async save(path,data){var body;if(typeof data==="string"){body=data}else if(data instanceof Blob){body=await data.arrayBuffer()}else if(data instanceof ArrayBuffer){body=data}else if(data instanceof Uint8Array){body=data.buffer.slice(data.byteOffset,data.byteOffset+data.byteLength)}else{body=String(data)}var res=await fetch("/api/storage/"+encodePath(path),{method:"POST",body});if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Save failed")}return res.json()},async read(path,options){var mode=options&&options.as||"auto";var res=await fetch("/api/storage/"+encodePath(path));if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Read failed")}if(mode==="blob")return res.blob();if(mode==="arraybuffer")return res.arrayBuffer();if(mode==="json")return res.json();if(mode==="text")return res.text();var ct=res.headers.get("content-type")||"";if(ct.includes("json"))return res.json();if(ct.startsWith("text/"))return res.text();return res.blob()},async list(dirPath){var p=dirPath?encodePath(dirPath):"";var res=await fetch("/api/storage/"+p+"?list=true");if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"List failed")}return res.json()},async remove(path){var res=await fetch("/api/storage/"+encodePath(path),{method:"DELETE"});if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Delete failed")}return res.json()},url:function(path){return"/api/storage/"+encodePath(path)}}})();(function(){if(window.__yaarFetchProxyInstalled)return;window.__yaarFetchProxyInstalled=true;var realFetch=window.fetch.bind(window);var sessionId="";try{var sp=new URLSearchParams(location.search);var raw=sp.get("sessionId")||"";if(/^[a-zA-Z0-9_-]+$/.test(raw))sessionId=raw}catch(e){}window.fetch=function(input,init){var url;if(input instanceof Request){url=input.url}else{url=String(input)}if(url.startsWith("/")||url.startsWith("./")||url.startsWith("../")){return realFetch(input,init)}try{var parsed=new URL(url,location.origin);if(parsed.origin===location.origin){return realFetch(input,init)}}catch(e){return realFetch(input,init)}var method=init&&init.method||(input instanceof Request?input.method:"GET");var headers={};if(init&&init.headers){if(init.headers instanceof Headers){init.headers.forEach(function(v,k){headers[k]=v})}else if(Array.isArray(init.headers)){init.headers.forEach(function(pair){headers[pair[0]]=pair[1]})}else{headers=Object.assign({},init.headers)}}else if(input instanceof Request){input.headers.forEach(function(v,k){headers[k]=v})}var bodyPromise;if(init&&init.body!=null){if(typeof init.body==="string"){bodyPromise=Promise.resolve(init.body)}else{bodyPromise=new Response(init.body).text()}}else if(input instanceof Request&&method!=="GET"&&method!=="HEAD"){bodyPromise=input.text()}else{bodyPromise=Promise.resolve(undefined)}return bodyPromise.then(function(bodyStr){var payload={url,method,headers};if(bodyStr!==undefined)payload.body=bodyStr;if(sessionId)payload.sessionId=sessionId;return realFetch("/api/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)})}).then(function(proxyRes){if(!proxyRes.ok){return proxyRes.json().then(function(err){throw new Error(err.error||"Fetch proxy error: "+proxyRes.status)})}return proxyRes.json()}).then(function(data){var body;if(data.bodyEncoding==="base64"){var bin=atob(data.body);var bytes=new Uint8Array(bin.length);for(var i=0;i<bin.length;i++)bytes[i]=bin.charCodeAt(i);body=bytes.buffer}else{body=data.body}return new Response(body,{status:data.status,statusText:data.statusText,headers:data.headers})})}})();(function(){if(window.__yaarAppProtocolInstalled)return;window.__yaarAppProtocolInstalled=true;window.yaar=window.yaar||{};var registration=null;window.yaar.app={register:function(config){registration=config;window.parent.postMessage({type:"yaar:app-ready",appId:config.appId},"*")},sendInteraction:function(description){window.parent.postMessage({type:"yaar:app-interaction",content:typeof description==="string"?description:JSON.stringify(description)},"*")}};window.addEventListener("message",function(e){if(!e.data||!e.data.type)return;var msg=e.data;var requestId=msg.requestId;if(msg.type==="yaar:app-manifest-request"){if(!registration){window.parent.postMessage({type:"yaar:app-manifest-response",requestId,manifest:null,error:"No app registered"},"*");return}var manifest={appId:registration.appId,name:registration.name,state:{},commands:{}};if(registration.state){for(var key in registration.state){var s=registration.state[key];manifest.state[key]={description:s.description};if(s.schema)manifest.state[key].schema=s.schema}}if(registration.commands){for(var key in registration.commands){var c=registration.commands[key];manifest.commands[key]={description:c.description};if(c.params)manifest.commands[key].params=c.params;if(c.returns)manifest.commands[key].returns=c.returns}}window.parent.postMessage({type:"yaar:app-manifest-response",requestId,manifest},"*");return}if(msg.type==="yaar:app-query-request"){if(!registration||!registration.state||!registration.state[msg.stateKey]){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:"Unknown state key: "+msg.stateKey},"*");return}try{var result=registration.state[msg.stateKey].handler();if(result&&typeof result.then==="function"){result.then(function(data){window.parent.postMessage({type:"yaar:app-query-response",requestId,data},"*")}).catch(function(err){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:String(err)},"*")})}else{window.parent.postMessage({type:"yaar:app-query-response",requestId,data:result},"*")}}catch(err){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:String(err)},"*")}return}if(msg.type==="yaar:app-command-request"){if(!registration||!registration.commands||!registration.commands[msg.command]){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:"Unknown command: "+msg.command},"*");return}try{var result=registration.commands[msg.command].handler(msg.params);if(result&&typeof result.then==="function"){result.then(function(data){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:data},"*")}).catch(function(err){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:String(err)},"*")})}else{window.parent.postMessage({type:"yaar:app-command-response",requestId,result},"*")}}catch(err){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:String(err)},"*")}return}})})();</script>
</head>
<body>
<div id="app"></div>
<script type="module">
var J=`
:root {
  --bg: #0f172a;
  --panel: #111827;
  --toolbar: #1f2937;
  --surface: #ffffff;
  --text: #111827;
  --muted: #6b7280;
  --accent: #2563eb;
  --border: #e5e7eb;
}

* { box-sizing: border-box; }
html, body {
  margin: 0;
  height: 100%;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: var(--bg);
}

#app {
  height: 100%;
}

.app-shell {
  display: grid;
  grid-template-rows: auto auto 1fr auto;
  height: 100%;
  color: #e5e7eb;
}

.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 14px;
  background: var(--panel);
  border-bottom: 1px solid #374151;
}

.brand {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 700;
}

.doc-meta {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

#doc-title {
  min-width: 220px;
}

.brand-badge {
  width: 26px;
  height: 26px;
  border-radius: 7px;
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 13px;
}

.toolbar {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  padding: 10px 12px;
  background: var(--toolbar);
  border-bottom: 1px solid #374151;
}

.group {
  display: inline-flex;
  gap: 6px;
  padding-right: 8px;
  margin-right: 4px;
  border-right: 1px solid #374151;
}

.group:last-child {
  border-right: 0;
  padding-right: 0;
}

button, select, input {
  border: 1px solid #4b5563;
  background: #111827;
  color: #f3f4f6;
  border-radius: 8px;
  padding: 6px 10px;
  font-size: 13px;
  cursor: pointer;
}

button:hover, select:hover, input:hover {
  border-color: #9ca3af;
}

button.primary {
  background: var(--accent);
  border-color: #1e40af;
}

.editor-wrap {
  overflow: auto;
  padding: 24px;
  background: #0b1220;
}

.page {
  max-width: 860px;
  min-height: calc(100% - 4px);
  margin: 0 auto;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  box-shadow: 0 10px 24px rgba(0,0,0,0.22);
  color: var(--text);
  padding: 36px 44px;
  outline: none;
  line-height: 1.5;
  font-size: 16px;
  cursor: text;
}

.page a,
.page a:link,
.page a:visited,
.page a:hover,
.page a:active,
.page a:focus,
.page a * {
  cursor: pointer !important;
}

.page a:hover {
  text-decoration: underline;
}

.page:empty:before {
  content: attr(data-placeholder);
  color: #9ca3af;
}

.statusbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: var(--panel);
  border-top: 1px solid #374151;
  color: #d1d5db;
  font-size: 12px;
}

#app.focus-mode .topbar,
#app.focus-mode .toolbar,
#app.focus-mode .statusbar {
  display: none;
}

#app.focus-mode .editor-wrap {
  padding: 12px;
}

.muted {
  color: var(--muted);
}
`;var j="word-lite-document-v2",C="word-lite-document-v1";function B(n,t=500){let r=null;return(...e)=>{if(r)window.clearTimeout(r);r=window.setTimeout(()=>n(...e),t)}}function V(n){let t=n.trim();return{words:t?t.split(/\s+/).length:0,chars:n.length}}function P(n,t){let r=URL.createObjectURL(t),e=document.createElement("a");e.href=r,e.download=n,e.click(),URL.revokeObjectURL(r)}function X(n,t,r){P(n,new Blob([t],{type:r}))}function z(){return new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function D(n){let t=n.trim().toLowerCase();if(!t)return"document";return t.replace(/[^a-z0-9\s-_]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").slice(0,60)||"document"}var Q=new TextEncoder;function W(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function _(n){let t=n.reduce((c,s)=>c+s.length,0),r=new Uint8Array(t),e=0;for(let c of n)r.set(c,e),e+=c.length;return r}function Y(){let n=new Uint32Array(256);for(let t=0;t<256;t++){let r=t;for(let e=0;e<8;e++)r=r&1?3988292384^r>>>1:r>>>1;n[t]=r>>>0}return n}var T=Y();function M(n){let t=4294967295;for(let r=0;r<n.length;r++)t=T[(t^n[r])&255]^t>>>8;return(t^4294967295)>>>0}function E(n=new Date){let t=Math.max(1980,n.getFullYear()),r=n.getMonth()+1,e=n.getDate(),c=n.getHours(),s=n.getMinutes(),p=Math.floor(n.getSeconds()/2),a=t-1980<<9|r<<5|e,x=c<<11|s<<5|p;return{date:a,time:x}}function F(n){let t=[],r=[],e=E(new Date),c=0;for(let x of n){let h=Q.encode(x.name),w=typeof x.data==="string"?Q.encode(x.data):x.data,Z=M(w),k=new Uint8Array(30+h.length),g=new DataView(k.buffer);g.setUint32(0,67324752,!0),g.setUint16(4,20,!0),g.setUint16(6,0,!0),g.setUint16(8,0,!0),g.setUint16(10,e.time,!0),g.setUint16(12,e.date,!0),g.setUint32(14,Z,!0),g.setUint32(18,w.length,!0),g.setUint32(22,w.length,!0),g.setUint16(26,h.length,!0),g.setUint16(28,0,!0),k.set(h,30);let R=new Uint8Array(46+h.length),m=new DataView(R.buffer);m.setUint32(0,33639248,!0),m.setUint16(4,20,!0),m.setUint16(6,20,!0),m.setUint16(8,0,!0),m.setUint16(10,0,!0),m.setUint16(12,e.time,!0),m.setUint16(14,e.date,!0),m.setUint32(16,Z,!0),m.setUint32(20,w.length,!0),m.setUint32(24,w.length,!0),m.setUint16(28,h.length,!0),m.setUint16(30,0,!0),m.setUint16(32,0,!0),m.setUint16(34,0,!0),m.setUint16(36,0,!0),m.setUint32(38,0,!0),m.setUint32(42,c,!0),R.set(h,46),t.push(k,w),r.push(R),c+=k.length+w.length}let s=_(r),p=new Uint8Array(22),a=new DataView(p.buffer);return a.setUint32(0,101010256,!0),a.setUint16(4,0,!0),a.setUint16(6,0,!0),a.setUint16(8,n.length,!0),a.setUint16(10,n.length,!0),a.setUint32(12,s.length,!0),a.setUint32(16,c,!0),a.setUint16(20,0,!0),_([...t,s,p])}function G(n,t){let e=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<w:document xmlns:wpc="http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:wp14="http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing" xmlns:wp="http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing" xmlns:w10="urn:schemas-microsoft-com:office:word" xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main" xmlns:w14="http://schemas.microsoft.com/office/word/2010/wordml" xmlns:wpg="http://schemas.microsoft.com/office/word/2010/wordprocessingGroup" xmlns:wpi="http://schemas.microsoft.com/office/word/2010/wordprocessingInk" xmlns:wne="http://schemas.microsoft.com/office/word/2006/wordml" xmlns:wps="http://schemas.microsoft.com/office/word/2010/wordprocessingShape" mc:Ignorable="w14 wp14">
  <w:body>
    ${(t||"").replace(/\r\n/g,`
`).split(`
`).map((x)=>`<w:p><w:r><w:t xml:space="preserve">${W(x)}</w:t></w:r></w:p>`).join("")||"<w:p />"}
    <w:sectPr>
      <w:pgSz w:w="12240" w:h="15840" />
      <w:pgMar w:top="1440" w:right="1440" w:bottom="1440" w:left="1440" w:header="708" w:footer="708" w:gutter="0"/>
      <w:cols w:space="708"/>
      <w:docGrid w:linePitch="360"/>
    </w:sectPr>
  </w:body>
</w:document>`,c=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
  <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>
  <Default Extension="xml" ContentType="application/xml"/>
  <Override PartName="/word/document.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml"/>
</Types>`,s=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="word/document.xml"/>
</Relationships>`,p=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<cp:coreProperties xmlns:cp="http://schemas.openxmlformats.org/package/2006/metadata/core-properties" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:dcmitype="http://purl.org/dc/dcmitype/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <dc:title>${W(n||"Untitled Document")}</dc:title>
</cp:coreProperties>`,a=F([{name:"[Content_Types].xml",data:`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
  <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>
  <Default Extension="xml" ContentType="application/xml"/>
  <Override PartName="/word/document.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml"/>
</Types>`},{name:"_rels/.rels",data:`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="word/document.xml"/>
</Relationships>`},{name:"docProps/core.xml",data:p},{name:"word/document.xml",data:e}]);return new Blob([a],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"})}var A=document.getElementById("app")||document.body;A.innerHTML=`
  <style>${J}</style>
  <div class="app-shell">
    <div class="topbar">
      <div class="brand"><span class="brand-badge">W</span> Word Lite</div>
      <div class="doc-meta">
        <label for="doc-title" class="muted">Title</label>
        <input id="doc-title" type="text" placeholder="Untitled Document" maxlength="100" />
      </div>
    </div>

    <div class="toolbar">
      <div class="group">
        <button data-cmd="bold"><b>B</b></button>
        <button data-cmd="italic"><i>I</i></button>
        <button data-cmd="underline"><u>U</u></button>
      </div>

      <div class="group">
        <select id="format-block" title="Style">
          <option value="P">Paragraph</option>
          <option value="H1">Heading 1</option>
          <option value="H2">Heading 2</option>
          <option value="H3">Heading 3</option>
          <option value="BLOCKQUOTE">Quote</option>
        </select>
      </div>

      <div class="group">
        <button data-cmd="justifyLeft">Left</button>
        <button data-cmd="justifyCenter">Center</button>
        <button data-cmd="justifyRight">Right</button>
        <button data-cmd="insertUnorderedList">• List</button>
        <button data-cmd="insertOrderedList">1. List</button>
      </div>

      <div class="group">
        <button id="btn-link">Link</button>
        <button data-cmd="removeFormat">Clear</button>
        <button data-cmd="undo">Undo</button>
        <button data-cmd="redo">Redo</button>
      </div>

      <div class="group">
        <button id="btn-new">New</button>
        <button id="btn-open">Open</button>
        <button id="btn-save" class="primary">Save</button>
        <button id="btn-export-txt">.txt</button>
        <button id="btn-export-html">.html</button>
        <button id="btn-export-docx">.docx</button>
        <button id="btn-focus">Focus</button>
      </div>
    </div>

    <div class="editor-wrap">
      <article id="editor" class="page" contenteditable="true" spellcheck="true" data-placeholder="Start typing..."></article>
      <input id="file-input" type="file" accept=".txt,.html,.htm" style="display:none" />
    </div>

    <div class="statusbar">
      <span id="stats">0 words • 0 chars</span>
      <span id="save-state">Not saved</span>
    </div>
  </div>
`;var o=document.getElementById("editor"),U=document.getElementById("file-input"),H=document.getElementById("stats"),i=document.getElementById("save-state"),I=document.getElementById("format-block"),f=document.getElementById("doc-title"),b=!1,y=()=>(f.value||"").trim()||"Untitled Document",O=()=>D(y()),d=(n,t)=>{o.focus(),document.execCommand(n,!1,t),u()},u=()=>{let{words:n,chars:t}=V(o.innerText||""),r=n===0?0:Math.max(1,Math.ceil(n/200));H.textContent=`${n} words • ${t} chars • ${r} min read`},l=()=>{let n={html:o.innerHTML,title:y(),savedAt:Date.now()};localStorage.setItem(j,JSON.stringify(n)),i.textContent=`Saved at ${z()}`},N=B(()=>{l()},550),v=()=>{let n=localStorage.getItem(j);if(n){try{let t=JSON.parse(n);o.innerHTML=t.html||"<h1>Untitled Document</h1><p></p>",f.value=t.title||"Untitled Document"}catch{o.innerHTML=n,f.value="Untitled Document"}i.textContent="Loaded saved draft"}else{let t=localStorage.getItem(C);if(t)o.innerHTML=t,f.value="Untitled Document",i.textContent="Loaded saved draft",l(),localStorage.removeItem(C);else o.innerHTML="<h1>Untitled Document</h1><p></p>",f.value="Untitled Document",i.textContent="New document"}u()};for(let n of Array.from(document.querySelectorAll("button[data-cmd]")))n.addEventListener("click",()=>{let t=n.dataset.cmd;d(t)});I.addEventListener("change",()=>{d("formatBlock",I.value)});document.getElementById("btn-link")?.addEventListener("click",()=>{let n=prompt("Enter URL (https://...)");if(!n)return;d("createLink",n)});document.getElementById("btn-new")?.addEventListener("click",()=>{if(!confirm("Start a new blank document?"))return;o.innerHTML="<p></p>",f.value="Untitled Document",u(),i.textContent="Unsaved new document",o.focus()});document.getElementById("btn-open")?.addEventListener("click",()=>{U.value="",U.click()});document.getElementById("btn-save")?.addEventListener("click",()=>{l()});document.getElementById("btn-focus")?.addEventListener("click",()=>{b=!b,A.classList.toggle("focus-mode",b),i.textContent=b?"Focus mode enabled":"Focus mode disabled"});document.getElementById("btn-export-txt")?.addEventListener("click",()=>{X(`${O()}.txt`,o.innerText||"","text/plain;charset=utf-8")});document.getElementById("btn-export-html")?.addEventListener("click",()=>{let t=`<!doctype html><html><head><meta charset="utf-8"><title>${y()}</title></head><body>${o.innerHTML}</body></html>`;X(`${O()}.html`,t,"text/html;charset=utf-8")});document.getElementById("btn-export-docx")?.addEventListener("click",()=>{let n=G(y(),o.innerText||"");P(`${O()}.docx`,n),i.textContent=`Exported .docx at ${z()}`});U.addEventListener("change",async()=>{let n=U.files?.[0];if(!n)return;let t=await n.text();if(/\.html?$/i.test(n.name))o.innerHTML=t;else{let r=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");o.innerHTML=`<p>${r}</p>`}f.value=n.name.replace(/\.[^/.]+$/,"")||"Untitled Document",u(),i.textContent=`Opened ${n.name}`,l()});o.addEventListener("input",()=>{u(),i.textContent="Editing…",N()});f.addEventListener("input",()=>{i.textContent="Editing title…",N()});o.addEventListener("keyup",u);var S=(n)=>{if(!n)return;try{let t=new URL(n,window.location.href);if(!["http:","https:","mailto:","tel:"].includes(t.protocol)){alert(`Unsupported link protocol: ${t.protocol}`);return}window.open(t.href,"_blank","noopener,noreferrer")}catch{alert("Invalid URL")}};o.addEventListener("click",(n)=>{let r=n.target?.closest("a");if(!r)return;n.preventDefault(),S(r.getAttribute("href"))});document.addEventListener("keydown",(n)=>{if(n.key==="Escape"&&b){b=!1,A.classList.remove("focus-mode"),i.textContent="Focus mode disabled";return}if(!n.ctrlKey&&!n.metaKey)return;let t=n.key.toLowerCase();if(t==="s")n.preventDefault(),l();else if(t==="b")n.preventDefault(),d("bold");else if(t==="i")n.preventDefault(),d("italic");else if(t==="u")n.preventDefault(),d("underline");else if(t==="o")n.preventDefault(),U.value="",U.click();else if(t==="n")n.preventDefault(),o.innerHTML="<p></p>",f.value="Untitled Document",u(),i.textContent="Unsaved new document",o.focus()});v();o.focus();var K=window.yaar?.app;function nn(n){let t=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");o.innerHTML=`<p>${t}</p>`,u()}function $(n){o.innerHTML=n||"<p></p>",u()}function L(n){let t=document.createElement("div");t.innerHTML=n||"";while(t.firstChild)o.appendChild(t.firstChild);u()}function tn(n){let t=n.match(/<body[^>]*>([\s\S]*)<\/body>/i);return t?t[1]:n}function q(n){if(!n.length)return"<p></p>";return n.map((t,r)=>{let c=((t.title||"").trim()||`Document ${r+1}`).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");if(typeof t.html==="string")return`<section><h2>${c}</h2>${t.html}</section>`;let s=(t.text||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");return`<section><h2>${c}</h2><p>${s}</p></section>`}).join("")}if(K)K.register({appId:"word-lite",name:"Word Lite",state:{html:{description:"Current document HTML content",handler:()=>o.innerHTML},text:{description:"Current document plain text content",handler:()=>o.innerText||""},stats:{description:"Current text stats as { words, chars }",handler:()=>V(o.innerText||"")},title:{description:"Current document title",handler:()=>y()},saveState:{description:"Current save status label",handler:()=>i.textContent||""}},commands:{setHtml:{description:"Replace document with HTML. Params: { html: string }",params:{type:"object",properties:{html:{type:"string"}},required:["html"]},handler:(n)=>{return $(n.html||"<p></p>"),i.textContent="Updated via app protocol",l(),{ok:!0}}},setTitle:{description:"Update document title. Params: { title: string }",params:{type:"object",properties:{title:{type:"string"}},required:["title"]},handler:(n)=>{return f.value=(n.title||"").trim()||"Untitled Document",i.textContent="Updated via app protocol",l(),{ok:!0}}},setText:{description:"Replace document with plain text. Params: { text: string }",params:{type:"object",properties:{text:{type:"string"}},required:["text"]},handler:(n)=>{return nn(n.text||""),i.textContent="Updated via app protocol",l(),{ok:!0}}},appendText:{description:"Append plain text as a new paragraph to the document. Params: { text: string }",params:{type:"object",properties:{text:{type:"string"}},required:["text"]},handler:(n)=>{let t=(n.text||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"),r=document.createElement("p");return r.innerHTML=t,o.appendChild(r),u(),i.textContent="Updated via app protocol",l(),{ok:!0}}},appendHtml:{description:"Append HTML content to the end of the document without replacing existing content. Params: { html: string }",params:{type:"object",properties:{html:{type:"string"}},required:["html"]},handler:(n)=>{return L(n.html||""),i.textContent="Updated via app protocol",l(),{ok:!0}}},setDocuments:{description:"Replace the editor with multiple documents at once. Params: { docs: Array<{ title?: string, text?: string, html?: string }> }",params:{type:"object",properties:{docs:{type:"array",items:{type:"object",properties:{title:{type:"string"},text:{type:"string"},html:{type:"string"}}}}},required:["docs"]},handler:(n)=>{let t=Array.isArray(n.docs)?n.docs:[];return $(q(t)),i.textContent=`Loaded ${t.length} document(s) via app protocol`,l(),{ok:!0,count:t.length}}},appendDocuments:{description:"Append multiple documents to the current editor. Params: { docs: Array<{ title?: string, text?: string, html?: string }> }",params:{type:"object",properties:{docs:{type:"array",items:{type:"object",properties:{title:{type:"string"},text:{type:"string"},html:{type:"string"}}}}},required:["docs"]},handler:(n)=>{let t=Array.isArray(n.docs)?n.docs:[];return L(q(t)),i.textContent=`Appended ${t.length} document(s) via app protocol`,l(),{ok:!0,count:t.length}}},saveToStorage:{description:'Save the current document to YAAR persistent storage. Params: { path: string } — e.g. "docs/my-doc.html"',params:{type:"object",properties:{path:{type:"string"}},required:["path"]},handler:async(n)=>{let t=window.yaar?.storage;if(!t)return{ok:!1,error:"Storage API not available"};let e=`<!doctype html><html><head><meta charset="utf-8"><title>${y()}</title></head><body>${o.innerHTML}</body></html>`;return await t.save(n.path,e),i.textContent=`Saved to storage: ${n.path}`,{ok:!0,path:n.path,savedAt:z()}}},loadFromStorage:{description:'Load one or many documents from YAAR storage. Params: { path?: string, paths?: string[], mode?: "replace"|"append" }',params:{type:"object",properties:{path:{type:"string"},paths:{type:"array",items:{type:"string"}},mode:{type:"string",enum:["replace","append"]}}},handler:async(n)=>{let t=window.yaar?.storage;if(!t)return{ok:!1,error:"Storage API not available"};let r=[...n.path?[n.path]:[],...Array.isArray(n.paths)?n.paths:[]].filter((p)=>typeof p==="string"&&p.trim().length>0);if(!r.length)return{ok:!1,error:"Provide path or paths"};let e=[];for(let p of r){let a=await t.read(p,{as:"text"}),x=tn(a),w=(p.split("/").pop()||p).replace(/\.[^/.]+$/,"")||"Untitled Document";e.push({title:w,html:x})}let c=n.mode||"replace",s=q(e);if(c==="append")L(s);else $(s);return i.textContent=`Loaded ${e.length} file(s) from storage`,l(),{ok:!0,count:e.length,paths:r,mode:c}}},readStorageFile:{description:'Read one file from YAAR storage without mutating the editor. Params: { path: string, as?: "text"|"json"|"auto" }',params:{type:"object",properties:{path:{type:"string"},as:{type:"string",enum:["text","json","auto"]}},required:["path"]},handler:async(n)=>{let t=window.yaar?.storage;if(!t)return{ok:!1,error:"Storage API not available"};let r=n.as||"text",e=await t.read(n.path,{as:r});return{ok:!0,path:n.path,as:r,content:e}}},readStorageFiles:{description:'Read multiple files from YAAR storage without mutating the editor. Params: { paths: string[], as?: "text"|"json"|"auto" }',params:{type:"object",properties:{paths:{type:"array",items:{type:"string"}},as:{type:"string",enum:["text","json","auto"]}},required:["paths"]},handler:async(n)=>{let t=window.yaar?.storage;if(!t)return{ok:!1,error:"Storage API not available"};let r=(Array.isArray(n.paths)?n.paths:[]).filter((s)=>typeof s==="string"&&s.trim().length>0),e=n.as||"text",c=await Promise.all(r.map(async(s)=>({path:s,content:await t.read(s,{as:e})})));return{ok:!0,as:e,files:c}}},newDocument:{description:"Clear current document to a blank paragraph. Params: {}",params:{type:"object",properties:{}},handler:()=>{return o.innerHTML="<p></p>",f.value="Untitled Document",u(),i.textContent="Unsaved new document",{ok:!0}}},saveDraft:{description:"Save current document to local draft storage. Params: {}",params:{type:"object",properties:{}},handler:()=>{return l(),{ok:!0,savedAt:z()}}}}});

</script>
</body>
</html>