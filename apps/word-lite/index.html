<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Word Lite</title>
<style>*{margin:0;padding:0;box-sizing:border-box}html,body{width:100%;height:100%;overflow:hidden}body{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}</style>
<script>(function(){if(window.__yaarCaptureInstalled)return;window.__yaarCaptureInstalled=true;function respond(requestId,imageData){window.parent.postMessage({type:"yaar:capture-response",requestId,imageData},"*")}function inlineStyles(original,clone){var origEls=original.querySelectorAll("*");var cloneEls=clone.querySelectorAll("*");for(var i=0;i<origEls.length&&i<cloneEls.length;i++){var cs=window.getComputedStyle(origEls[i]);cloneEls[i].setAttribute("style",cs.cssText)}var rootCs=window.getComputedStyle(original);clone.setAttribute("style",rootCs.cssText)}function svgToCanvas(svgStr,w,h,cb){var blob=new Blob([svgStr],{type:"image/svg+xml;charset=utf-8"});var url=URL.createObjectURL(blob);var img=new Image;img.onload=function(){var c=document.createElement("canvas");c.width=w;c.height=h;var ctx=c.getContext("2d");ctx.drawImage(img,0,0,w,h);URL.revokeObjectURL(url);cb(c.toDataURL("image/png"))};img.onerror=function(){URL.revokeObjectURL(url);cb(null)};img.src=url}window.addEventListener("message",function(e){if(!e.data||e.data.type!=="yaar:capture-request")return;var requestId=e.data.requestId;var imageData=null;try{var canvases=document.querySelectorAll("canvas");if(canvases.length>0){var largest=null;var largestArea=0;for(var i=0;i<canvases.length;i++){var area=canvases[i].width*canvases[i].height;if(area>largestArea){largestArea=area;largest=canvases[i]}}if(largest){imageData=largest.toDataURL("image/png")}}if(imageData){respond(requestId,imageData);return}var svgs=document.querySelectorAll("svg");if(svgs.length>0){var largest=null;var largestArea=0;for(var i=0;i<svgs.length;i++){var rect=svgs[i].getBoundingClientRect();var area=rect.width*rect.height;if(area>largestArea){largestArea=area;largest=svgs[i]}}if(largest){var serializer=new XMLSerializer;var svgStr=serializer.serializeToString(largest);var rect=largest.getBoundingClientRect();svgToCanvas(svgStr,rect.width||300,rect.height||150,function(data){respond(requestId,data)});return}}var body=document.body;if(body){var w=Math.min(body.scrollWidth,window.innerWidth)||window.innerWidth||800;var h=Math.min(body.scrollHeight,window.innerHeight)||window.innerHeight||600;var clone=body.cloneNode(true);inlineStyles(body,clone);var remove=clone.querySelectorAll("script,iframe");for(var i=0;i<remove.length;i++)remove[i].remove();var xmlns="http://www.w3.org/1999/xhtml";var svgNS="http://www.w3.org/2000/svg";var xhtml=new XMLSerializer().serializeToString(clone);var svgStr='<svg xmlns="'+svgNS+'" width="'+w+'" height="'+h+'">'+'<foreignObject width="100%" height="100%">'+'<body xmlns="'+xmlns+'" style="margin:0;padding:0;">'+xhtml+"</body></foreignObject></svg>";svgToCanvas(svgStr,w,h,function(data){respond(requestId,data)});return}}catch(ex){}respond(requestId,null)})})();(function(){if(window.__yaarStorageInstalled)return;window.__yaarStorageInstalled=true;function encodePath(p){return p.split("/").map(encodeURIComponent).join("/")}window.yaar=window.yaar||{};window.yaar.storage={async save(path,data){var body;if(typeof data==="string"){body=data}else if(data instanceof Blob){body=await data.arrayBuffer()}else if(data instanceof ArrayBuffer){body=data}else if(data instanceof Uint8Array){body=data.buffer.slice(data.byteOffset,data.byteOffset+data.byteLength)}else{body=String(data)}var res=await fetch("/api/storage/"+encodePath(path),{method:"POST",body});if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Save failed")}return res.json()},async read(path,options){var mode=options&&options.as||"auto";var res=await fetch("/api/storage/"+encodePath(path));if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Read failed")}if(mode==="blob")return res.blob();if(mode==="arraybuffer")return res.arrayBuffer();if(mode==="json")return res.json();if(mode==="text")return res.text();var ct=res.headers.get("content-type")||"";if(ct.includes("json"))return res.json();if(ct.startsWith("text/"))return res.text();return res.blob()},async list(dirPath){var p=dirPath?encodePath(dirPath):"";var res=await fetch("/api/storage/"+p+"?list=true");if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"List failed")}return res.json()},async remove(path){var res=await fetch("/api/storage/"+encodePath(path),{method:"DELETE"});if(!res.ok){var err=await res.json().catch(function(){return{error:res.statusText}});throw new Error(err.error||"Delete failed")}return res.json()},url:function(path){return"/api/storage/"+encodePath(path)}}})();(function(){if(window.__yaarFetchProxyInstalled)return;window.__yaarFetchProxyInstalled=true;var realFetch=window.fetch.bind(window);var sessionId="";try{var sp=new URLSearchParams(location.search);var raw=sp.get("sessionId")||"";if(/^[a-zA-Z0-9_-]+$/.test(raw))sessionId=raw}catch(e){}window.fetch=function(input,init){var url;if(input instanceof Request){url=input.url}else{url=String(input)}if(url.startsWith("/")||url.startsWith("./")||url.startsWith("../")){return realFetch(input,init)}try{var parsed=new URL(url,location.origin);if(parsed.origin===location.origin){return realFetch(input,init)}}catch(e){return realFetch(input,init)}var method=init&&init.method||(input instanceof Request?input.method:"GET");var headers={};if(init&&init.headers){if(init.headers instanceof Headers){init.headers.forEach(function(v,k){headers[k]=v})}else if(Array.isArray(init.headers)){init.headers.forEach(function(pair){headers[pair[0]]=pair[1]})}else{headers=Object.assign({},init.headers)}}else if(input instanceof Request){input.headers.forEach(function(v,k){headers[k]=v})}var bodyPromise;if(init&&init.body!=null){if(typeof init.body==="string"){bodyPromise=Promise.resolve(init.body)}else{bodyPromise=new Response(init.body).text()}}else if(input instanceof Request&&method!=="GET"&&method!=="HEAD"){bodyPromise=input.text()}else{bodyPromise=Promise.resolve(undefined)}return bodyPromise.then(function(bodyStr){var payload={url,method,headers};if(bodyStr!==undefined)payload.body=bodyStr;if(sessionId)payload.sessionId=sessionId;return realFetch("/api/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)})}).then(function(proxyRes){if(!proxyRes.ok){return proxyRes.json().then(function(err){throw new Error(err.error||"Fetch proxy error: "+proxyRes.status)})}return proxyRes.json()}).then(function(data){var body;if(data.bodyEncoding==="base64"){var bin=atob(data.body);var bytes=new Uint8Array(bin.length);for(var i=0;i<bin.length;i++)bytes[i]=bin.charCodeAt(i);body=bytes.buffer}else{body=data.body}return new Response(body,{status:data.status,statusText:data.statusText,headers:data.headers})})}})();(function(){if(window.__yaarAppProtocolInstalled)return;window.__yaarAppProtocolInstalled=true;window.yaar=window.yaar||{};var registration=null;window.yaar.app={register:function(config){registration=config;window.parent.postMessage({type:"yaar:app-ready",appId:config.appId},"*")},sendInteraction:function(description){window.parent.postMessage({type:"yaar:app-interaction",content:typeof description==="string"?description:JSON.stringify(description)},"*")}};window.addEventListener("message",function(e){if(!e.data||!e.data.type)return;var msg=e.data;var requestId=msg.requestId;if(msg.type==="yaar:app-manifest-request"){if(!registration){window.parent.postMessage({type:"yaar:app-manifest-response",requestId,manifest:null,error:"No app registered"},"*");return}var manifest={appId:registration.appId,name:registration.name,state:{},commands:{}};if(registration.state){for(var key in registration.state){var s=registration.state[key];manifest.state[key]={description:s.description};if(s.schema)manifest.state[key].schema=s.schema}}if(registration.commands){for(var key in registration.commands){var c=registration.commands[key];manifest.commands[key]={description:c.description};if(c.params)manifest.commands[key].params=c.params;if(c.returns)manifest.commands[key].returns=c.returns}}window.parent.postMessage({type:"yaar:app-manifest-response",requestId,manifest},"*");return}if(msg.type==="yaar:app-query-request"){if(!registration||!registration.state||!registration.state[msg.stateKey]){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:"Unknown state key: "+msg.stateKey},"*");return}try{var result=registration.state[msg.stateKey].handler();if(result&&typeof result.then==="function"){result.then(function(data){window.parent.postMessage({type:"yaar:app-query-response",requestId,data},"*")}).catch(function(err){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:String(err)},"*")})}else{window.parent.postMessage({type:"yaar:app-query-response",requestId,data:result},"*")}}catch(err){window.parent.postMessage({type:"yaar:app-query-response",requestId,data:null,error:String(err)},"*")}return}if(msg.type==="yaar:app-command-request"){if(!registration||!registration.commands||!registration.commands[msg.command]){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:"Unknown command: "+msg.command},"*");return}try{var result=registration.commands[msg.command].handler(msg.params);if(result&&typeof result.then==="function"){result.then(function(data){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:data},"*")}).catch(function(err){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:String(err)},"*")})}else{window.parent.postMessage({type:"yaar:app-command-response",requestId,result},"*")}}catch(err){window.parent.postMessage({type:"yaar:app-command-response",requestId,result:null,error:String(err)},"*")}return}})})();</script>
</head>
<body>
<div id="app"></div>
<script type="module">
var T=`
:root {
  --bg: #0f172a;
  --panel: #111827;
  --toolbar: #1f2937;
  --surface: #ffffff;
  --text: #111827;
  --muted: #6b7280;
  --accent: #2563eb;
  --border: #e5e7eb;
}

* { box-sizing: border-box; }
html, body {
  margin: 0;
  height: 100%;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: var(--bg);
}

#app {
  height: 100%;
}

.app-shell {
  display: grid;
  grid-template-rows: auto auto 1fr auto;
  height: 100%;
  color: #e5e7eb;
}

.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 14px;
  background: var(--panel);
  border-bottom: 1px solid #374151;
}

.brand {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 700;
}

.doc-meta {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

#doc-title {
  min-width: 220px;
}

.brand-badge {
  width: 26px;
  height: 26px;
  border-radius: 7px;
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 13px;
}

.toolbar {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  padding: 10px 12px;
  background: var(--toolbar);
  border-bottom: 1px solid #374151;
}

.group {
  display: inline-flex;
  gap: 6px;
  padding-right: 8px;
  margin-right: 4px;
  border-right: 1px solid #374151;
}

.group:last-child {
  border-right: 0;
  padding-right: 0;
}

button, select, input {
  border: 1px solid #4b5563;
  background: #111827;
  color: #f3f4f6;
  border-radius: 8px;
  padding: 6px 10px;
  font-size: 13px;
  cursor: pointer;
}

button:hover, select:hover, input:hover {
  border-color: #9ca3af;
}

button.primary {
  background: var(--accent);
  border-color: #1e40af;
}

.editor-wrap {
  overflow: auto;
  padding: 24px;
  background: #0b1220;
}

.page {
  max-width: 860px;
  min-height: calc(100% - 4px);
  margin: 0 auto;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  box-shadow: 0 10px 24px rgba(0,0,0,0.22);
  color: var(--text);
  padding: 36px 44px;
  outline: none;
  line-height: 1.5;
  font-size: 16px;
  cursor: text;
}

.page a,
.page a:link,
.page a:visited,
.page a:hover,
.page a:active,
.page a:focus,
.page a * {
  cursor: pointer !important;
}

.page a:hover {
  text-decoration: underline;
}

.page:empty:before {
  content: attr(data-placeholder);
  color: #9ca3af;
}

.statusbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: var(--panel);
  border-top: 1px solid #374151;
  color: #d1d5db;
  font-size: 12px;
}

#app.focus-mode .topbar,
#app.focus-mode .toolbar,
#app.focus-mode .statusbar {
  display: none;
}

#app.focus-mode .editor-wrap {
  padding: 12px;
}

.muted {
  color: var(--muted);
}
`;var A="word-lite-document-v2",R="word-lite-document-v1";function Z(t,n=500){let e=null;return(...r)=>{if(e)window.clearTimeout(e);e=window.setTimeout(()=>t(...r),n)}}function C(t){let n=t.trim();return{words:n?n.split(/\s+/).length:0,chars:t.length}}function V(t,n){let e=URL.createObjectURL(n),r=document.createElement("a");r.href=e,r.download=t,r.click(),URL.revokeObjectURL(e)}function j(t,n,e){V(t,new Blob([n],{type:e}))}function P(){return new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function B(t){let n=t.trim().toLowerCase();if(!n)return"document";return n.replace(/[^a-z0-9\s-_]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").slice(0,60)||"document"}var q=new TextEncoder;function L(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function O(t){let n=t.reduce((p,d)=>p+d.length,0),e=new Uint8Array(n),r=0;for(let p of t)e.set(p,r),r+=p.length;return e}function _(){let t=new Uint32Array(256);for(let n=0;n<256;n++){let e=n;for(let r=0;r<8;r++)e=e&1?3988292384^e>>>1:e>>>1;t[n]=e>>>0}return t}var G=_();function H(t){let n=4294967295;for(let e=0;e<t.length;e++)n=G[(n^t[e])&255]^n>>>8;return(n^4294967295)>>>0}function K(t=new Date){let n=Math.max(1980,t.getFullYear()),e=t.getMonth()+1,r=t.getDate(),p=t.getHours(),d=t.getMinutes(),x=Math.floor(t.getSeconds()/2),a=n-1980<<9|e<<5|r,u=p<<11|d<<5|x;return{date:a,time:u}}function N(t){let n=[],e=[],r=K(new Date),p=0;for(let u of t){let w=q.encode(u.name),f=typeof u.data==="string"?q.encode(u.data):u.data,$=H(f),z=new Uint8Array(30+w.length),l=new DataView(z.buffer);l.setUint32(0,67324752,!0),l.setUint16(4,20,!0),l.setUint16(6,0,!0),l.setUint16(8,0,!0),l.setUint16(10,r.time,!0),l.setUint16(12,r.date,!0),l.setUint32(14,$,!0),l.setUint32(18,f.length,!0),l.setUint32(22,f.length,!0),l.setUint16(26,w.length,!0),l.setUint16(28,0,!0),z.set(w,30);let k=new Uint8Array(46+w.length),s=new DataView(k.buffer);s.setUint32(0,33639248,!0),s.setUint16(4,20,!0),s.setUint16(6,20,!0),s.setUint16(8,0,!0),s.setUint16(10,0,!0),s.setUint16(12,r.time,!0),s.setUint16(14,r.date,!0),s.setUint32(16,$,!0),s.setUint32(20,f.length,!0),s.setUint32(24,f.length,!0),s.setUint16(28,w.length,!0),s.setUint16(30,0,!0),s.setUint16(32,0,!0),s.setUint16(34,0,!0),s.setUint16(36,0,!0),s.setUint32(38,0,!0),s.setUint32(42,p,!0),k.set(w,46),n.push(z,f),e.push(k),p+=z.length+f.length}let d=O(e),x=new Uint8Array(22),a=new DataView(x.buffer);return a.setUint32(0,101010256,!0),a.setUint16(4,0,!0),a.setUint16(6,0,!0),a.setUint16(8,t.length,!0),a.setUint16(10,t.length,!0),a.setUint32(12,d.length,!0),a.setUint32(16,p,!0),a.setUint16(20,0,!0),O([...n,d,x])}function I(t,n){let r=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<w:document xmlns:wpc="http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:m="http://schemas.openxmlformats.org/officeDocument/2006/math" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:wp14="http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing" xmlns:wp="http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing" xmlns:w10="urn:schemas-microsoft-com:office:word" xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main" xmlns:w14="http://schemas.microsoft.com/office/word/2010/wordml" xmlns:wpg="http://schemas.microsoft.com/office/word/2010/wordprocessingGroup" xmlns:wpi="http://schemas.microsoft.com/office/word/2010/wordprocessingInk" xmlns:wne="http://schemas.microsoft.com/office/word/2006/wordml" xmlns:wps="http://schemas.microsoft.com/office/word/2010/wordprocessingShape" mc:Ignorable="w14 wp14">
  <w:body>
    ${(n||"").replace(/\r\n/g,`
`).split(`
`).map((u)=>`<w:p><w:r><w:t xml:space="preserve">${L(u)}</w:t></w:r></w:p>`).join("")||"<w:p />"}
    <w:sectPr>
      <w:pgSz w:w="12240" w:h="15840" />
      <w:pgMar w:top="1440" w:right="1440" w:bottom="1440" w:left="1440" w:header="708" w:footer="708" w:gutter="0"/>
      <w:cols w:space="708"/>
      <w:docGrid w:linePitch="360"/>
    </w:sectPr>
  </w:body>
</w:document>`,p=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
  <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>
  <Default Extension="xml" ContentType="application/xml"/>
  <Override PartName="/word/document.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml"/>
</Types>`,d=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="word/document.xml"/>
</Relationships>`,x=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<cp:coreProperties xmlns:cp="http://schemas.openxmlformats.org/package/2006/metadata/core-properties" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:dcmitype="http://purl.org/dc/dcmitype/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <dc:title>${L(t||"Untitled Document")}</dc:title>
</cp:coreProperties>`,a=N([{name:"[Content_Types].xml",data:`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
  <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>
  <Default Extension="xml" ContentType="application/xml"/>
  <Override PartName="/word/document.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml"/>
</Types>`},{name:"_rels/.rels",data:`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="word/document.xml"/>
</Relationships>`},{name:"docProps/core.xml",data:x},{name:"word/document.xml",data:r}]);return new Blob([a],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"})}var D=document.getElementById("app")||document.body;D.innerHTML=`
  <style>${T}</style>
  <div class="app-shell">
    <div class="topbar">
      <div class="brand"><span class="brand-badge">W</span> Word Lite</div>
      <div class="doc-meta">
        <label for="doc-title" class="muted">Title</label>
        <input id="doc-title" type="text" placeholder="Untitled Document" maxlength="100" />
      </div>
    </div>

    <div class="toolbar">
      <div class="group">
        <button data-cmd="bold"><b>B</b></button>
        <button data-cmd="italic"><i>I</i></button>
        <button data-cmd="underline"><u>U</u></button>
      </div>

      <div class="group">
        <select id="format-block" title="Style">
          <option value="P">Paragraph</option>
          <option value="H1">Heading 1</option>
          <option value="H2">Heading 2</option>
          <option value="H3">Heading 3</option>
          <option value="BLOCKQUOTE">Quote</option>
        </select>
      </div>

      <div class="group">
        <button data-cmd="justifyLeft">Left</button>
        <button data-cmd="justifyCenter">Center</button>
        <button data-cmd="justifyRight">Right</button>
        <button data-cmd="insertUnorderedList">• List</button>
        <button data-cmd="insertOrderedList">1. List</button>
      </div>

      <div class="group">
        <button id="btn-link">Link</button>
        <button data-cmd="removeFormat">Clear</button>
        <button data-cmd="undo">Undo</button>
        <button data-cmd="redo">Redo</button>
      </div>

      <div class="group">
        <button id="btn-new">New</button>
        <button id="btn-open">Open</button>
        <button id="btn-save" class="primary">Save</button>
        <button id="btn-export-txt">.txt</button>
        <button id="btn-export-html">.html</button>
        <button id="btn-export-docx">.docx</button>
        <button id="btn-focus">Focus</button>
      </div>
    </div>

    <div class="editor-wrap">
      <article id="editor" class="page" contenteditable="true" spellcheck="true" data-placeholder="Start typing..."></article>
      <input id="file-input" type="file" accept=".txt,.html,.htm" style="display:none" />
    </div>

    <div class="statusbar">
      <span id="stats">0 words • 0 chars</span>
      <span id="save-state">Not saved</span>
    </div>
  </div>
`;var o=document.getElementById("editor"),U=document.getElementById("file-input"),Y=document.getElementById("stats"),c=document.getElementById("save-state"),J=document.getElementById("format-block"),g=document.getElementById("doc-title"),h=!1,y=()=>(g.value||"").trim()||"Untitled Document",X=()=>B(y()),b=(t,n)=>{o.focus(),document.execCommand(t,!1,n),i()},i=()=>{let{words:t,chars:n}=C(o.innerText||""),e=t===0?0:Math.max(1,Math.ceil(t/200));Y.textContent=`${t} words • ${n} chars • ${e} min read`},m=()=>{let t={html:o.innerHTML,title:y(),savedAt:Date.now()};localStorage.setItem(A,JSON.stringify(t)),c.textContent=`Saved at ${P()}`},W=Z(()=>{m()},550),F=()=>{let t=localStorage.getItem(A);if(t){try{let n=JSON.parse(t);o.innerHTML=n.html||"<h1>Untitled Document</h1><p></p>",g.value=n.title||"Untitled Document"}catch{o.innerHTML=t,g.value="Untitled Document"}c.textContent="Loaded saved draft"}else{let n=localStorage.getItem(R);if(n)o.innerHTML=n,g.value="Untitled Document",c.textContent="Loaded saved draft",m(),localStorage.removeItem(R);else o.innerHTML="<h1>Untitled Document</h1><p></p>",g.value="Untitled Document",c.textContent="New document"}i()};for(let t of Array.from(document.querySelectorAll("button[data-cmd]")))t.addEventListener("click",()=>{let n=t.dataset.cmd;b(n)});J.addEventListener("change",()=>{b("formatBlock",J.value)});document.getElementById("btn-link")?.addEventListener("click",()=>{let t=prompt("Enter URL (https://...)");if(!t)return;b("createLink",t)});document.getElementById("btn-new")?.addEventListener("click",()=>{if(!confirm("Start a new blank document?"))return;o.innerHTML="<p></p>",g.value="Untitled Document",i(),c.textContent="Unsaved new document",o.focus()});document.getElementById("btn-open")?.addEventListener("click",()=>{U.value="",U.click()});document.getElementById("btn-save")?.addEventListener("click",()=>{m()});document.getElementById("btn-focus")?.addEventListener("click",()=>{h=!h,D.classList.toggle("focus-mode",h),c.textContent=h?"Focus mode enabled":"Focus mode disabled"});document.getElementById("btn-export-txt")?.addEventListener("click",()=>{j(`${X()}.txt`,o.innerText||"","text/plain;charset=utf-8")});document.getElementById("btn-export-html")?.addEventListener("click",()=>{let n=`<!doctype html><html><head><meta charset="utf-8"><title>${y()}</title></head><body>${o.innerHTML}</body></html>`;j(`${X()}.html`,n,"text/html;charset=utf-8")});document.getElementById("btn-export-docx")?.addEventListener("click",()=>{let t=I(y(),o.innerText||"");V(`${X()}.docx`,t),c.textContent=`Exported .docx at ${P()}`});U.addEventListener("change",async()=>{let t=U.files?.[0];if(!t)return;let n=await t.text();if(/\.html?$/i.test(t.name))o.innerHTML=n;else{let e=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");o.innerHTML=`<p>${e}</p>`}g.value=t.name.replace(/\.[^/.]+$/,"")||"Untitled Document",i(),c.textContent=`Opened ${t.name}`,m()});o.addEventListener("input",()=>{i(),c.textContent="Editing…",W()});g.addEventListener("input",()=>{c.textContent="Editing title…",W()});o.addEventListener("keyup",i);var M=(t)=>{if(!t)return;try{let n=new URL(t,window.location.href);if(!["http:","https:","mailto:","tel:"].includes(n.protocol)){alert(`Unsupported link protocol: ${n.protocol}`);return}window.open(n.href,"_blank","noopener,noreferrer")}catch{alert("Invalid URL")}};o.addEventListener("click",(t)=>{let e=t.target?.closest("a");if(!e)return;t.preventDefault(),M(e.getAttribute("href"))});document.addEventListener("keydown",(t)=>{if(t.key==="Escape"&&h){h=!1,D.classList.remove("focus-mode"),c.textContent="Focus mode disabled";return}if(!t.ctrlKey&&!t.metaKey)return;let n=t.key.toLowerCase();if(n==="s")t.preventDefault(),m();else if(n==="b")t.preventDefault(),b("bold");else if(n==="i")t.preventDefault(),b("italic");else if(n==="u")t.preventDefault(),b("underline");else if(n==="o")t.preventDefault(),U.value="",U.click();else if(n==="n")t.preventDefault(),o.innerHTML="<p></p>",g.value="Untitled Document",i(),c.textContent="Unsaved new document",o.focus()});F();o.focus();var Q=window.yaar?.app;function E(t){let n=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");o.innerHTML=`<p>${n}</p>`,i()}if(Q)Q.register({appId:"word-lite",name:"Word Lite",state:{html:{description:"Current document HTML content",handler:()=>o.innerHTML},text:{description:"Current document plain text content",handler:()=>o.innerText||""},stats:{description:"Current text stats as { words, chars }",handler:()=>C(o.innerText||"")},title:{description:"Current document title",handler:()=>y()},saveState:{description:"Current save status label",handler:()=>c.textContent||""}},commands:{setHtml:{description:"Replace document with HTML. Params: { html: string }",params:{type:"object",properties:{html:{type:"string"}},required:["html"]},handler:(t)=>{return o.innerHTML=t.html||"<p></p>",i(),c.textContent="Updated via app protocol",m(),{ok:!0}}},setTitle:{description:"Update document title. Params: { title: string }",params:{type:"object",properties:{title:{type:"string"}},required:["title"]},handler:(t)=>{return g.value=(t.title||"").trim()||"Untitled Document",c.textContent="Updated via app protocol",m(),{ok:!0}}},setText:{description:"Replace document with plain text. Params: { text: string }",params:{type:"object",properties:{text:{type:"string"}},required:["text"]},handler:(t)=>{return E(t.text||""),c.textContent="Updated via app protocol",m(),{ok:!0}}},appendText:{description:"Append plain text as a new paragraph to the document. Params: { text: string }",params:{type:"object",properties:{text:{type:"string"}},required:["text"]},handler:(t)=>{let n=(t.text||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"),e=document.createElement("p");return e.innerHTML=n,o.appendChild(e),i(),c.textContent="Updated via app protocol",m(),{ok:!0}}},appendHtml:{description:"Append HTML content to the end of the document without replacing existing content. Params: { html: string }",params:{type:"object",properties:{html:{type:"string"}},required:["html"]},handler:(t)=>{let n=document.createElement("div");n.innerHTML=t.html||"";while(n.firstChild)o.appendChild(n.firstChild);return i(),c.textContent="Updated via app protocol",m(),{ok:!0}}},saveToStorage:{description:'Save the current document to YAAR persistent storage. Params: { path: string } — e.g. "docs/my-doc.html"',params:{type:"object",properties:{path:{type:"string"}},required:["path"]},handler:async(t)=>{let n=window.yaar?.storage;if(!n)return{ok:!1,error:"Storage API not available"};let r=`<!doctype html><html><head><meta charset="utf-8"><title>${y()}</title></head><body>${o.innerHTML}</body></html>`;return await n.save(t.path,r),c.textContent=`Saved to storage: ${t.path}`,{ok:!0,path:t.path,savedAt:P()}}},loadFromStorage:{description:"Load a document from YAAR persistent storage into the editor. Params: { path: string }",params:{type:"object",properties:{path:{type:"string"}},required:["path"]},handler:async(t)=>{let n=window.yaar?.storage;if(!n)return{ok:!1,error:"Storage API not available"};let e=await n.read(t.path,{as:"text"}),r=e.match(/<body[^>]*>([\s\S]*)<\/body>/i);return o.innerHTML=r?r[1]:e,i(),c.textContent=`Loaded from storage: ${t.path}`,m(),{ok:!0,path:t.path}}},newDocument:{description:"Clear current document to a blank paragraph. Params: {}",params:{type:"object",properties:{}},handler:()=>{return o.innerHTML="<p></p>",g.value="Untitled Document",i(),c.textContent="Unsaved new document",{ok:!0}}},saveDraft:{description:"Save current document to local draft storage. Params: {}",params:{type:"object",properties:{}},handler:()=>{return m(),{ok:!0,savedAt:P()}}}}});

</script>
</body>
</html>