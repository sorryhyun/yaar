# YAAR

**Y**ou **A**re **A**bsolutely **R**ight — AI가 다음에 무엇을 보여주고 할지 스스로 결정하는 리액티브 AI 인터페이스.

미리 만들어진 화면 없이, **항상 준비된 입력창** 하나만 있으면 됩니다. AI가 사용자의 의도에 따라 윈도우, 테이블, 폼, 시각화를 동적으로 생성합니다.

> [English version](./README.en.md)

## 작동 방식

```
┌─────────────────────────────────────────────────────────────────┐
│                          프론트엔드                               │
│   ┌─────────────┐    ┌──────────────┐    ┌──────────────────┐  │
│   │   입력창     │    │   캔버스      │    │    윈도우         │  │
│   │             │    │   (그리기)    │    │   (렌더링)       │  │
│   └──────┬──────┘    └──────┬───────┘    └────────▲─────────┘  │
│          │                  │                     │             │
│          └────────┬─────────┘                     │             │
│                   ▼                               │             │
│            사용자 메시지                    OS Actions (JSON)    │
│                   │                               │             │
└───────────────────┼───────────────────────────────┼─────────────┘
                    │          WebSocket            │
┌───────────────────▼───────────────────────────────┼─────────────┐
│                          서버                      │             │
│   ┌───────────────────────────────────────────────┴──────────┐  │
│   │                      AI 프로바이더                         │  │
│   │   • 사용자 의도를 해석                                     │  │
│   │   • 동적 컨텍스트 주입 (앱, 히스토리)                       │  │
│   │   • OS Actions 생성 → 프론트엔드가 렌더링                   │  │
│   └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## 주요 기능

### 1. AI가 해석하고 렌더링

AI는 단순히 텍스트로 응답하지 않고 **UI를 직접 생성**합니다. 할 일 목록을 요청하면 체크박스가 있는 윈도우가 나타나고, 데이터 비교를 요청하면 테이블이 렌더링됩니다. `Alt + 좌클릭 드래그`로 화면 어디서든 스케치해서 보낼 수도 있습니다 — AI가 그림을 해석해서 코드를 생성하거나 디자인을 다듬어 줍니다.

```
사용자: "오늘 할 일 보여줘"
   AI: 인터랙티브 할 일 목록이 담긴 윈도우 생성
사용자: (와이어프레임 스케치)
   AI: 스케치를 해석해서 실제 UI 생성
```

### 2. 스마트 컨텍스트

하고 있는 작업에 따라 AI가 관련 정보를 자동으로 파악합니다. 앱 아이콘을 클릭하면 해당 앱의 스킬을 로드하고, 윈도우와 상호작용하면 그 맥락을 수신하며, 이전 결과도 대화 히스토리로 보유합니다. 윈도우 내용이 변경될 때는 핑거프린트 기반 캐시로 AI 재호출 없이 즉시 복원합니다.

### 3. 앱 개발

"테트리스 만들어줘"라고 말하면 AI가 TypeScript를 작성하고, esbuild로 컴파일하고, 바탕화면에 배포합니다. npm 설치 없이 사용 가능한 번들 라이브러리(lodash, anime.js, Konva 등)를 포함하며, 격리된 샌드박스에서 코드를 실행합니다.

외부 API를 활용하는 앱은 `SKILL.md`에 API 사용법을 기술하면 AI가 호출합니다. 컴파일된 앱은 **App Protocol**을 통해 AI 에이전트와 양방향 통신할 수 있어, 에이전트가 앱의 상태를 읽고 명령을 실행할 수 있습니다.

자세한 내용은 [앱 개발 가이드](./docs/app-development.md)를 참고하세요.

### 4. 병렬 모니터와 윈도우

여러 작업을 동시에 진행할 수 있습니다. **모니터**(`Ctrl+1`~`Ctrl+9`)는 독립 워크스페이스로, 모니터 1에서 긴 작업을 실행하면서 모니터 0에서 다른 대화를 이어갈 수 있습니다. 각 **윈도우**도 자체 에이전트를 가져 서로 다른 윈도우 간 요청이 병렬 처리됩니다. 메인 에이전트가 바쁠 때 새 메시지가 오면 임시 에이전트가 자동 생성됩니다.

세션은 브라우저 탭을 닫아도 유지되며, `?sessionId=X`로 재접속하면 상태를 복원합니다. 자세한 내용은 [`docs/monitor_and_windows_guide.md`](./docs/monitor_and_windows_guide.md)를 참고하세요.

## 보안

YAAR는 AI가 코드를 실행하고 외부 서비스와 통신하는 만큼, 여러 보안 레이어를 갖추고 있습니다.

- **샌드박스 격리**: `run_js` 코드는 `node:vm`에서 실행됩니다. `eval`, `Function`, `require`, `import`, 파일 시스템 접근이 차단되며, WebAssembly도 비활성화됩니다.
- **도메인 허용 목록**: HTTP 요청(`http_get`/`http_post`)과 샌드박스 `fetch`는 `config/curl_allowed_domains.yaml`에 등록된 도메인만 허용합니다. 새 도메인은 사용자 승인 다이얼로그를 거칩니다.
- **MCP 인증**: MCP 도구 호출은 서버 시작 시 생성된 Bearer 토큰으로 인증됩니다. 로컬 개발 시 `MCP_SKIP_AUTH=1`로 비활성화 가능합니다.
- **권한 기억**: 사용자의 승인/거부 결정이 `config/permissions.json`에 저장되어 반복 요청 시 재확인하지 않습니다.
- **자격 증명 분리**: 앱 자격 증명은 `config/credentials/`에 저장되며 git에서 제외됩니다.
- **경로 검증**: 스토리지와 샌드박스 파일 접근 시 경로 순회(path traversal)를 방지합니다.
- **CORS**: 프론트엔드 개발 서버 오리진(`localhost:5173`, `localhost:3000`)만 허용합니다.
- **iframe 격리**: 컴파일된 앱은 iframe에서 실행되며, `postMessage`를 통해서만 서버와 통신합니다.

## 빠른 시작

**사전 요구사항:** Node.js >= 24, pnpm >= 10, Claude CLI (`npm install -g @anthropic-ai/claude-code && claude login`)

```bash
pnpm install    # 의존성 설치
make dev        # YAAR 시작
```

http://localhost:5173 접속

## 프로젝트 구조

```
yaar/
├── apps/              # 여기에 폴더를 넣으면 앱이 됩니다
├── packages/
│   ├── shared/        # OS Actions 타입
│   ├── server/        # WebSocket 서버 + AI 프로바이더
│   └── frontend/      # React 프론트엔드
```

개발 관련 상세 내용은 [CLAUDE.md](./CLAUDE.md)를 참고하세요.
